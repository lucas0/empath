End-User Guides
Cisco SD-WAN Systems and Interfaces Configuration Guide, Cisco IOS XE Release 17.x
Bias-Free Language
Book Contents
Translations
Download
Print
Updated:
August 25, 2021
Chapter: Extended Visibility with Cisco SD-WAN and Cisco ThousandEyes
Chapter Contents
Table 1. Feature History
Feature Name
Release Information
Description
Extended Visibility with Cisco SD-WAN and Cisco ThousandEyes
Cisco IOS XE Release 17.6.1a
Cisco vManage Release 20.6.1
You can deploy Cisco ThousandEyes Enterprise agent natively as a container application on supported Cisco IOS XE SD-WAN devices to integrate Cisco SD-WAN with Cisco ThousandEyes. You can install and activate the Cisco ThousandEyes Enterprise agent through Cisco vManage.
By integrating Cisco SD-WAN with Cisco ThousandEyes, you can gain granular insights into network and application performance with full hop-by-hop path analysis across the Internet, and isolate fault domains for expedited troubleshooting and resolution.
Cisco ThousandEyes Support for Cisco 1000 Series Integrated Services Routers
Cisco IOS XE Release 17.7.1a
Cisco vManage Release 20.7.1
You can deploy Cisco ThousandEyes Enterprise agent natively as a container application on Cisco ISR 1100X-6G devices. You can install and activate the Cisco ThousandEyes Enterprise agent through Cisco vManage.
Cisco ThousandEyes Support for Cisco Catalyst 8500 Series Edge Platforms and Cisco ASR 1000 Series Aggregation Services Routers
Cisco IOS XE Release 17.8.1a
Cisco vManage Release 20.8.1
You can deploy Cisco ThousandEyes Enterprise agent natively as a container application on Cisco Catalyst 8500 Series Edge Platforms and Cisco ASR 1000 Series Aggregation Services Routers. You can install and activate the Cisco ThousandEyes Enterprise agent through Cisco vManage.
Supported Devices for Extended Visibility with Cisco SD-WAN and Cisco ThousandEyes
Prerequisites for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Restrictions for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Information About for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Configure Cisco ThousandEyes Enterprise Agent on Cisco IOS XE SD-WAN Devices
Troubleshoot Cisco ThousandEyes Enterprise Agent on Cisco IOS XE SD-WAN Devices
Supported Devices for Extended Visibility with Cisco SD-WAN and Cisco ThousandEyes
Release Platform Device Model Minimum Supported ThousandEyes Enterprise Agent Version
Cisco IOS XE Release 17.6.1a and later
Cisco Catalyst 8300 Series Edge Platforms C8300-1N1S-6T
4.0.2
C8300-1N1S-4T2X
C8300-2N2S-6T
C8300-2N2S-4T2X
Cisco Catalyst 8200 Series Edge Platforms C8200-1N-4T
4.0.2
C8200L-1N-4T
Cisco 4000 Series Integrated Services Routers ISR4461
4.0.2
ISR4451
ISR4431
ISR4351
ISR4331
ISR4321
ISR4221X
Cisco IOS XE Release 17.7.1a and later
Cisco 1000 Series Integrated Services Routers
ISR1100X-6G
4.1.0
Cisco IOS XE Release 17.8.1a and later
Cisco Catalyst 8500 Series Edge Platforms
C8500-12X
4.2.0
C8500-12X4QC
C8500L-8S4X
Cisco ASR 1000 Series Aggregation Services Routers
ASR 1001-HX
4.2.0
ASR 1001-X
ASR 1002-HX
ASR 1002-X
ASR 1006-X (RP3)
Storage and DRAM Requirements
External Storage: On devices that are equipped with external storage (SSD M.2 NVMe), the Cisco ThousandEyes Enterprise agent is installed in the external storage. The minimum external storage capacity that is required to install the Cisco ThousandEyes Enterprise agent is 8 GB. If the device does not have sufficient external storage capacity, upgrade the storage capacity to meet the minimum requirement.
Although the minimum external storage capacity that is required is 8 GB, we recommend that you provision the device with an external storage capacity of 16 GB or more. With the minimum external storage capacity, you may need to manually clean up files while upgrading the software image on the device.
Bootflash: On devices that are not equipped with external storage, the Cisco ThousandEyes Enterprise agent is installed on the bootflash. The minimum bootflash capacity that is required to install the Cisco ThousandEyes Enterprise agent is 8 GB. If the device does not have sufficient bootflash capacity, upgrade the storage capacity to meet the minimum requirement.

Important
On the ISR1100X-6G, the Cisco ThousandEyes Enterprise agent is installed on the bootflash. For this particular device model, the minimum bootflash capacity that is required to install the agent is 16 GB.
Although the minimum bootflash capacity that is required is 8 GB, we recommend that you provision the device with an bootflash capacity of 16 GB or more. With the minimum bootflash capacity, you may need to manually clean up files while upgrading the software image on the device.
DRAM: The minimum DRAM capacity that is required to install the Cisco ThousandEyes Enterprise agent is 8 GB. If a device does not have the minimum DRAM capacity that is required to install the Cisco ThousandEyes Enterprise agent, upgrade the DRAM to meet the minimum requirement.
Cisco ThousandEyes Enterprise agent can be deployed with other applications if the device has the resources (CPU, memory, and storage) to run the other applications. If the available resources are not sufficient to run the other applications, IOX generates an error message and does not run the other applications.
To host the Cisco ThousandEyes Enterprise agent, a Cisco IOS XE SD-WAN device must have a minimum of 8 GB DRAM. If you wish host additional applications such as UTD and DRE on the same device, we recommend that you provision the device with at least a 16 GB DRAM.
Prerequisites for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Before deploying the Cisco ThousandEyes Enterprise agent, you must create an account on the Cisco ThousandEyes portal and obtain an account group token. The agent uses the token to authenticate itself with Cisco ThousandEyes and check-in to the right Cisco ThousandEyes account.
For information on obtaining the account group token, see Where Can I Get the Account Group Token? on Cisco ThousandEyes Documentation portal.
The Cisco ThousandEyes Enterprise agent requires DNS name resolution and HTTP/HTTPS connectivity to discover and register with the Cisco ThousandEyes portal. Ensure that this connectivity exists before deploying the agent by configuring the appropriate firewall rules, NAT settings, upstream routing, and other related settings.
For more information on the required firewall configuration, see Firewall Configuration for Enterprise Agents on Cisco ThousandEyes Documentation portal.
Restrictions for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Cisco ThousandEyes Enterprise agent probes are sourced from Virtual Port-Group interfaces and are not affected by AppRoute data policies.
The Cisco ThousandEyes Enterprise agent, hosted natively as a container application on Cisco IOS XE SD-WAN devices, does not support browser-based application tests, such as page load test and transaction test.
For every changes to the thousandeye instance to reflect the changes done you need uninstall or deactivate and reintsall and reactivate it.
For Cisco IOS XE SD-WAN devices prior to Cisco IOS XE Release 17.6.1, the Docker image can be installed either directly from the ThousandEyes download servers, or by downloading the container image to a local machine and uploading it to the router via SCP, FTP, TFTP, or USB storage, depending on whether the router has direct internet access or not.
For Cisco IOS XE SD-WAN devices after Cisco IOS XE Release 17.6.1, in addition to the previous methods, you can install the Enterprise Agent via bootflash.
Information About for Extending Visibility with Cisco SD-WAN and Cisco ThousandEyes
Cisco ThousandEyes is a SaaS application that provides you an end-to-end view across networks and services that impact your business. It monitors the network traffic paths across internal, external, and carrier networks and the Internet in realtime to provide network performance data. Cisco ThousandEyes provides intelligent insights into your WAN and the cloud and helps you optimize application delivery and end-user experience.
From Cisco IOS XE Release 17.6.1, you can deploy and configure the Cisco ThousandEyes Enterprise agent on Cisco IOS XE SD-WAN devices to enable extensive monitoring of the WAN traffic for enhanced visibility within and beyond the Cisco SD-WAN fabric. The Cisco ThousandEyes Enterprise agent is an embedded Docker-based application that runs on Cisco IOS XE SD-WAN devices as a docker-type container application using the IOX Docker application-hosting capability.
For more information on Cisco ThousandEyes and on configuring tests and viewing results on the Cisco ThousandEyes portal, see the Cisco ThousandEyes Getting Started documentation.
Configure Cisco ThousandEyes Enterprise Agent on Cisco IOS XE SD-WAN Devices
Upload Cisco ThousandEyes Enterprise Agent Software to Cisco vManage
Provision Cisco ThousandEyes Enterprise Agent in Transport VPN (VPN 0)
Provision Cisco ThousandEyes Enterprise Agent in a Service VPN
Provision Cisco ThousandEyes Enterprise Agent in a Service VPN Using CLI
Upgrade Cisco ThousandEyes Enterprise Agent Software
Uninstall Cisco ThousandEyes Enterprise Agent Software
Upload Cisco ThousandEyes Enterprise Agent Software to Cisco vManage
Download the latest version of Cisco ThousandEyes Enterprise agent software from the Cisco ThousandEyes Agent Settings page.
From the Cisco vManage menu, choose Maintenance > Software Repository.
Click Virtual Images.
Click Upload Virtual Image and click vManage.
In the Upload VNF's Package to vManage dialog box, browse to the location of the downloaded Cisco ThousandEyes Enterprise agent software file and select the file.
Alternatively, drag and drop the Cisco ThousandEyes Enterprise agent software file.
Enter a description for the file.
(Optional) Add desired tags.
Click Upload.
Provision Cisco ThousandEyes Enterprise Agent in Transport VPN (VPN 0)
You can provision the Cisco ThousandEyes Enterprise agent in VPN 0 for more visibility into the performance of underlay networks beyond the Cisco SD-WAN fabric. The Cisco ThousandEyes Enterprise agent does not probe the Cisco SD-WAN fabric when provisioned in VPN 0.
Prerequisites
Ensure that the appropriate DNS and NAT configuration exists to enable the Cisco ThousandEyes Enterprise agent to discover and connect to the Cisco ThousandEyes application.
Upload Cisco ThousandEyes Enterprise agent software to Cisco vManage.

Note
If you have uploaded more than one version of the Cisco ThousandEyes Enterprise agent software to the Cisco vManage software repository, while provisioning the agent, Cisco vManage installs and activates the latest version of the agent software.
Procedure
Create feature template for the Cisco ThousandEyes Enterprise agent:
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates, and click Add Template to select an appropriate device model.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is titled as Feature.
Choose the supported devices to which you want to apply this template.
In the Other Templates section, click ThousandEyes Agent.
Template Name: Enter a name for the template. Ensure that the template name is unique.
Description: Enter a description for the template.
In the BASIC CONFIGURATION section, enter the Cisco ThousandEyes Account Group Token.
In the ADVANCED section, enter the IP address of your preferred Name Server.

Note
From Cisco vManage Release 20.7.1 and Cisco IOS XE Release 17.7.1a, this step is optional.
Click Save.
Attach the ThousandEyes Agent feature template to device template:
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Device Templates is titled as Device
Find the device template for the target device.
For this template, click … and then click Edit.
Click Additional Templates.
In the Additional Templates section, choose the ThousandEyes Agent feature template created earlier.
Click Update.
Update necessary variables, if any, and click Next.
Review the configuration and click Configure Devices.
Repeat Step 2 for each device on which you want to deploy the Cisco ThousandEyes Enterprise agent.
The Cisco ThousandEyes Enterprise agent is deployed on the chosen devices. The agent registers with and establishes secure communication with the cloud-based Cisco ThousandEyes application to receive necessary updates and configuration. You can configure various tests and see resultant network and application telemetry data on the Cisco ThousandEyes portal.
Provision Cisco ThousandEyes Enterprise Agent in a Service VPN
You can provision the Cisco ThousandEyes Enterprise agent in a service VPN for more visibility into the performance of the Cisco SD-WAN overlay and underlay networks.
Prerequisites
Ensure that the appropriate DNS and NAT configuration exists to enable the Cisco ThousandEyes Enterprise agent to discover and connect to the Cisco ThousandEyes application.
Upload Cisco ThousandEyes Enterprise agent software to Cisco vManage.

Note
If you have uploaded more than one version of the Cisco ThousandEyes Enterprise agent software to the Cisco vManage software repository, while provisioning the agent, Cisco vManage installs and activates the latest version of the agent software.
Procedure
Create feature template for the Cisco ThousandEyes Enterprise agent:
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates, and click Add Template to select an appropriate device model.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is titled as Feature.
Choose the supported devices to which you want to apply this template.
In the Other Templates section, click ThousandEyes Agent.
Template Name: Enter a name for the template. Ensure that the template name is unique.
Description: Enter a description for the template.
In the BASIC CONFIGURATION section, configure the following:
Account Group Token Enter the Cisco ThousandEyes Account Group Token.
VPN
Set the VPN configuration as a Global or a Device Specific setting.
Enter the ID of the service VPN in which you want to provision the Cisco ThousandEyes Enterprise agent.
Agent IP Address
Enter an IP address for the Cisco ThousandEyes Enterprise agent.
This IP Address should be unique within the fabric and should not overlap with the IP addresses of other branch agents.
Agent Default Gateway Enter a default gateway address. This IP address is assigned to the virtual port group of the router.

Tip
You can create and allocate a service subnet for the agent network. Two usable IP addresses are required to provision the Cisco ThousandEyes Enterprise agent on each Cisco IOS XE SD-WAN device. One of the IP addresses must be assigned to the agent and second IP address to the router virtual port group.
In the ADVANCED section, configure the following:
Name Server
(Optional parameter from Cisco vManage Release 20.7.1 and Cisco IOS XE Release 17.7.1a)
Enter the IP address of your preferred DNS server.
This server can exist within or outside the Cisco SD-WAN fabric but must be reachable from the service VPN.
Hostname (Optional) Enter the hostname that the agent must use when registering with the Cisco ThousandEyes portal. By default, the agent uses the Cisco IOS XE SD-WAN device’s hostname.
Web Proxy Type
(Optional) If the Cisco ThousandEyes Enterprise agent must use proxy server for external access, choose one of the following as proxy type:
Static
PAC
Static proxy settings:
Proxy Host: Set the configuration as a Global setting and enter the hostname of the proxy server.
Proxy Port: Set the configuration as a Global setting and enter the port number of the proxy server.
PAC settings:
PAC URL: Set the configuration as a Global setting and enter the URL of the proxy auto-configuration (PAC) file.
Click Save.
Attach the ThousandEyes Agent feature template to device template:
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Device Templates is titled as Device
Find the device template for the target device.
For this template, click …, and click Edit.
Click Additional Templates.
In the Additional Templates section, choose the ThousandEyes Agent feature template created earlier.
Click Update.
Update necessary variables, if any, and click Next.
Review the configuration and click Configure Devices.
Repeat Step 2 for each device on which you want to deploy the Cisco ThousandEyes Enterprise agent.
The Cisco ThousandEyes Enterprise agent is deployed on the chosen devices. The agent registers with and establishes secure communication with the cloud-based Cisco ThousandEyes application to receive necessary updates and configuration. You can configure various tests and see resultant network and application telemetry data on the Cisco ThousandEyes portal.
Provision Cisco ThousandEyes Enterprise Agent in a Service VPN Using CLI
This section provides example command sequences to provision the Cisco ThousandEyes Enterprise agent on Cisco IOS XE SD-WAN devices using a device CLI template or an add-on CLI template.
Prerequisites
Ensure that the appropriate DNS and NAT configuration exists to enable the Cisco ThousandEyes Enterprise agent to discover and connect to the Cisco ThousandEyes application.
Upload Cisco ThousandEyes Enterprise agent software to Cisco vManage.

Note
If you have uploaded more than one version of the Cisco ThousandEyes Enterprise agent software to the Cisco vManage software repository, while provisioning the agent, Cisco vManage installs and activates the latest version of the agent software.
This section provides example CLI configurations to provision the Cisco ThousandEyes Enterprise agent in a service VPN.
Enable IOX on the device.
iox
Configure virtual port group. The virtual port group acts as the gateway for the Cisco ThousandEyes Enterprise agent.
interface VirtualPortGroup4
 vrf forwarding 100
  ip address 192.168.61.1 255.255.255.252
Configure app-hosting paramters for the Cisco ThousandEyes Enterprise agent.
app-hosting appid te
app-vnic gateway0 virtualportgroup 4 guest-interface 0
 guest-ipaddress 192.168.61.2 netmask 255.255.255.252
app-default-gateway 192.168.61.1 guest-interface 0
app-resource docker
 prepend-pkg-opts
 run-opts 1 "-e TEAGENT_ACCOUNT_TOKEN=z0kemf"
 run-opts 2 "--hostname ISR4461TE"
 run-opts 3 "-e TEAGENT_PROXY_TYPE=STATIC -e TEAGENT_PROXY_LOCATION=proxy-exmaple.com:80"
name-server0  192.168.168.183
start

Note
You can use the proxy configuration only if the Cisco ThousandEyes agent does not have an Internet access without a proxy. Also, the hostname is optional and if you do not provide the hostname during the installation, the device hostname will be used as the Cisco ThousandEyes agent hostname. The device hostname will be displayed on the Cisco ThousandEyes portal. From Cisco IOS XE Release 17.7.1a, the DNS name server information is optional.
If the Cisco ThousandEyes agent uses a private IP address, establish a connection to the device through NAT.
Upgrade Cisco ThousandEyes Enterprise Agent Software

Note
You cannot upgrade the Cisco ThousandEyes Enterprise agent software on Cisco IOS XE SD-WAN devices that do not have external storage. In such devices, the bootflash is used to install and launch the agent. Bootflash does not have the storage capacity to support agent software upgrade. Instead of upgrading the agent software, you can uninstall the existing software and provision the new version of the software.
Download a new version of Cisco ThousandEyes Enterprise agent software and upload the software to Cisco vManage. See Upload Cisco ThousandEyes Enterprise Agent Software to Cisco vManage.
From the Cisco vManage menu, choose Maintenance > Software Upgrade.
Select the Cisco IOS XE SD-WAN devices on which you want to upgrade the Cisco ThousandEyes Enterprise agent software.
Click Upgrade Virtual Image.
In the Virtual Image Upgrade dialog box, choose the new version of the Cisco ThousandEyes Enterprise agent software from the drop-down list. Click Upgrade.
On the Maintenance > Software Upgrade page, select the Cisco IOS XE SD-WAN devices on which you upgraded the Cisco ThousandEyes Enterprise agent software.
Click Activate Virtual Image.
Uninstall Cisco ThousandEyes Enterprise Agent Software
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Device Templates is titled as Device
Find the device template for the device from which the Cisco ThousandEyes agent software must be removed.
For this template, click … and then click Edit.
Click Additional Templates.
In the Additional Templates section, for ThousandEyes Agent choose None from the drop-down list.
Click Update.
Update necessary variables, if any, and click Next.
Review the configuration and click Configure Devices.
Troubleshoot Cisco ThousandEyes Enterprise Agent on Cisco IOS XE SD-WAN Devices
Connect to Cisco ThousandEyes Enterprise agent.
Device#app-hosting connect appid Appid session /bin/bash
To verify the agent configuration, check the following CFG file: /etc/te-agent.cfg
To view the agent logs, check the following file: var/log/agent/te-agent.log
Was this Document Helpful?
Yes No
Feedback
Customers Also Viewed
Configure Thousand Eyes on SD-WAN Devices
Identify vEdge Certificate Expired on May 9, 2023
Cisco SD-WAN Getting Started Guide --- Install and Upgrade Cisco IOS XE Release 17.2.1r and Later
+ Show 3 More
Contact Cisco
Open a Support Case
(Requires a Cisco Service Contract)