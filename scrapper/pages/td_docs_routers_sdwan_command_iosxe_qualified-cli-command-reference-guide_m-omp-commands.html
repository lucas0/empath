Command References
Cisco IOS XE SD-WAN Qualified Command Reference
Bias-Free Language
Book Contents
Download
Print
Updated:
January 29, 2021
Chapter: OMP Commands
Chapter Contents
advertise
distance
ecmp-limit (omp)
graceful-restart (omp)
no shutdown (omp)
omp
outbound tloc-color
overlay-as (omp)
send-path-limit (omp)
timers
tloc-color-compatibility
advertise
To advertise additional paths for a BGP peer policy template based on the best path selection, use the advertise command in address family configuration mode at the specific VPN or VRF level.
Route advertisements that you configure with the advertise command apply to all VPNs configured on the router. The advertise command can be issued for either a VPN, or for all VPNs on a device.
advertise [ bgp ] [ connected ] [ ospf type ] [ static ]
no advertise [ bgp ] [ connected ] [ ospf type ] [ static ]
Syntax Description
bgp
BGP Routes:
Advertise all BGP routes learned by the Cisco IOS XE Catalyst SD-WAN devices to OMP.
connected
Connected Routes:
Advertise all connected routes on the Cisco IOS XE Catalyst SD-WAN devices to OMP. The connected routes are advertised by default. To disable advertisement, use the no advertise connected command.
ospf type
OSPF Routes:
Advertise all OSPF routes learned by the local Cisco IOS XE Catalyst SD-WAN devices to OMP. For the global OMP configuration, type can be external, to advertise routes learned from external ASs. For the VPN-specific OMP configuration, type can be external, to advertise routes learned from the local AS. For the global OMP configuration, OSPF external routes are advertised by default.
static
Static Routes:
Advertise all static routes configured on the Cisco IOS XE Catalyst SD-WAN devices to OMP. Static routes are advertised by default. To disable advertisement, use the no advertise static command.
Command Default
This command has no default behavior.
Command Modes
OMP configuration (config-omp)
Address family configuration (config-af)
Command History
Release Modification
Cisco IOS XE Release 17.6.1a
Command qualified for use in Cisco SD-WAN Manager CLI templates.
Example
The following example shows how to advertise to Cisco SD-WAN Controller, the routes that a Cisco IOS XE Catalyst SD-WAN device has learned from the local network in a branch network that is running static, connected, and OSPF protocols.
config-transaction
sdwan
omp
address-family ipv4
advertise static
advertise connected
advertise ospf external
Advertise routes to OMP:
show running-config vpn 1
omp
 no shutdown
 graceful-restart
distance 100
 timers
  holdtime 15
  graceful-restart-timer 120
 exit
 advertise static
 advertise connected
 advertise ospf external
!
distance
To configure the OMP administrative distance, use the distance command in router configuration mode or address-family configuration mode. To reset the value to its defaults, use the no form of this command.
distance kilometers
no distance
Syntax Description
kilometers
Administrative distance for OMP routes. The Cisco vSmart Controllers learn the topology of the overlay network and the services available in the network using OMP routes. The distance can be a value between 1–255.
Command Default
The default administrative distances are based on a protocol.
Command Modes
OMP configuration (config-omp)
Command History
Release Modification
Cisco IOS XE Release 17.6.1a
Command qualified for use in Cisco SD-WAN Manager CLI templates.
The following example shows how to set the OMP administrative distance to 165:
Device# config-transaction
Device(config)# sdwan
Device(config-sdwan)# omp
Deviced(config-omp)# distance 165
ecmp-limit (omp)
To configure the maximum number of OMP paths that can be installed in the vEdge router's route table (on vEdge routers only), use the ecmp-limit command in OMP configuration mode. To remove the maximum number of OMP routes that can be installed in the vEdge router's route table, use the no form of this command.
ecmp-limit number-of-paths
no ecmp-limit number-of-paths
Syntax Description
number-of-paths
Maximum number of OMP paths that can be installed in the vEdge router's route table. Each TLOC consists of a IP address and color.
You can specify between 1 to 16 routes.
Command Default
4 paths are advertised.
Command Modes
OMP configuration (config-omp)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as 4294967295
  send-path-limit 16
  ecmp-limit 16
  graceful-restart
  no as-dot-notation
  timers
   holdtime 65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer 3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
  address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis 
graceful-restart (omp)
To control graceful restart for OMP, use the graceful-restart command in OMP configuration mode. To remove graceful restart for OMP, use the no form of this command.
graceful-restart
no graceful-restart
Command Default
Graceful restart for OMP is enabled on all routers.
Command Modes
OMP configuration (config-omp)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as 4294967295
  send-path-limit 16
  ecmp-limit 16
  graceful-restart
  no as-dot-notation
  timers
   holdtime 65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer 3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
  address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis 
no shutdown (omp)
To enable OMP on a router, use the no shutdown command in OMP configuration mode. To disable OMP on a router, use shutdown .
no shutdown
shutdown
Command Default
OMP is enabled by default on all routers.
Command Modes
OMP configuration (config-omp)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as 4294967295
  send-path-limit 16
  ecmp-limit 16
  graceful-restart
  no as-dot-notation
  timers
   holdtime 65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer 3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
  address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis 
omp
To configure Cisco SD-WAN Overlay Management Protocol (OMP) for a router, use the omp command in SD-WAN configuration mode. To remove OMP configuration from a router, use the no form of this command.
omp
no omp
Command Default
OMP is enabled on all Cisco Catalyst SD-WAN routers and Cisco SD-WAN Controllers.
Command Modes
SD-WAN configuration (config-sdwan)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as       4294967295
  send-path-limit  16
  ecmp-limit       16
  graceful-restart
  no as-dot-notation
  timers
   holdtime               65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer              3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
   address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
 
outbound tloc-color
To enable Cisco SD-WAN controller route filtering by TLOC color, use the outbound tloc-color command in filter route configuration mode. To disable route filtering, use the no form of the command.
outbound tloc-color
no outbound tloc-color
Command Default
The command is disabled.
Command Modes
filter route configuration (config-filter-route)
Command History
Release Modification
Cisco IOS XE Release 17.11.1a
This command was introduced.
Example
vsmart# config
Entering configuration mode terminal
vsmart(config)# omp 
vsmart(config-omp)# filter-route
vsmart(config-filter-route)# outbound tloc-color
vsmart(config-filter-route)# exit
vsmart(config-omp)# exit
vsmart(config)# 
The following example shows the same configuration using a CLI template in Cisco SD-WAN Manager:
omp
 filter-route
  outbound tloc-color
!
overlay-as (omp)
To configure a BGP Autonomous System (AS) number that OMP advertises to the BGP neighbors of a router, use the overlay-as command in OMP configuration mode. To remove a BGP AS number that OMP advertises to the BGP neighbors of a router, use the no form of this command.
overlay-as as-number
no overlay-as
Syntax Description
as-number
Local AS number to advertise to the router's BGP neighbors. You can specify the AS number in 2-byte ASDOT notation (1 through 65535) or in 4-byte ASDOT notation (1.0 through 65535.65535).
Command Default
No AS number is configured.
Command Modes
OMP configuration (config-omp)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
Usage Guidelines
When OMP routes are redistributed into BGP, the confgured AS number is prepended to the BGP AS path.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as 4294967295
  send-path-limit 16
  ecmp-limit 16
  graceful-restart
  no as-dot-notation
  timers
   holdtime 65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer 3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
  address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis 
send-path-limit (omp)
To configure the maximum number of equal-cost routes that are advertised per prefix, use the send-path-limit command in OMP configuration mode. To remove the maximum number of equal-cost routes that are advertised per prefix, use the no form of this command.
send-path-limit number-of-routes
no send-path-limit number-of-routes
Syntax Description
number-of-routes
Maximum number of equal-cost routes that a router advertises to a Cisco SD-WAN controller or that a Cisco SD-WAN controller redistributes to routers. A route is a route–TLOC tuple. Each TLOC consists of an IP address, color, and encap.
Beginning with Cisco SD-WAN Controllers Release 20.8.x, for a Cisco SD-WAN controller operating within a Hierarchical SD-WAN architecture, the controller can provide up to 32 routes to edge devices. When an edge device installs the routes, it uses the OMP algorithm to select the best 16 routes, and forwards traffic on those routes.
Range: 1 to 16 routes in most Cisco Catalyst SD-WAN overlay networks. For a Cisco SD-WAN controller operating within a Hierarchical SD-WAN architecture, the range is 1 to 32.
Command Default
4 routes are advertised.
Command Modes
OMP configuration (config-omp)
Command History
Release
Modification
Cisco IOS XE Release 17.2.1v
Command qualified for use in Cisco vManage CLI templates.
Cisco SD-WAN controller, Cisco SD-WAN Controllers Release 20.8.x
Increased the route limit to 32 when used for a Cisco SD-WAN controller operating within a Hierarchical SD-WAN architecture.
The following example shows how to configure OMP on a router:
sdwan
 omp
  no shutdown
  overlay-as 4294967295
  send-path-limit 16
  ecmp-limit 16
  graceful-restart
  no as-dot-notation
  timers
   holdtime 65535
   advertisement-interval 65535
   graceful-restart-timer 43200
   eor-timer 3600
  !
  address-family ipv4
   advertise bgp
   advertise ospf external
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis
  !
  address-family ipv6
   advertise bgp
   advertise connected
   advertise static
   advertise eigrp
   advertise lisp
   advertise isis 
timers
To configure OMP timers on Cisco IOS XE Catalyst SD-WAN devices and Cisco SD-WAN Controllers, use timers command. When you change an OMP timer on a device, the BFD sessions on that device go down and then come back up. To disable timers, use the no form of this command.
timers [ advertisement-interval interval | eor-timer eor-timer | graceful-restart-timer restart-timer | holdtime holdtime ]
no timers
Syntax Description
eor-timer seconds
End-of-RIB Timer:
Specifies how long to wait after an OMP session has gone down and then come back up to send an end-of-RIB (EOR) marker. After this marker is sent, any routes that weren’t refreshed after the OMP session came back up are considered to be stale and are deleted from the route table.
Range: 1–3600 seconds (1 hour)
Default: 300 seconds (5 minutes)
graceful-restart-timer seconds
Graceful Restart Timer:
Specifies how often the OMP information cache is flushed and refreshed. To disable OMP graceful restart, use the no omp graceful-restart command.
Note
  The graceful-restart-timer is peer driven. That is, WAN edge waits for the timer configured on Cisco vSmart to expire before removing the stale routes from the OMP table and Cisco vSmart waits for the timer configured on WAN Edge.
Range: 1–604800 seconds (168 hours, or 7 days)
Default: 43200 seconds (12 hours)
holdtime seconds
Holdtime Interval:
Specifies how long to wait before closing the OMP connection to a peer. If the peer doesn’t receive three consecutive keepalive messages within the specified hold time, the OMP connection to the peer is closed. (Note that the keepalive timer is one-third the hold time and isn’t configurable.) If the local device and the peer have different hold time intervals, the higher value is used. If you set the hold time to 0, the keepalive and hold timers on the local device and the peer are set to 0. The hold time must be at least two times the hello tolerance interval set on the WAN tunnel interface in VPN 0. To configure the hello tolerance interval, use the hello-tolerance command.
Range: 0–65535 seconds
Default: 60 seconds
advertisement-interval seconds
Update Advertisement Interval:
Configures the amount of time between OMP Update packets.
Range: 0–65535 seconds
Default: 1 second
Command Default
Command Modes
OMP configuration mode
Command History
Release Modification
Cisco IOS XE Release 17.6.1a
Command qualified for use in Cisco SD-WAN Manager CLI templates.
The following commands configure OMP timers on a Cisco IOS XE Catalyst SD-WAN device.
sdwan
omp
no shutdown
graceful-restart
no as-dot-notation
timers
holdtime 65535
advertisement-interval 65535
graceful-restart-timer 43200
eor-timer 3600
exit
!
tloc-color-compatibility
To override the default compatibilities of TLOC colors, use the tloc-color-compatibility command in system configuration mode. To cancel the configuration, use the no form of the command.
tloc-color-compatibility { compatible first-color second-color | incompatible first-color second-color }
no tloc-color-compatibility { compatible first-color second-color | incompatible first-color second-color }
Syntax Description
compatible first-color second-color
Configure two TLOC colors to be compatible, even if they are incompatible by default.
incompatible first-color second-color
Configure two TLOC colors to be incompatible, even if they are compatible by default.
Command Default
The command has no default.
Command Modes
system configuration (config-system)
Command History
Release Modification
Cisco IOS XE Release 17.11.1a
This command was introduced.
Usage Guidelines
Using route filtering, Cisco SD-WAN controllers can reduce the number of routes that they advertise to routers in the network, to exclude routes that are not relevant to a particular device. The filtering is based on the colors of TLOCs on each device: For each individual device, the Cisco SD-WAN controller does not advertise routes that are not compatible with any of the device’s TLOCs. For example, if a router only has a TLOC with color mpls, which is a private color, then a Cisco SD-WAN controller does not advertise a route for a TLOC of with the public-internet color, because the router cannot resolve this public route.
Example
This example, executed on a Cisco SD-WAN controller, does the following:
Configures the lte and private1 TLOC colors to be compatible
Configures the private1 and private2 TLOC colors to be compatible
Configures the lte and default TLOC colors to be incompatible
Configures the lte and 3g TLOC colors to be incompatible
vsmart(config)# system 
vsmart(config-system)# host-name vm1
vsmart(config-system)# tloc-color-compatibility
vsmart(config-tloc-color-compatibility)# compatible lte private1 
vsmart(config-compatible-lte/private1)# exit
vsmart(config-tloc-color-compatibility)# compatible private1 private2
vsmart(config-compatible-private1/private2)# exit
vsmart(config-tloc-color-compatibility)# incompatible lte default
vsmart(config-incompatible-lte/default)# exit
vsmart(config-tloc-color-compatibility)# incompatible lte 3g
vsmart(config-incompatible-lte/3g)# exit
vsmart(config-tloc-color-compatibility)# exit
vsmart(config-system)# exit
vsmart(config)# 
The following example shows the same configuration using a CLI template in Cisco SD-WAN Manager:
system
 host-name vm1
 tloc-color-compatibility
  compatible lte private1
  !
  compatible private1 private2
  !
  incompatible lte default
  !
  incompatible lte 3g
  !
 !
To reverse a compatible or incompatible command, use the no form, as follows:
vsmart(config-tloc-color-compatibility)# no compatible lte private1
Was this Document Helpful?
Yes No
Feedback
Customers Also Viewed
Routing Configuration Guide for vEdge Routers, Cisco SD-WAN Release 20.x --- Unicast Overlay Routing
Cisco SD-WAN Routing Configuration Guide, Cisco IOS XE Release 17.x --- Unicast Overlay Routing
Cisco SD-WAN Command Reference --- Configuration Commands
+ Show 2 More
Contact Cisco
Open a Support Case
(Requires a Cisco Service Contract)