Install and Upgrade Guides
Cisco SD-WAN Getting Started Guide
Bias-Free Language
Book Contents
Translations
Download
Print
Updated:
November 14, 2019
Chapter: Hardware and Software Installation
Chapter Contents
Table 1. Feature History
Feature Name
Release Information
Description
Generate a Bootstrap File For Cisco IOS XE SD-WAN Devices Using the CLI
Cisco IOS XE Release 17.3.1a
This feature enables you to generate a minimum bootstrap configuration file directly on a device, that enables a device to reconnect to the controller in case the full configuration is ever lost or removed.
Server Recommendations
Device Configuration Reset of Cisco IOS XE SD-WAN devices after Adding or Removing Modules
On-Site Bootstrap Process for Cisco SD-WAN Devices
On-Site Bootstrap Process for Cisco vEdge 5000 using SHA2 Enterprise Certificates
Generate a Bootstrap File For Cisco IOS XE SD-WAN Devices Using the CLI
One Touch Provisioning: Onboard Cisco IOS XE SD-WAN Devices Using Generic Bootstrap Configuration
Installing Cisco SD-AVC, Cisco vManage 20.1.1 and Earlier
Install Cisco SD-AVC, Cisco vManage Release 20.3.1 and Later
Software Installation and Upgrade for Cisco IOS XE Routers
Recover the Default Password
Software Installation and Upgrade for vEdge Routers
Upgrade Memory and vCPU Resources on a Virtual Machine Hosting Cisco vManage
Use Software Maintenance Upgrade Package on Cisco IOS XE SD-WAN Devices
Server Recommendations
This topic links to the hardware recommendations for the Cisco vBond Orchestrator server, vEdge Cloud router server, Cisco vManage server, and Cisco vSmart Controller server: Cisco SD-WAN Controller Compatibility Matrix and Recommended Computing Resources.
vEdge Cloud Router Server Recommendations
Refer to vEdge Cloud Datasheet.
Device Configuration Reset of Cisco IOS XE SD-WAN devices after Adding or Removing Modules
Prerequisites
You should have a basic knowledge of router modules hardware installation. For information on how to insert or remove modules from a platform, see the respective platform or module documentation.
OIR Support

Note
OIR is not supported on Cisco IOS XE SD-WAN devices.
Online Insertion and Removal (OIR) enables you to replace parts in a Cisco device without affecting the system operation. When a module is inserted, power is available on the module, and it initializes itself to start working.
Hot swap functionality allows the system to determine when a change occurs in the unit's physical configuration, and reallocate the unit's resources to allow all interfaces to function adequately. This feature allows interfaces on the module to be reconfigured while other interfaces on the router remain unchanged.
The software performs the necessary tasks involved in handling the removal and insertion of the module. A hardware interrupt is sent to the software subsystem when a hardware change is detected, and the software reconfigures the system as follows:
When a module is inserted, it is analyzed and initialized in such a way that the end user can configure it properly. The initialization routines used during OIR are the same as those called when the router is powered on. System resources, also handled by software, are allocated to the new interface.
When a module is removed, the resources associated with the empty slot must either be freed or altered to indicate the change in its status.
Reset Device Configuration
When a module is inserted or removed from your Cisco IOS XE SD-WAN devices, you must perform a device configuration reset using the CLI to keep Cisco IOS XE SD-WAN device synchronized with the physical change. For more information about resetting the controller mode configuration, see Controller Mode Configuration Reset.
On-Site Bootstrap Process for Cisco SD-WAN Devices
The on-site bootstrap process involves generating a bootstrap configuration file that loads from a bootable USB drive or from internal boot flash to a device that supports SD-WAN. When the device boots, it uses the information in the configuration file to come up on the network.
The on-site bootstrap process consists of this general workflow:
Use Cisco vManage to generate a configuration file
Copy the configuration file to a bootable USB drive and plug the drive into a device, or copy the configuration to the bootflash of a device
Boot the device
If the configuration file is on both an inserted USB drive and on the bootflash, a device gives priority to the configuration file on the bootflash.
Device Requirements
A device that you configure by using the on-site bootstrap process must meet these requirements:
A supported SD-WAN image must be installed on the device
The device must be in in its factory state with no added configuration
Perform the On-Site Bootstrap Process
To perform the on-site bootstrap process for a device, follow these steps:
Upload the Chassis ID and the serial number of the device to Cisco vManage.
For instructions, see Upload the vEdge Serial Number File.
From the Cisco vManage menu, choose Administration > Settings and make sure that the Organization Name and the Cisco vBond Orchestrator IP address are configured properly.
If you are using your own enterprise root certificate authority (CA) for device certification in your network, take these actions in Cisco vManage:
From the Cisco vManage menu, choose Administration > Settings.
Click Edit in the WAN Edge Cloud Certificate Authorization row.
Click Manual.
Click Save.
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates and create a template for the device.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is called Feature.
Perform the following steps:
From the Cisco vManage menu, choose Configuration > Devices.
For the desired device, click ... and choose Generate Bootstrap Configuration.
In the dialog box, choose Cloud-init and click OK.
The system generates a Multipurpose Internet Mail Extensions (MIME) file and displays its contents in a pop-up window. This file contains system properties for the device, the root CA if you are using an enterprise root CA, and configuration settings from the template that you created.
In the MIME file pop-up window, click Download.
The system downloads the file to your local system and saves it in your directory for downloads. The file name is chassis.cfg, where chassis is the device chassis ID that you uploaded in Step 1.

Note
As an alternative to this step, you can copy the contents of the MIME file from the pop-up window to a text file, save the text file with the name ciscosdwan.cfg (case sensitive), and then skip to Step 8.

Note
For hardware devices, use the bootstrap file name as ciscosdwan.cfg. This file is generated by Cisco vManage and includes UUID, but does not include OTP. For software devices (CSR and ISRv), and OTP-authenticated devices such as ASR1002-X, use the bootstrap file name as ciscosdwan_cloud_init.cfg. This file contains the OTP but not the UUID validation for ciscosdwan_cloud_init.cfg.
If you downloaded the MIME file, rename it to ciscosdwan.cfg (case sensitive).

Note
This is the configuration file for the on-site bootstrap process.
Copy the ciscosdwan.cfg file to a bootable USB drive or to the bootflash of the device.

Note
The file must be named exactly as shown or the device will not read it.
If you are using a USB drive, plug the USB drive into the device.
Boot the device.
The device reads the configuration file from the USB drive or the bootflash and uses the configuration information to come up on the network. The device give priority to a configuration file that is on its bootflash.
On-Site Bootstrap Process for Cisco vEdge 5000 using SHA2 Enterprise Certificates
Table 2. Feature History
Feature Name
Release Information
Description
On-Site Bootstrap Process for Cisco vEdge 5000 using SHA2 Enterprise Certificates
Cisco SD-WAN Release 20.3.1
Cisco vManage Release 20.3.1
By default, a Cisco vEdge 5000 device uses an SHA1 certificate for authentication with controllers in the overlay network. With this feature, you can authenticate the device using an OTP and a Public Key, and install an SHA2 enterprise certificate on the device. By authenticating the device using an OTP and a Public Key and installing an SHA2 enterprise certificate, you can bypass SHA1 certificate authentication and secure the device against SHA1 vulnerabilities.
A Cisco vEdge 5000 device is equipped with a Trusted Platform Module (TPM 1.2) and uses SHA1 certificates for authentication while connecting to the overlay network. For information on the bootstrap process using SHA1 certificates, see On-Site Bootstrap Process for Cisco SD-WAN Devices.
From Cisco SD-WAN Release 20.3.1, while bootstrapping a Cisco vEdge 5000 device and connecting the device to the overlay network, you can authenticate the device using a One Time Password (OTP) and a Public Key, and install an SHA2 enterprise certificate on the device. By authenticating the device using an OTP and a Public Key and installing an SHA2 enterprise certificate, you can bypass SHA1 certificate authentication and secure the device against SHA1 vulnerabilities.
How Cisco vEdge 5000 is Authenticated using OTP and Public Key
Enter the public key for the device on Plug and Play Connect and generate the serial.viptela file.
Upload the serial.viptela file to Cisco vManage.
Cisco vManage generates a random authentication token for the device. Cisco vManage encrypts the authentication token using the device public key and populates it as the OTP in the <chassis>.config file.
Download the <chassis>.config file to a bootable USB drive and insert the USB drive into the device after performing a factory reset.
The device reads the <chassis>.config file, reads the encrypted digest from the OTP field, decrypts the digest using the device private key and obtains the authentication token.
The device disables AVNET/TPM1.2 SHA1 certificate authentication.
The device authenticates itself with Cisco vManage using the authentication token and establishes a control connection.
Cisco vManage pushes the initial configuration into the device.
Cisco vManage pushes the SHA2 enterprise certificate for the device and installs the certificate on the device.
Device reauthenticates itself to controllers using the SHA2 enterprise certificate and connects to controllers.
Points to Consider
After a Cisco vEdge 5000 device is authenticated with Cisco vBond Orchestrator or Cisco vManage using OTP, do not reboot the device until the SHA2 enterprise certificate is installed and validated. If the device reboots before the Enterprise Certificate is validated, restart the bootstrap procedure.
After a signed SHA2 enterprise certificate is installed on a Cisco vEdge 5000 device and the bootstrapping process is complete, if you perform a software reset, a configuration reset, or a factory reset, bootstrap the device again.
Every time you generate the Cloud-Init(Encrypted OTP) bootstrap configuration, you must download the new configuration file to a bootable USB drive.
Prerequisites
Ensure Enterprise Certificate authorization is configured.
From the Cisco vManage menu, choose Administration > Settings > Hardware WAN Edge Certificate Authorization.
Click Edit and ensure that Enterprise Certificate (signed by Enterprise CA) is selected. Click Save.
Ensure that the Public Key entry for the device is available on the PNP server before generating the serial.viptela file. For more information, see View or Add Public Key for a Cisco vEdge 5000 Device.
If a Cisco vEdge 5000 device is connected to the overlay network using SHA1 certificates, you must invalidate and remove the device from the overlay network before configuring the use of OTP, Public Key, and SHA2 enterprise certificate for authentication.
View or Add Public Key for a Cisco vEdge 5000 Device
On Cisco Software Central, log in to Plug and Play Connect using the required Smart and Virtual Accounts required to access the Cisco vEdge 5000 device.
In the Devices list, click on the serial number of the Cisco vEdge 5000 device.
The Device Information is displayed.
In the Device Information dialog box, check whether the device Public Key is available.
If the Public Key is not available, add the Public Key:
In the Devices list, select the Cisco vEdge 5000 device using the check box.
Click Edit.
The Edit Devices page is displayed.
In the Selected Devices area, click view/edit in the Public Key column.
The Public Key dialog box is displayed.
Enter the public key in the text box, or click Browse to upload a file containing the public key.
Click OK to save the public key and close the dialog box.
On the Edit Devices page, click Submit to attach the public key to the Cisco vEdge 5000 device.
Bootstrap Procedure
The on-site bootstrap process involves generating a bootstrap configuration file that loads from a bootable USB drive. When the Cisco vEdge 5000 device boots, it uses the information in the configuration file to connect to the overlay network.
From the Cisco vManage menu, choose Configuration > Devices > WAN Edge List.
Click Upload WAN Edge List.
In the Upload WAN Edge List dialog box, select the the Cisco vEdge 5000 serial number file to upload. Select Validate the uploaded vEdge list and send to controllers and click Upload.
The WAN Edge List is uploaded to controllers.
The Cisco vEdge 5000 device is added to the WAN Edge List.
Attach the device to a device configuration template.
From the Cisco vManage menu, choose Configuration > Templates.
Click Device and select a template.
For the desired template, click ... and choose Attach Devices. The Attach Devices dialog box opens.
In the Available Devices column, select a group, and search to select the Cisco vEdge 5000 device.
Click the arrow pointing right to move the device to the Selected Devices column.
Click Attach.
Configuration template is scheduled for the device.
Generate the bootstrap configuration for the newly added device.
From the Cisco vManage menu, choose Configuration > Devices.
Click WAN Edge List, select the Cisco vEdge 5000 device.
For the selected device, click ... and choose Generate Bootstrap Configuration.
In the Generate Bootstrap Configuration dialog box, select Cloud-Init(Encrypted OTP) and click OK.
Click Download to download the bootstrap configuration and save the file with a filename in the <ChassisNumber>.cfg format.
Copy the <ChassisNumber>.cfg file to a bootable USB drive.

Note
The USB drive must be of the FAT-32 format for Cisco vEdge 5000 device to recognize and auto-mount the drive.
Copy the <ChassisNumber>.cfg file to the home or parent directory of the USB drive.
Send the Cisco vEdge 5000 serial number file and OTP information to controllers.
From the Cisco vManage menu, choose Configuration > Certificates > WAN Edge List.
Click Send to Controllers to synchronize the WAN Edge list on all controllers.
The device serial number file and OTP information are sent to controllers.
(Optional) Verify the WAN Edge List on controllers using the command show orchestrator valid-vedges hardware-installed-serial-number prestaging .
vbond# show orchestrator valid-vedges hardware-installed-serial-number prestaging
                                                                                   HARDWARE
                                                                                    INSTALLED   SUBJECT
                                                                                    SERIAL      SERIAL
CHASSIS NUMBER  SERIAL NUMBER                     VALIDITY  ORG                     NUMBER      NUMBER
---------------------------------------------------------------------------------------------------------
193A0122170001  deaedf5d39919454fdfcc8470eccd8d8  valid     vIPtela Inc Regression  prestaging  N/A
Perform a factory reset of the Cisco vEdge 5000 device with a default image of Cisco SD-WAN Release 20.3.1 or later.
When the Cisco vEdge 5000 device is ‘Up’ (indicated by a status of ‘System: Up’ on the LCD display), insert the USB drive with <ChassisNumber>.cfg file.
The device reads the <ChassisNumber>.cfg file from the USB drive. Organization-name, Cisco vBond Orchestrator IP address, OTP token, and Enterprise root-ca are retrieved from the configuration file.
(Optional) Issue the show control local-properties command on the device to verify the information retrieved from the configuration file.
(Optional) If the device WAN interface is not assigned an IP address through DHCP, configure a static IP address and the routing information required to reach controllers.
The device connects to Cisco vBond Orchestrator and Cisco vManage after authentication using the OTP.
The device obtains the System IP address and the site ID from Cisco vManage configuration templates. If templates are not configured on Cisco vManage, configure the required system configuration on the device.
After the device connects to Cisco vManage, Cisco vManage retrieves the Enterprise Certificate Signing Request (CSR). From the Cisco vManage menu, choose Configuration > Certificates > WAN Edge List, the device certificate state is shown as CSR.
Download CSR.
From the Cisco vManage menu, choose Configuration > Certificates.
Select the Cisco vEdge 5000 device for which to sign a certificate.
For the selected device, click ... and select View Enterprise CSR.
To download the CSR, click Download.
Send the certificate to a third-party signing authority and have them sign it.
To install the certificate on the device, perform the following steps:
From the Cisco vManage menu, choose Configuration > Certificates > Controllers.
Click Install Certificate button located in the upper-right corner of the screen.
In the Install Certificate screen, paste the certificate into the Certificate Text field, or click Select a File to upload the certificate in a file.
Click Install.
The installed certificate serial number of the device is updated on the controllers.
From the Cisco vManage menu, choose Configuration > Certificates > WAN Edge List, the device certificate state is shown as installed.
(Optional) Check the WAN Edge list on the controller to confirm that the device serial number is installed.
vbond# show orchestrator valid-vedges hardware-installed-serial-number 12399910

                                                            HARDWARE
                                                            INSTALLED  SUBJECT
                SERIAL                                      SERIAL     SERIAL
CHASSIS NUMBER  NUMBER    VALIDITY  ORG                     NUMBER     NUMBER
--------------------------------------------------------------------------------
193A0122170001  18DB5D4F  valid     vIPtela Inc Regression  12399910   N/A
Remove the USB drive from the device.
Outcome
The Cisco vEdge 5000 device is added to the overlay network and connected to the controllers using the SHA2 Enterprise Certificate.
The device will use the installed SHA2 Enterprise Certificate after a reboot, a software upgrade, or a software downgrade to Cisco SD-WAN Release 20.3.1 or a later release. Use of SHA1 certificates is disabled.
Generate a Bootstrap File For Cisco IOS XE SD-WAN Devices Using the CLI
To establish connectivity with the Cisco SD-WAN controller, a device requires a minimum configuration. In most situations, this minimum bootstrap configuration (MBC) can be provided initially by plug-and-play (PnP). But in some situations, such as in remote sites where it may be preferable not to use PnP, it is helpful to have a saved bootstrap configuration that can connect the device to the controller.
The request platform software sdwan bootstrap-config save command saves the device configuration to the bootflash. The command can be used to save the configuration at any time, but it is intended for saving a minimum bootstrap configuration (MBC) file that enables the device to reconnect to the controller in case the full configuration is ever lost or removed.
When setting up a device, add to the configuration the details that are required to connect to the controller, and then use this command to save the MBC. The file is saved to this location:
bootflash:/ciscosdwan.cfg
Prerequisites
The controller root certificate is installed on the Cisco IOS XE SD-WAN device, to authenticate the device.
The device is physically connected to the WAN through one of its interfaces.
Procedure
On the Cisco IOS XE SD-WAN device, establish connectivity to Cisco vManage, by configuring the following:
System IP address
Domain ID
Site ID
sp-organization-name
organization-name
Cisco vBond Orchestrator IP address and port number
Tunnel with encapsulation configured as either GRE or IPSEC
Example:
system
system-ip 10.0.0.10
domain-id 1
site-id 200
admin-tech-on-failure
sp-organization-name CiscoISR
organization-name CiscoISR
vbond 10.0.100.1 port 12346
!
interface Tunnel1
no shutdown
ip unnumbered GigabitEthernet0/1/0
tunnel source GigabitEthernet0/1/0
tunnel mode sdwan
exit
sdwan
interface GigabitEthernet0/1/0
tunnel-interface
encapsulation ipsec
exit
exit
commit
Use show sdwan control connections to verify connectivity to the Cisco vManage, Cisco vSmart Controller, and Cisco vBond Orchestrator.
Use the request platform software sdwan bootstrap-config save command to save a bootstrap file to the device bootflash.
Example:
Device#request platform software sdwan bootstrap-config save
Saving bootstrap file 'bootflash:/ciscosdwan.cfg'...
Done
The configuration file is saved to this location:
bootflash:/ciscosdwan.cfg
One Touch Provisioning: Onboard Cisco IOS XE SD-WAN Devices Using Generic Bootstrap Configuration
Table 3. Feature History
Feature Name
Release Information
Description
One Touch Provisioning: Onboard Cisco IOS XE SD-WAN Devices Using Generic Bootstrap Configuration
Cisco IOS XE Release 17.4.1a
Cisco vManage Release 20.4.1
You can generate a generic bootstrap configuration on Cisco vManage and use this configuration to onboard multiple Cisco IOS XE SD-WAN devices. When you boot a device with the generic bootstrap configuration, the device is listed on Cisco vManage as an unclaimed WAN edge device. To complete the onboarding, claim the device on Cisco vManage and attach a device template that configures the system IP address and site ID.
Overview of Generic Bootstrap Configuration
To onboard a Cisco IOS XE SD-WAN device to the Cisco SD-WAN overlay network, you generate a bootstrap configuration on Cisco vManage and boot the device with this configuration. After the device connects to Cisco vManage, you complete the onboarding using the Cisco vManage GUI. The bootstrap configuration contains device-specific configuration settings, requiring you to generate a bootstrap configuration for each device that you must onboard. From Cisco IOS XE Release 17.4.1a, you can use a generic bootstrap configuration to onboard multiple Cisco IOS XE SD-WAN devices.
The generic bootstrap configuration omits device-specific details, such as the device UUID, and provides settings that a Cisco IOS XE SD-WAN device can use to connect to the Cisco vBond Orchestrator. When the device connects to the Cisco vBond Orchestrator, the device is listed as an unclaimed WAN edge device on Cisco vManage. To complete the onboarding, you must claim the device on Cisco vManage and attach a device template that configures the system IP and site ID. Cisco vManage authenticates the device using a certificate that is installed on the device as part of the generic bootstrap configuration.
The generic bootstrap configuration contains the following:
Organization name
WAN interface to be enabled on the Cisco IOS XE SD-WAN device
IP address of the Cisco vBond Orchestrator
Cisco vManage-signed certificate for authenticating the device.
To use generic bootstrap configuration to onboard a device, you must have a Dynamic Host Configuration Protocol (DHCP) server in the branch network where you are installing the device. The generic bootstrap configuration does not assign an IP address to the WAN interface. Instead, the configuration enables a DHCP client on the WAN interface so that the interface can acquire an IP address from a DHCP server in the branch network.
How the Generic Bootstrap Configuration Works
While generating the generic bootstrap configuration on Cisco vManage, you select the interface that will serve as the VPN 0 (WAN) interface on the Cisco IOS XE SD-WAN device.
Copy the generic bootstrap configuration file onto the device bootflash and reset the device. On reset, the device is initialized with the generic bootstrap configuration.
The bootstrap configuration enables a DHCP client on the designated VPN 0 interface. The interface acquires an IP address and related details from a DHCP server in the network.
The device connects to the Cisco vBond Orchestrator through the VPN 0 interface is listed as an unclaimed WAN edge device on the Cisco vBond Orchestrator and Cisco vManage.
When you claim the device on Cisco vManage, Cisco vManage authenticates the device using the certificate installed on the device as part of the bootstrap configuration. After authentication, the device is listed among the valid WAN edge devices on Cisco vManage and the Cisco vBond Orchestrator.
Attach and push a template containing the system IP and site ID to the device.
The device establishes control connections to Cisco vSmart Controllers and is added to the overlay network.
Onboard a Cisco IOS XE SD-WAN Device using Generic Bootstrap Configuration
Enable One Touch Provisioning:
From the Cisco vManage menu, choose Administration > Settings.
Check if One Touch Provisioning is Enabled. If Enabled, go to Step 2.
If One Touch Provisioning is Disabled, click Edit.
For the Enable Claim WAN Edges setting, choose Enabled and click Save.
From the Cisco vManage menu, choose Configuration > Devices > WAN Edge List.
Click Export Bootstrap Configuration.
In the Export Bootstrap Configuration dialog box, enter the VPN0 Interface name.

Note
The VPN 0 interface name may vary among Cisco IOS XE SD-WAN device models. Specify the interface name based on the model you wish to onboard.
Click Generate Generic Configuration.
Save the generic bootstrap configuration file.
The file is named in the format <filename>.cfg.
Rename the generic bootstrap configuration file as ciscosdwan.cfg.
Copy the ciscosdwan.cfg file to a bootable USB drive or to the bootflash of the device.
If you are using a USB drive, plug the USB drive into the device.
Reset the device software configuration by issuing the following commands on the CLI:
Device# request platform software sdwan config reset
Device# reload
Reboot the device.
While rebooting, the device reads the configuration file from the USB drive or the bootflash and applies the configuration.
The configuration enables the VPN 0 interface and initializes a DHCP client on the interface. The interface acquires an IP address from a DHCP server in the network.
The device connects to the Cisco vBond Orchestrator and is listed as an unclaimed WAN edge device on theCisco vBond Orchestrator and Cisco vManage.
On the Cisco vBond Orchestrator, you can view the unclaimed WAN edge devices by using the command show orchestrator unclaimed-vedges .
In Cisco vManage, you can view the unclaimed WAN edge devices by selecting Configuration > Devices > Unclaimed WAN Edges.
If the device is not listed as an unclaimed WAN edge device, check whether the device can connect to the Cisco vBond Orchestrator and correct any connectivity issues.
Claim the device on Cisco vManage:
From the Cisco vManage menu, choose Configuration > Devices > Unclaimed WAN Edges.
Choose the device you wish to claim and click Claim Device(s).
The device is removed from Unclaimed WAN Edges and listed on WAN Edge List.
On the Cisco vBond Orchestrator, the device is listed as a valid WAN edge device. You can view the valid WAN Edge devices by issuing the command show orchestrator valid-vedges .
Attach a configuration template to the device.
Ensure that the template includes the system IP address and the site ID.
Push the template to the device.
Result
The device connects to Cisco vSmart Controllers and is added to the overlay network.
To verify that the device has established control connections and is part of the overlay network, from the Cisco vManage menu, choose Monitor > Overview and click the number in the WAN Edges area.

Note
In Cisco vManage Release 20.6.x and earlier: To verify that the device has established control connections and is part of the overlay network, from the Cisco vManage menu, choose Dashboard > Main Dashboard and click WAN Edge devices in the Summary Pane.
Remove a Cisco IOS XE SD-WAN Device Onboarded Using Generic Bootstrap Configuration
Detach device from templates:
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates and select the template attached to the device.

Note
In Cisco vManage Release 20.7.x and earlier releases, Device Templates is called Device.
For the selected template, click ... and choose Detach Devices.
In the Available Devices column, select the device to be detached from the template.
Click the arrow pointing right to move the device to the Selected Devices column.
Click Detach.
Connect to the device using SSH. From the device SSH terminal, shut down the VPN 0 WAN interface by using the following commands:
Device(config)# interface vpn0-interface-name
Device(config-if)# shutdown
Invalidate the device:
From the Cisco vManage menu, choose Configuration > Certificates.
Click WAN Edge List and choose the device to invalidate.
In the Validate column, click Invalid.
Click OK to confirm the move to the invalid state.
Click Send to Controllers to send the chassis and serial number of the invalidated device to the controllers in the network. Cisco vManage displays the Push WAN Edge List screen showing the status of the push operation.
Delete the WAN edge device:
From the Cisco vManage menu, choose Configuration > Devices.
Click WAN Edge List and select the device you wish to remove.
For the selected device, click ... and choose Delete WAN Edge.
Click OK to confirm deletion of the device.
Installing Cisco SD-AVC, Cisco vManage 20.1.1 and Earlier

Note
Beginning with Cisco vManage Release 20.3.1/Cisco IOS XE Release 17.3.1a, the Cisco SD-AVC installation has changed. See Install Cisco SD-AVC, Cisco vManage Release 20.3.1 and Later.
Overview
Beginning with the 18.4 release, SD-WAN can optionally incorporate Cisco Software-Defined Application Visibility and Control (SD-AVC) on Cisco IOS XE SD-WAN devices. The SD-AVC network service operates as a container within Cisco vManage.
What are the benefits of this feature?
Cisco SD-AVC uses Cisco NBAR2 and other components that operate on devices in the network to provide:
Recognition of network application traffic for visibility, analytics, application-aware routing, and application-based policies, such as QoS and application-based firewall policy.
Analytics at the network level.
Cisco SD-AVC Installation Requirements for Cisco vManage
The following table describes the SD-AVC installation requirements.
Cisco vManage Installation Scenario
Requirements
Cisco vManage 18.4 on a cloud-based server, provided fully configured by the Cisco cloud operations team
The SD-AVC package is pre-installed by the Cisco cloud operations team.
Cisco vManage 18.4 on a self-managed cloud or local server
Install the SD-AVC package as described below.
Upgrading from an earlier version of Cisco vManage to Cisco vManage 18.4
Install the SD-AVC package as described below.
Enabling SD-AVC on Cisco vManage
Enable SD-AVC on Cisco IOS XE SD-WAN Devices
Enabling SD-AVC on Cisco vManage
Prerequisites
Download the latest container image for the SD-AVC network service. Save the file to an accessible location on the server hosting Cisco vManage. This container is required for the procedure. To download the container, open the Cisco Software Download page  and enter "SD-WAN". Select "Software-Defined WAN (SD-WAN)" from the results, then "SD-WAN" in the results. In the software packages available for download, select SD-AVC.
Ensure that routers in the network that are included in the SD-WAN topology have a DNS server configured.
The virtual machine in which Cisco vManage operates must have the following resources available to dedicate to the SD-AVC network service:
vCPU: 4
RAM: 5 GB
Storage: 40 GB
Procedure
Ensure that the downloaded SD-WAN image is compatible with your version of Cisco vManage.
Display the checksum for the compatible image, using the following API:
https://[vManage-IP-address]/dataservice/sdavc/checksum
Example: https://10.0.0.1/dataservice/sdavc/checksum
Verify that the checksum of the downloaded image matches this.
To upload the SD-AVC virtual service package to Cisco vManage:
From the Cisco vManage menu, choose Maintenance > Software Repository.
Click Virtual Images and select Upload Virtual Image to upload the SD-AVC package.
From the Cisco vManage menu, choose Administration > Cluster Management page.
For the desired host (the Cisco vManage portal on which you are enabling SD-AVC), click … and choose Edit.
In the Edit vManage dialog box, enter the username and password, using Cisco vManage credentials.
Select the checkbox for Enable SD-AVC. Click Update.
Cisco vManage prompts you to confirm before rebooting the device to apply the changes to the device. Click OK to confirm.
After the reboot, Cisco vManage comes up automatically and displays progress on the SD-AVC activation. Wait for the activation to complete.
(Optional) After installation is complete, you can verify that Cisco vManage has the SD-AVC virtual service installed and operating correctly.
From the Cisco vManage menu, choose Administration > Cluster Management.
In Service Configuration, in Cisco vManage row of the table, verify that the SD-AVC shows a green checkmark.
For information about Cisco vManage commands, see vManage Command Reference documentation.
Enable SD-AVC on Cisco IOS XE SD-WAN Devices
To enable SD-AVC on the Cisco IOS XE SD-WAN device, create a localized policy that enables app visibility and apply the policy to the template for the Cisco IOS XE SD-WAN device.
Prerequisites
A template exists for the Cisco IOS XE SD-WAN device (example: Cisco ASR 1001-X, Cisco ISR 4321).
TCP port 10501 destination traffic must be permitted.
Procedure
From the Cisco vManage menu, choose Configuration > Policies.
Click Localized Policy.
To add a policy and enable Application, follow the steps below:
Click Add Policy.
Click Next on the several screens (Create Groups of Interest, Configure Forwarding Classes/QOS, Configure Access Control Lists, Configure Route Policy) until the Policy Overview screen.
In the Policy Overview screen, enter a policy name and policy description.
Select Application.
Save the policy.
To add the localized Policy to the device template, follow the steps below:
From the Cisco vManage menu, choose Configuration > Templates.
For the device on which you have to enable SD-AVC, click … and select Edit from the menu.
Click Additional Templates.
Add the localized policy created in an earlier step of this procedure.
Click Update and proceed through the next screens to push the updated template to the device.
(Optional) After pushing the update to the device, you can check the status of SD-AVC on the device with one of the following commands.
show avc sd-service info summary
or
show avc sd-service info connectivity
Install Cisco SD-AVC, Cisco vManage Release 20.3.1 and Later
Installing or upgrading to Cisco vManage Release 20.3.1 automatically includes installation of Cisco SD-AVC as a component.
Overview
Beginning with the 18.4 release, SD-WAN can optionally incorporate Cisco Software-Defined Application Visibility and Control (SD-AVC) on Cisco IOS XE SD-WAN devices. The SD-AVC network service operates as a container within Cisco vManage.
Cisco SD-AVC must operate on only one Cisco vManage instance. In a Cisco vManage cluster, enable Cisco SD-AVC on only one instance of Cisco vManage.

Note
All relevant Cisco SD-AVC functionality is accessed through the Cisco vManage interface. Cisco SD-WAN does not support the use of a separate SD-AVC interface.
What are the benefits of this feature?
Cisco SD-AVC uses Cisco NBAR2 and other components that operate on devices in the network to provide:
Recognition of network application traffic for visibility, analytics, application-aware routing, and application-based policies, such as QoS and application-based firewall policy.
Analytics at the network level.
Enable Cisco SD-AVC, Cisco vManage Release 20.3.1 and Later
Enable SD-AVC on Cisco IOS XE SD-WAN Devices
Enable Cisco SD-AVC Cloud Connector
Enable Cisco SD-AVC, Cisco vManage Release 20.3.1 and Later
Prerequisites
Ensure that routers in the network that are included in the Cisco SD-WAN topology have a DNS server configured.

Note
Cisco SD-AVC must operate on only one Cisco vManage instance. In a Cisco vManage cluster, enable Cisco SD-AVC on only one instance of Cisco vManage.
To enable Cisco SD-AVC, perform the following steps.
From the Cisco vManage menu, choose Administration > Cluster Management.
For the desired host (the portal on which you are enabling SD-AVC), click ... and select Edit.
In the Edit vManage pop-up window, select the checkbox for Enable SD-AVC.

Note
The Edit vManage pop-up window provides an option for disabling the application server. After disabling the application server, you cannot later enable other services using this method. If you need to disable the application server, do not do this at the same time that you enable other features.
Enter the username and password, using Cisco vManage credentials. Cisco vManage reboots the device.
After the reboot, Cisco vManage comes up automatically and displays progress on the SD-AVC activation. Wait for the activation to complete.
(optional) After installation is complete, you can verify that Cisco vManage has the SD-AVC virtual service installed and operating correctly.
From the Cisco vManage menu, choose Administration > Cluster Management.
Click Service Configuration, in the vManage row of the table, verify that SD-AVC shows a green checkmark.
Enable SD-AVC on Cisco IOS XE SD-WAN Devices
To enable SD-AVC on the Cisco IOS XE SD-WAN device, create a localized policy that enables app visibility and apply the policy to the template for the Cisco IOS XE SD-WAN device.
Prerequisites
A template exists for the Cisco IOS XE SD-WAN device (example: Cisco ASR 1001-X, Cisco ISR 4321).
TCP port 10501 destination traffic must be permitted.
Procedure
From the Cisco vManage menu, choose Configuration > Policies.
Click Localized Policy.
To add a policy and enable Application, follow the steps below:
Click Add Policy.
Click Next on the several screens (Create Groups of Interest, Configure Forwarding Classes/QOS, Configure Access Control Lists, Configure Route Policy) until the Policy Overview screen.
In the Policy Overview screen, enter a policy name and policy description.
Select Application.
Save the policy.
To add the localized Policy to the device template, follow the steps below:
From the Cisco vManage menu, choose Configuration > Templates.
For the device on which you have to enable SD-AVC, click … and select Edit from the menu.
Click Additional Templates.
Add the localized policy created in an earlier step of this procedure.
Click Update and proceed through the next screens to push the updated template to the device.
(Optional) After pushing the update to the device, you can check the status of SD-AVC on the device with one of the following commands.
show avc sd-service info summary
or
show avc sd-service info connectivity
Enable Cisco SD-AVC Cloud Connector
Table 4. Feature History
Feature Name
Release Information
Description
Cisco SD-AVC Cloud Connector
Cisco IOS XE Release 17.3.1a
Cisco vManage Release 20.3.1
When enabling Cloud onRamp for SaaS to manage Office 365 traffic, you can limit best path selection to apply only to some Office 365 traffic, according to the Office 365 traffic categories defined by Microsoft, or to include all Office 365 traffic.
The Cisco SD-AVC Cloud Connector provides support for this functionality.
Update to the SD-AVC Cloud Connector Enablement
Cisco vManage Release 20.10.1
Beginning with this release, enabling the Cloud Connector requires a cloud gateway URL and a one-time password (OTP) instead of a client ID and client secret.
Before You Begin
Before Cisco vManage Release 20.10.1, enabling Cloud Connector required client ID and client secret credentials. From Cisco vManage Release 20.10.1, it requires a cloud gateway URL and OTP. An advantage to using an OTP is that, in contrast to a client secret, it does not expire. See the following table for details about the credentials required for different releases, upgrade scenarios, and hosting options.
Table 5. Requirements to Enable SD-AVC Cloud Connector
Releases
Cisco vManage Hosting
Requirements to Enable Cloud Connector
Cisco vManage Release 20.3.1 to Cisco vManage Release 20.9.x
All hosting options
Required credentials:
Client ID
Client secret
(As explained in the procedure, open the Cisco API Console page to create Cloud Connector credentials if you do not already have credentials.)
Note
  When you receive a message in Cisco vManage indicating that SD-AVC credentials are expiring, return to the Cisco API Console and create new Cloud Connector credentials.
Other requirements:
Enable SD-AVC in cluster management, as described here.
Upgrade an existing instance to Cisco vManage Release 20.10.1 from an earlier release
Cisco-hosted
Required credentials:
Cloud gateway URL:
Use: https://datamanagement-us-01.sdwan.cisco.com/validate_sdavc/
OTP:
Use the Cisco SD-WAN Self-Service Portal to get the OTP. See the Cisco SD-WAN Self-Service Portal Configuration Guide for details.
Other requirements:
Enable SD-AVC in cluster management, as described here.
Self-managed, hosted in a public cloud, a private cloud, or on-premises
Required credentials:
If Cloud Connector was already enabled at the time of the upgrade, the client ID and client secret credentials continue to work until the client secret expires.
When the client secret expires, an alarm appears in Cisco vManage to indicate the expiration. At this point, enabling Cloud Connector requires the cloud gateway URL and OTP. Use https://datamanagement-us-01.sdwan.cisco.com/validate_sdavc/ for the URL, and open a TAC case to get the OTP. See the procedure in this section for information about opening a TAC case.
If Cloud Connector was not enabled at the time of the upgrade, enabling Cloud Connector requires the cloud gateway URL and OTP. Use https://datamanagement-us-01.sdwan.cisco.com/validate_sdavc/ for the URL, and open a TAC case to get the OTP. See the procedure in this section for information about opening a TAC case.
Other requirements:
Before enabling the Cloud Connector, enable SD-AVC in cluster management, as described here.
Fresh installation of Cisco vManage Release 20.10.1 and later
Cisco-hosted
Required credentials:
Cloud Connector is enabled by default, without requiring manual entry of credentials. You can use the Cisco SD-WAN Self-Service Portal to view the OTP if needed. See the Cisco SD-WAN Self-Service Portal Configuration Guide for details.
Other requirements:
Enable SD-AVC in cluster management, as described here.
Self-managed, hosted in a public cloud, a private cloud, or on-premises
Required credentials:
Cloud gateway URL:
Use https://datamanagement-us-01.sdwan.cisco.com/validate_sdavc/
OTP:
Open a TAC case to get the OTP. See the procedure in this section for information about opening a TAC case.
Other requirements:
Enable SD-AVC in cluster management, as described here.
Enable Cisco SD-AVC Cloud Connector
Cisco SD-AVC Cloud Connector is a necessary component for Cloud onRamp for SaaS to manage Office 365 traffic according to the Office 365 traffic category.
From the Cisco vManage menu, choose Administration > Settings.
In the SD-AVC area, if Cloud Connector is disabled, click Edit and Enabled.

Note
In Cisco vManage Release 20.9.x and earlier releases, the option is called SD-AVC Cloud Connector.

Note
If Cisco vManage is cloud-hosted by Cisco, this option does not appear and Cloud Connector is enabled automatically.
(This step applies to Cisco vManage Release 20.10.1 and later, and is handled automatically if Cisco vManage is Cisco-hosted.)
See the Before You Begin section that precedes these steps for details about the requirements for enabling the SD-AVC Cloud Connector in different scenarios. As noted there, enable SD-AVC in cluster management before enabling the Cloud Connector.
If you need to enter the cloud gateway URL, use: https://datamanagement-us-01.sdwan.cisco.com/validate_sdavc/
If you need to use the Cisco SD-WAN Self-Service Portal to get the OTP, see the Cisco SD-WAN Self-Service Portal Configuration Guide for details.
If you need to open a TAC case to receive the OTP, open https://mycase.cloudapps.cisco.com/case. The workflow for receiving the OTP requires the following:
Entitlement information.
Smart Account.
Virtual Account.
The organization name configured in Cisco vManage.
Cisco vManage geographic location: Americas, European Union (EU), or Asia-Pacific (APAC).
Technology: Use SD-WAN On-Prem for an on-prem installation or SDWAN - Cisco-Hosted for a Cisco-hosted installation.
SubTechnology: Use SDWAN Cloud Infra.
(For Cisco vManage Release 20.9.x and earlier releases) Enter the following credentials:
Client ID

Note
Click (i) for Client ID and open the Cisco API Console page in a browser window to create Cloud Connector credentials if you do not already have credentials.
Client Secret
Organization Name: Use the descriptive name that you entered on the Cisco API Console page in the Name of your application field.
(Releases earlier than Cisco vManage Release 20.10.1) For Affinity, you can select a geographical location for storing the Cloud Connector data. For organizations located in Europe, it is recommended to change the location to Europe, in accordance with EU General Data Protection Regulation (GDPR) regulations.
For Telemetry, you can optionally disable the collection of telemetry data.

Note
If Cisco vManage is cloud-hosted by Cisco, this option does not appear and telemetry is enabled automatically.
Create Credentials on the Cisco API Console
The following steps show how to create credentials in the Cisco API Console. These steps are provided here for convenience, and are subject to change.
On the Cisco API Console page, sign in using your Cisco credentials.
Click My Apps and keys. A page opens for registering a new application.
To register SD-AVC, follow the steps below:
Name of your application: Use any descriptive name. Save this name for a later step.
In the Application Type area, click Service.
In the Grant Type area, check the Client Credentials check box.
Check the Hello API check box.
In the Terms of Service section, check the check box to agree with the terms.
Click Register. The Cisco API Console page displays the Client ID and Client Secret details. Keep this page open to complete the procedure.

Note
These credentials expire after 90 days.
When you receive a message in Cisco vManage indicating that SD-AVC credentials are expiring, return to the Cisco API Console and create new Cloud Connector credentials.
Software Installation and Upgrade for Cisco IOS XE Routers
You can install up to two Cisco SD-WAN images on the same router.
Supported Hardware Platforms and Interface Modules
For supported Hardware platforms and interface modules, see Release Notes.

Note
For Cisco IOS XE SD-WAN devices from Cisco IOS XE Release 17.8.1a, if a device boots using the .bin file after a PnP or auto-install process completes, the device comes up with its day-0 configuration. The device then reloads automatically and goes into install mode.
Supported Crypto Modules
The following crypto modules are required for the ASR 1000 series routers:
ASR1001HX-IPSECHW, for the ASR 1001-HX
ASR1002HX-IPSECHW, for the ASR 1002-HX
Before You Begin
Download Cisco IOS XE SD-WAN Software for Cisco IOS XE SD-WAN Release 16.12 and Earlier
Install the Cisco IOS XE SD-WAN Software for Cisco IOS XE SD-WAN Release 16.12 and Earlier
Configure IOS XE Router Using CLI
Add IOS XE Devices to the Plug and Play Portal
Upgrading or Downgrading ROMMON
Perform Factory Reset
Before You Begin
Before you deploy an IOS XE router in the overlay network, review the following:
The controller devices—Cisco vBond Orchestrators, Cisco vManage instances, and Cisco vSmart Controllers—are running Cisco SD-WAN Software Release 18.3.
If you deploy both IOS XE and vEdge routers in the overlay network, the vEdge routers are running Release 17.2.1 or higher of the Cisco SD-WAN software. With these software versions, the vEdge and IOS XE software can interoperate, allowing BFD tunnels to be established between vEdge routers and IOS XE routers.
If you deploy both IOS XE and vEdge routers in the same site, the vEdge routers are running Cisco SD-WAN Software Release 18.3.
The ISR 4000 series router has at least 4 gigabytes (GB) of DRAM installed. It is recommended that the router have 8 GB of DRAM.
The ASR 1000 Cisco vBond Orchestrator series router has at least 8 GB of DRAM installed. The ASR 1002-HX router has at least 16 GB of DRAM installed.
The router bootflash has a minimum of 1.5 GB space available for the XE SD-WAN image or, beginning with Cisco IOX SD-WAN Release 17.10, the router bootflash has a minimum of one half of its disk space available for the XE SD-WAN image.
If using your enterprise root certificate to authenticate the router, the certificate is copied to the router's bootflash before installing the XE SD-WAN software.
All unsupported modules are removed from the router before installing the XE SD-WAN software. For a list of supported modules, see Supported Interface Modules and Supported Crypto Modules.
For information about deploying a Cisco ASR 1006-X with an RP3 module, see Cisco ASR 1006-X with an RP3 Module.
The updated device list is uploaded to Cisco vManage and sent to the Cisco vBond Orchestrator. To do so:
Obtain the router's chassis and board ID serial number by issuing the show crypto pki certificates CISCO_IDEVID_SUDI command at the system prompt. If running Release 16.6.1 or earlier on an ASR series router, issue the show sdwan certificate serial command.
Add the router's serial number to Plug and Play (PnP) Connect portal. See Add the IOS XE Router to the PnP Portal section for more details..
From the Cisco vManage menu, choose Configuration > Devices. Click Sync Smart Account to download the updated device list to Cisco vManage and send it to the Cisco vBond Orchestrator.
Device configuration templates are created and attached to the router using Cisco vManage Configuration > Templates. This ensures that the router can obtain a configuration and establish full control connections when it comes up.
If the router exceeds the unidirectional encrypted bandwidth of 250 Mbps and if the HSECK9 license is not already installed, the license file is copied to the router's bootflash and license installed on the router license install file path.
The ASR 1000 series, ISR 1000 series, and ISR 4000 series router is running the required version of the ROM monitor software (ROMMON), as shown in the following table. To verify the ROMMON version running on the router, issue the show rom-monitor or show platform command at the system prompt.
Hardware Platform
Required ROM Monitor Software Version
ASR 1000 series
16.3 (2r)
ISR 1000 series
16.9 (1r)
ISR 4000 series
16.7 (3r)
The ISRv router is running the minimum required version of the CIMC and NFVIS software, as shown in the following table:
Hardware Platform
CIMC
NFVIS
ISRv
3.2.4
3.8.1
Download Cisco IOS XE SD-WAN Software for Cisco IOS XE SD-WAN Release 16.12 and Earlier
Download the Cisco IOS XE SD-WAN Software
To download the Cisco IOS XE SD-WAN software from the Cisco site:
Go to https://www.cisco.com.
Click Support & Downloads from the menu on the left side.
In the Products and Downloads page, in the Downloads search box, choose Software-Defined WAN (SD-WAN).
In the Select a Product page, from the right-most pane, choose XE SD-WAN Routers.
From the right-most pane, select your router model.
Click the desired software release version to download it. The software image name has the format router-model-ucmk9.release-number
Copy the software image to an HTTP or FTP file server in your local network.
Install the Cisco IOS XE SD-WAN Software for Cisco IOS XE SD-WAN Release 16.12 and Earlier
All new Cisco IOS XE SD-WAN devices ships with the Cisco IOS XE SD-WAN software already installed.
If you have an existing Cisco IOS XE SD-WAN device, follow these steps to install the Cisco IOS XE SD-WAN software. The router reboots with the Cisco IOS XE SD-WAN image.
Download the Cisco IOS XE SD-WAN software image from the Cisco site. 
Upload the Cisco IOS XE SD-WAN software image from the file server to the bootflash of the device. Sample syntax for FTP is given below:
Device# (config)# ip ftp source-interface interface 
Device# copyftp:// username:password@server-IP/file-location bootflash:
TFTP:
Device(config)# ip tftp source-interface interface
Device(config)# ip tftp blocksize 8192
Device(config)#exit
Device#copy tftp: bootflash:  
SCP (assumes SSH is enabled):
Device# configure terminal
Device# (config)# ip scp server enable
FileServer$ scp filenameusername@router-IP:/filename
Ensure that the device is connected to a management console.
Create a backup of the current configuration that can be saved in the bootflash of the device.
Device# copy run bootflash:original-xe-config
Remove all existing boot statements and save the configuration.
ISR4K# (config)# no boot system ... 
ISR4K# wr mem
Verify that the BOOT variable is blank in the following output.
ISR4K# show bootvar 
BOOT variable = 
CONFIG_FILE variable does not exist 
BOOTLDR variable does not exist 
Configuration register is 0x2102 
Standby not ready to show bootvar
Add a boot variable that points to the Cisco IOS XE SD-WAN image.
Device(config)# boot system flash bootflash:
SDWAN-image 
Device(config)# exit
ISR4K# write memory
Verify that the BOOT variable points to the Cisco IOS XE SD-WAN image.
Device# show bootvar
BOOT variable =  bootflash:isr4300-ucmk9.16.10.1a.SPA.bin,1; 
CONFIG_FILE variable does not exist 
BOOTLDR variable does not exists 
Configuration register is 0x2102
Standby not ready to show bootvar
Remove all existing configurations from the router.
Device# write erase
Set the config-register to 0x2102.
Device# configure terminal 
Deovce(config)# config-register 0x2102 
Device(config)# end
Verify that the config-register is set to 0x2102 or that it will be set to 0x2102 at the next reboot.
Device# show bootvar
Reboot the router.
ISR4K# reload
Proceed with reload? [confirm] Yes
If prompted to save the configuration, enter No. The router reboots with the XE SD-WAN image.
If prompted to enter the initial configuration dialog, enter No.
--- System Configuration Dialog --- 
Would you like to enter the initial configuration dialog? [Yes/No]: No
If prompted to terminate auto-install, enter Yes.
Would you like to terminate auto-install? [Yes/No]: Yes
At the login prompt, log in with the default username and password as  admin.
The default password can be used once and then must be changed. If the initial configuration session times out or if the session is interrupted or terminated before the password is changed and saved, subsequent login attempts fail. To restore login access to the device, you must reset the password to its default value through the local console in ROMMON mode. Then the initial provision process must be restarted. For information about restoring the password, see Recover the Default Password.
Stop PnP and allow the Cisco IOS XE SD-WAN packages to install:
ISR4K# pnpa service discovery stop
Configure the upgrade on Cisco IOS XE SD-WAN device using request platform software sdwan software upgarde-confirm.
Router# request platform software sdwan software upgrade-confirm 
Router#
*Sep 21 00:26:29.242: %INSTALL-5-INSTALL_START_INFO: R0/0: install_engine: Started install commit PACKAGE
*Sep 21 00:26:30.153: %INSTALL-5-INSTALL_COMPLETED_INFO: R0/0: install_engine: Completed install commit PACKAGE
Router#
Ensure output of show sdwan software shows CONFIRMED state as user and no other value.
Router# sh sdwan software 
VERSION       ACTIVE  DEFAULT  PREVIOUS  CONFIRMED  TIMESTAMP                  
-------------------------------------------------------------------------------
16.12.1b.0.4  true    true     true      user       2019-09-21T00:24:22-00:00  

Total Space:388M Used Space:86M Available Space:298M
Configure the Cisco IOS XE SD-WAN device using request platform software sdwan software reset.
Router# request platform software sdwan software reset

*Sep 21 00:27:20.025: %INSTALL-5-INSTALL_START_INFO: R0/0: install_engine: Started install activate bootflash:isr4300-ucmk9.16.12.1b.SPA.bin
*Sep 21 00:27:43.105: %SYS-7-NV_BLOCK_INIT: Initialized the geometry of nvram
Router#
*Sep 21 00:28:47.233: %INSTALL-5-INSTALL_COMPLETED_INFO: R0/0: install_engine: Completed install activate PACKAGESep 21 00:28:54.240: %PMAN-5-EXITACTION: R0/0: pvp: Process manager

Note
Once you have installed this image, remember to use the command config-transaction to open CLI configuration mode. The config terminal command is not supported on SD-WAN routers.

Note
Downgrading to fresh install of old image versions is not supported. You can only downgrade to a previous existing version of old image. For example, if you have never installed Cisco IOS XE SD-WAN 16.10.3 on your Cisco IOS XE SD-WAN device, and if you try to downgrade from Cisco IOS XE SD-WAN 16.11.1 release to Cisco IOS XE SD-WAN 16.10.3 release then this operation is unsupported and results in unpredictable behavior. However, if you had a 16.10.3 image installed previously, then you could reactivate it by using the request platform software sdwan activate command.

Note
Data is migrated from an existing Cisco SD-WAN image to a new Cisco SD-WAN image only during an upgrade. After an upgrade is completed, there is no migration of data between different versions of installed images for both Cisco IOS XE SD-WAN and Cisco vEdge devices. For example, if you had installed 19.2.4 previously, and 20.3.2 is your current active image, then if you activate the 19.2.4 image, the additional configurations from 20.3.2 will not be migrated to 19.2.4.
Configure IOS XE Router Using CLI
If your Cisco IOS XE SD-WAN device is connected to a DHCP server, PnP runs automatically and Cisco vManage automatically configures the device after the control connections are up. To verify that the control connections are up and the device is validated, enter the following command at the system prompt:
Device# show sdwan control connections
If your IOS Ex router is connected to a DHCP server and you are not using PnP, or if your IOS XE router is not connected to a DHCP server on the WAN, configure the router manually using the CLI as shown in the following steps.
You also can configure the hostname by using the system host-name hostname command. Configuring the hostname is optional, but it is recommended because this name in included as part of the prompt in the CLI and it is used on various Cisco vManage screens to refer to the device. This command is not available on the device CLI but it is available when using the CLI device template.
Connect to the router using a management console.
Stop PnP to allow access to the CLI:
Device# pnpa service discovery stop
Enter configuration mode:
Device# config-transaction
Device(config)#
Configure the system IP address.
Device(config-system)# system-ip  ip-address
Cisco vManage uses the system IP address to identify the device so that the NMS can download the full configuration to the device.
Configure the numeric identifier of the site where the device is located:
Device(config-system)# site-id site-id
Configure the IP address of the Cisco vBond Orchestrator or a DNS name that points to the Cisco vBond Orchestrator. The Cisco vBond Orchestrator's IP address must be a public IP address, to allow the router to reach the Cisco vBond Orchestrator.
Device(config-system)# vbond (dns-name | ip-address)
Configure the organization name, which is the name that is included in the certificates on all devices in the overlay network. This name must be the same on all devices.
Device(config-system)# organization-name name
Configure the tunnel interface to use for overlay connectivity. Ensure that the tunnel interface ID does not conflict with any other interface IDs that may be auto-assigned by Cisco vManage. You can verify this in configuration preview.
Device(config)# interface Tunnel #    
Device(config-if)# ip unnumbered wan-physical-interface   
Device(config-if)# tunnel source wan-physical-interface    
Device(config-if)# tunnel mode sdwan

Note
If you are using Cisco vManage feature templates for your configuration, a tunnel interface is automatically assigned based on the WAN interface used.
If you switch to Cisco vManage mode from CLI mode, the tunnel interface you configured may change because Cisco vManage automatically assigns a tunnel interface number based on the WAN interface used. This change in tunnel number can cause the tunnel to go down before it comes up again when the configuration is pushed.
If the router is not connected to a DHCP server, configure the IP address of the WAN interface:
Device(config)# interface GigabitEthernet  #    
Device(config)# ip address  ip-address mask   
Device(config)# no shut   
Device(config)# exit
Configure tunnel parameters:
Device(config)# sdwan    
Device(config-sdwan)# interface  WAN-interface-name    
Device(config-interface-interface-name)# tunnel-interface   
Device(config-tunnel-interface)# color color/path-name    
Device(config-tunnel-interface)# encapsulation  ipsec
If an IP address is manually configured on the router, configure a default route:
Device(config)# ip route 0.0.0.0 0.0.0.0 next-hop-ip-address
If the Cisco vBond Orchestrator address was defined as a hostname, configure DNS:
Device(config)# ip domain lookup 
Device(config)# ip name-server dns-server-ip-address 
Save the changes and exit configuration mode:
Device(config)# commit and-quit 
Device# exit
If you are using a certificate signed by your enterprise root CA, install the certificate:
Device# request platform software sdwan root-cert-chain install bootflash: certificate
Verify that the control connections are up and the router is validated.
Device# show sdwan control connections 

PEER    PEER PEER         SITE  DOMAIN  PEER         PEER PRIV  PEER        PEER PUB                                            
TYPE    PORT SYSTEM IP    ID    ID      PRIVATE IP   PORT       PUBLIC IP   PORT     LOCAL COLOR               
--------------------------------------------------------------------------------------------------
vsmart  dtls 192.168.1.2  10    1       172.1.1.3    12346      172.1.1.3   12346     biz-internet                    
vbond   dtls -             0    0       172.1.1.4    12346      172.1.1.4   12346     biz-internet                     
vmanage dtls 192.168.1.3  10    0       172.1.1.2    12346      172.1.1.2   12346     biz-internet       
                         
                          CONTROLLER
                          GROUP
PROXY STATE  UPTIME       ID
------------------------------------       
  up         1:19:51:40   0
  up         1:19:51:45   0
  up         1:19:51:38   0
                             
You can now configure SD-WAN features on the router using Cisco vManage templates.
Add IOS XE Devices to the Plug and Play Portal
Table 6. Feature History
Feature Name
Release Information
Description
On Premises ZTP Server for Cisco SD-WAN
Cisco IOS XE Release 17.3.1a
Cisco vManage Release 20.3.1
This feature extends the on-premise Plug and Play implementation support to Cisco IOS XE SD-WAN routers.
To add a device to the Plug and Play portal:
If the device can reach the PNP portal, see Cisco Plug and Play Support Guide for Cisco SD-WAN Products.
If the device does not have access to the PNP portal, see Start the Enterprise ZTP Server and Prepare Routers for ZTP sections in the Cisco SD-WAN Overlay Network Bring-Up Process chapter.

Note
When devices are due for Return Materials Authorization (RMA), the device details are with Cisco PNP. However, you cannot delete these devices from the RMA list in Cisco vManage. Instead Cisco vManage administrator can mark the devices returned as invalidated as per RMA.
For information abour Cisco IOS XE Release 17.2 and later, see Install and Upgrade Cisco IOS XE Release 17.2 and Later.
Upgrading or Downgrading ROMMON
This section describes how to upgrade or downgrade the ROM monitor (ROMmon) version that is running on a device. Perform this procedure if you need to change a ROMmon version to a required version that is shown in the “Before You Begin” section.
To determine the ROMmon version that is running on a device, enter the following command:
Device# Show rom-monitor R0  
To upgrade or downgrade ROMmon, follow these steps:
Take either of these actions:
Load the ROMmon file into the device bootflash using a method such as SCP, FTP, TFTP, or a USB drive.
If you do not have out-of-band management access to the router, transfer the ROMmon file by using Cisco vManage CLI, as shown in the following example:
vManage# request execute vpn 0 scp -P 830 C1100-rommon-16-1r-SPA.pkg 
admin@router-ip-address:/bootflash/vmanage-admin/C1100-rommon-169-1r-SPA.pkg
Take either of these actions to verify that the ROMmon file that you loaded or transferred appears in the directory output:
If you loaded the ROMmon file into the device bootflash, enter the following command:
Device# dir bootflash
If you transferred the ROMmon file by using the Cisco vManage CLI, enter the following command:
vManage# dir bootflash:vmanage-admin
Enter the following command to set config-register to 0x2102:
Device# config-register 0x2102
Upgrade (or downgrade) the ROMmon file on your device by using the upgrade command as shown in the following examples:
Example upgrade command if you loaded the ROMmon file into the device bootflash:
Device# upgrade rom-monitor filename bootflash: C1100-rommon-169-1r-SPA.pkg R0
Example upgrade command if you transferred the ROMmon file by using Cisco vManage CLI:
vManage# upgrade rom-monitor filename bootflash:vmanage-admin/C1100-rommon-169-1r-SPA.pkg R0
After a series of messages pertaining to the upgrade display and the router prompt displays, enter the following command to reload the router:
Device# Reload
Enter the following command and verify that the output shows the new ROMmon version:
ISR4K# Show rom-monitor R0
Perform Factory Reset
This section describes the Factory Reset feature and how it can be used to protect or restore a router to an earlier fully functional state. For information on factory reset procedures on different platforms, see:
Cisco ASR 1000 Series Aggregation Services Routers
Cisco 4000 Series Integrated Services Routers
Cisco Cloud Services Router 1000V Series

Note
To perform factory-reset on a Cisco IOS XE SD-WAN ASR 1000 router, ensure that the router is booted in subpackages mode. Execute show version command and check the output for system image file to determine the booted image.
Device# show version
Cisco IOS XE Software, Version BLD_POLARIS_DEV_LATEST_20200303_002119_V17_X_X_XX
Cisco IOS Software [Amsterdam], ASR1000 Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), 
Copyright (c) 1986-2020 by Cisco Systems, Inc.
Compiled Tue 03-Mar-20 00:29 by mcpre

Cisco IOS-XE software, Copyright (c) 2005-2020 by cisco Systems, Inc.
All rights reserved. Certain components of Cisco IOS-XE software are
licensed under the GNU General Public License ("GPL") Version 2.0. The
software code licensed under GPL Version 2.0 is free software that comes
with ABSOLUTELY NO WARRANTY. You can redistribute and/or modify such
GPL code under the terms of GPL Version 2.0. For more details, see the
documentation or "License Notice" file accompanying the IOS-XE software,
or the applicable URL provided on the flyer accompanying the IOS-XE
software.

ROM: IOS-XE ROMMON

2KP-CEDGE uptime is 3 minutes
Uptime for this control processor is 5 minutes
System returned to ROM by Reload Command
System image file is "bootflash:packages.conf"
Recover the Default Password
The default password for a Cisco IOS XE SD-WAN device is admin. After using this password for the first time, the administrator must create a new password. If the initial configuration session times out or if the session is interrupted or terminated before a new password is created, subsequent login attempts fail. In this situation, you must recover the default password.
To recover the default password for a device, follow these steps:
Power the device down and then back up.
In the local console of the device, enter ROMMON mode.
Enter the following command to set the config-register value to 0x8000:
rommon 1 > confreg 0x8000
Power the device down and then back up so that your update takes effect.
Log in to the device with the user name and the password as admin.
In the local console of the device, enter SD-WAN config mode.
Enter the following command to set the config-register value to 0x2102:
Device# confreg 0x2102
In the local console of the device, enter privileged exec mode.
Take either of these actions:
For Cisco IOS XE SD-WAN 16.10 releases beginning with release 16.10.4 or for Cisco IOS XE SD-WAN 16.12 releases beginning with release 16.12.2:
Device# request platform software sdwan config reset
Device# reload
For Cisco IOS XE SD-WAN 16.10 releases earlier than release 16.10.4 or for Cisco IOS XE SD-WAN 16.12 releases earlier than 16.12.2:
Device# request platform software sdwan software reset
After the device comes back up, configure a new admin password.
Software Installation and Upgrade for vEdge Routers
This article describes how to install software on all Cisco vEdge devices—Cisco vManage instances, Cisco vSmart Controllers, Cisco vBond Orchestrators, and vEdge routers—and how to upgrade the software on devices already running the Cisco SD-WAN software.
Software Image Signing
Software Version Compatibility
Install the Software
Upgrade the Software
Best Practices for Software Upgrades
Obtain Software Images from Cisco SD-WAN
Add New Software Images to the Repository
Upgrade the Software Image
Activate a New Software Image
View Log of Software Upgrade Activities
Upgrade a Software Image from the CLI
Redundant Software Images
Downgrade a Cisco vEdge Device to an Older Software Image
Software Image Signing
Cisco SD-WAN software images are digitally signed to ensure that the images are official Cisco SD-WAN images and to guarantee that the code has not been altered or corrupted since the image was created and signed. All standard Cisco SD-WAN software images are signed, while patch images are not. Standard software images are identified with three numeric fields (such as 16.1.0) and patch software images are identified with four numeric fields (such as 16.1.0.1).
Signed images include a revocation mechanism so that Cisco SD-WAN can revoke an image if it is found to be dangerous, either due to a bug or a security flaw. These revocation mechanisms protect from attacks if you attempt to install a previously signed image that has a known vulnerability.
After you have installed a signed imaged onto a Cisco SD-WAN device, you can no longer install an unsigned image onto the device.
Software image signing is available in Releases 16.1 and later.
Software Version Compatibility
You can upgrade the software version on the controller devices—Cisco vManage instances, Cisco vSmart Controllers, and Cisco vBond Orchestrators—without upgrading the vEdge routers to the same version. However, the software version running on the controller devices must be compatible with the version running on the vEdge routers.
For a list of compatible versions on Controllers and vEdge routers, see Release Notes.

Note
All controller devices of the same type must run the same software version. That is, all Cisco vManage instances must run the same software version, all Cisco vSmart Controllers must run the same software version, and all Cisco vBond Orchestrators must run the same version.
Install the Software
Before you begin, download the software from the Cisco SD-WAN Support site.
You install software on Cisco SD-WAN devices when you first bring up the overlay network and add those devices to the network:
To install software on a Cisco vBond Orchestrator, see Create vBond VM Instance on ESXi or Create vBond VM Instance on KVM. During the process of creating the VM, you install the vBond.ova file.
To install software on a vEdge Cloud router, see Create vEdge Cloud VM Instance on AWS, Create vEdge Cloud VM Instance on ESXi, or Create vEdge Cloud VM Instance on KVM. During the process of creating the VM, you install the vEdge Cloud.ova file.
To install software on a Cisco vManage, see Create vManage VM Instance on ESXi or Create vManage VM Instance on KVM. During the process of creating the VM, you install vManage.ova file.
To install software on a Cisco vSmart Controller, see Create vSmart VM Instance on ESXi or Create vSmart VM Instance on KVM. During the process of creating the VM, you install the vSmart.ova file.
To install software on a hardware vEdge router, nothing is required. All vEdge hardware routers ship with the software already installed.
Upgrade the Software
From Cisco vManage, you can upgrade the software image running on a Cisco vEdge device in the overlay network and reboot it with the new software. You can do this for a single device or for multiple devices simultaneously.
To upgrade the software, you obtain the software images from Cisco SD-WAN, add the new software images to the repository located on either Cisco vManage or a remote server, and install the new software image on the device. The next reboot occurs immediately if you select the Activate and Reboot check box, or you can wait until the next regularly scheduled maintenance window. If an upgrade fails and the device does not come back up, Cisco vManage automatically reverts the device to the previously running software image.
Before you upgrade the software on Cisco vEdge devices, ensure that the devices are running the required software version.

Note
Cisco SD-WAN releases starting with Releases 18.4.5, 19.2.2, and 20.1.1 have a security lockout. When any of these software versions (or later) are installed and activated on a device, a 30-day timer is set for the removal of any old images that were previously installed on the device. After the timer expires, the old images are deleted. For example, if you install and activate Release 18.4.5, a 30-day timer starts on the previously installed Release 19.2.1 image, but not on Release 19.2.2. Similarly if you install and activate Release 19.2.2, a 30-day timer starts on the previously installed Release 18.4.4 image, but not on Release 18.4.5.
You can continue to activate an older image that is already installed, before the 30-day timer runs out. If the device restarts before the 30-day timer expires, the timer is reset.
See Cisco SD-WAN Command Reference guide for more information.
request software secure-boot set- Makes the system immediately delete old images* without waiting the 30 days.
request software secure-boot status- Displays the installed old images*.
request software secure-boot list- Prints a list of all old images* that are installed.
*old images= before releases 18.4.5, 19.2.2, and 20.1.1

Note
Cisco vManage downgrade is not supported. Ensure that you take a snapshot of the VM prior to upgrading Cisco vManage. To rollback to an earlier Cisco vManage release, revert to the snapshot.
For additional information and caveats regarding software upgrades, see Release Notes.
Best Practices for Software Upgrades
Upgrade the software from Cisco vManage rather than from the CLI.
If you are upgrading the software image on a remote Cisco vManage, the overlay network must already be up and operational.
If you are upgrading all devices in the overlay network, you must perform the upgrade in the following order:
Upgrade Cisco vManage instances.
Upgrade the Cisco vBond Orchestrators.
Upgrade one-half of the Cisco vSmart Controllers.
Have the upgraded Cisco vSmart Controllers run for at least one day (24 hours) to ensure that the Cisco vEdge devices and the overlay network are stable and running as expected.
Upgrade the remainder of the Cisco vSmart Controllers.
Upgrade 10 percent of the vEdge routers. For multirouter sites, it is recommended that you upgrade only one router per site.
Have the upgraded vEdge routers run for at least one day (24 hours) to ensure that the Cisco SD-WAN devices and the overlay network are stable and running as expected.
Upgrade the remainder of vEdge routers.
If the new software images are located on an FTP server, ensure that the FTP server can handle concurrent file transfers.
If the new software images are in the image repository on Cisco vManage, ensure that the WAN in which Cisco vManage is located has sufficient capacity for concurrent file transfers.
You cannot include Cisco vManage in a group software upgrade operation. You must upgrade and reboot Cisco vManage server by itself.
In a group software upgrade operation, you can upgrade up to 40 Cisco vEdge devices or Cisco IOS XE SD-WAN devices and reboot or activate upto 100 Cisco vEdge devices or Cisco IOS XE SD-WAN devices simultaneously (when the new image is available locally). These maximum numbers assume that Cisco vManage is idle and only upgrade and reboot operations are being carried out. In case of other management tasks occuring on Cisco vManage at the same time, the number of available sessions reduces.
When you are setting a software image to be the default software image, activate it first, before making it the default image.
Obtain Software Images from Cisco SD-WAN
To upgrade the software running on the devices in the overlay network, you must first obtain the new software packages from the Cisco SD-WAN website. To do so, go to http://www.cisco.com/go/support, log in to Cisco SD-WAN Support, and download the software packages for the new release. You can also download the software images to an FTP server in your network and, from Cisco vManage, point to the upgrade packages on the remote host.
For initial software installation, the software package names for Releases 16.1 and later have the following format, where x.x.x represents the Cisco SD-WAN software release version. These packages contain the virtual machines and the Cisco SD-WAN software.
vEdge Cloud router
viptela-x.x.x-edge-genericx86-64.ova (for ESXi Hypervisor)
viptela-edge-genericx86-64.qcow2 (for KVM Hypervisor)
Cisco vBond Orchestrator
viptela-edge-genericx86-64.ova (for ESXi Hypervisor)
viptela-edge-genericx86-64.qcow2 (for KVM Hypervisor)
Cisco vSmart Controller
viptela-smart-genericx86-64.ova (for ESXi Hypervisor)
viptela-smart-genericx86-64.qcow2 (for KVM Hypervisor)
Cisco vManage
viptela-vmanage-genericx86-64.ova (for ESXi Hypervisor)
viptela-vmanage-genericx86-64.qcow2 (for KVM Hypervisor)
The software upgrade package names for Releases 16.1 and later have the following format, where x.x.x represents the release version. The strings mips64 and x86_64 represent the underlying chip architecture.
vEdge router hardware—viptela-x.x.x-mips64.tar.gz
Cisco vBond Orchestrator, vEdge Cloud router, and Cisco vSmart Controller—viptela-x.x.x-x86_64.tar.gz
Cisco vManage—vmanage-x.x.x-x86_64.tar.gz
For Releases 15.4 and earlier, the software upgrade packages are in files with the extension .tar.bz2, or in the case of the vEdge 100 router, .tar.gz. The package names have the following format, where x.x.x represents the release version. The strings mips64 and x86_64 represent the underlying chip architecture.
vEdge router—viptela-x.x.x-mips64.tar.bz2
Cisco vBond Orchestrator and Cisco vSmart Controller—viptela-x.x.x-x86_64.tar.bz2
Cisco vManage—vmanage-x.x.x-x86_64.tar.bz2
Add New Software Images to the Repository
Once you have downloaded the new software packages from the Cisco SD-WAN website, upload them into Cisco vManage repository. If you downloaded the software images to an FTP server, from Cisco vManage, point to the upgrade packages on the remote host.
From the Cisco vManage menu, choose Maintenance > Software Repository.
Click Add New Software, and select the location from which to download the software image. The location can be:
Cisco vManage—To select an image stored on the local Cisco vManage.
Remote Server (preferred) —To select an image stored on a remote file server.
Remote Server – Cisco vManage—To select an image stored on a remote Cisco vManage. This location is available in Releases 17.2 and later.
If you select Cisco vManage, the Upload Software to Cisco vManage dialog box opens.
Click Browse to select the software images or Drag and Drop the images for vEdge routers, Cisco vSmart Controllers, or Cisco vManage.
Click Upload to add the images to Cisco vManage repository.
If you select Remote Server, the Location of Software on Remote Server dialog box opens.
Enter the version number of the software image.
Enter the URL of the FTP or HTTP server on which the images reside.
Click OK to point to the software images on the remote host.
If you select Remote Server – Cisco vManage, the Upload Software to Cisco vManage dialog box opens.
Enter the hostname of the Cisco vManage server.
Click Browse to select the software images or Drag and Drop the software image for vEdge routers, Cisco vSmart Controllerss, or Cisco vManage.
Click Upload to add the images to Cisco vManage repository.
The added software images are listed in Cisco vManage repository table and are available for installing on the devices. The table displays the name and type of image, when it was updated, and the URL.
For the desired software version, click ... and select Delete to delete the software version added to the list.
Upgrade the Software Image
After the software images are present in Cisco vManage image repository, you can upload the software image on a device:
From the Cisco vManage menu, choose Maintenance > Software Upgrade.
Click the check box and select one or more devices on which to upgrade the software image. To search for a device, use the Device Groups drop-down and/or the Search box.
Click Upgrade and the Software Upgrade dialog box opens.
From the Version drop-down, select the version of the software image you want to install. Cisco vManage and Remote Server are activated.
Select whether the software image is available on Cisco vManage or on the Remote Server.
If you select Remote Server in Step 5, choose the appropriate VPN for Cisco vSmart Controller/Cisco vManage and for vEdge, and continue with Step 8.
If you select Cisco vManage in Step 5, you can choose to automatically activate the new software image and reboot the device by selecting the Activate and Reboot check box. (Note that if you do not select the Activate and Reboot check box, the new software image is still installed but the device continues to use the existing software image. To activate the newly installed software image, see Activate a New Software Image below.)
Click Upgrade. A progress bar indicates the status of the software upgrade.
If the upgrade does not complete successfully within 60 minutes, it times out.
If the control connection to Cisco vManage does not come up within 15 minutes, Cisco vManage automatically reverts the device to the previously running software image.
Activate a New Software Image
If you select Activate and Reboot check box when uploading the software image, then when you click Upgrade, the new software activates automatically and the device reboots.
If you uploaded the software image from a Remote Server, or if you did not select Activate and Reboot check box when uploading the software image from Cisco vManage, the new image is installed on the device but the device continues to use the existing software image. To activate the new software image:
From the Cisco vManage menu, choose Maintenance > Software Upgrade.
Click the check box to select one or more devices on which to activate the new software image. To search for a device, use the Device Groups drop-down and/or the Search box.
Click Activate to activate the new software. The activation process reboots the device and upgrades it to the newly installed software.
If the control connection between the device and Cisco vManage does not come up within 15 minutes, Cisco vManage automatically reverts the device to the previously running software image.
View Log of Software Upgrade Activities
To view the status of software upgrades on each device and a log of related activities:
Upgrade a Software Image from the CLI
If you need to upgrade a software image directly on a device, or if you are not using Cisco vManage in your network, to upgrade the software image, you can either repeat the installation process or you can install the software image from within the CLI.
To upgrade the software image from within the CLI:
Configure the time limit for confirming that a software upgrade is successful. The time can be from 1 through 60 minutes.
Device# system upgrade-confirmminutes
Install the software:
vEdge# request software install  url 
/viptela- release -mips64.tar.bz2 [reboot] [vpn vpn‑id]
vSmart# request software install url/viptela- release 
-x86 _64.tar.bz2 [reboot] [vpn vpn‑id]
Specify the image location in one of the following ways:
The image file is on the local server:
/directory-path/
You can use the CLI's autocompletion feature to complete the path and filename.
The image file is on an FTP server.
ftp://hostname/
The image file is on an HTTP server.
http://hostname/
The image file is on a TFTP server.
tftp://hostname/
Optionally, specify the VPN identifier in which the server is located.
The reboot option activates the new software image and reboots the device after the installation completes.
If you did not include the reboot option in Step 2, activate the new software image and reboot the device:
Viptela# request software activate
Confirm, within the configured upgrade confirmation time limit, that the software upgrade was successful:
Viptela# request software upgrade-confirm
If you do not issue this command within this time limit, the device automatically reverts to the previous software image.
Redundant Software Images
You can download and store multiple software images on a Cisco vEdge device.
To list the currently installed software version and to see which software image is currently running, use the following command:
Viptela# show software
VERSION   ACTIVE  DEFAULT  PREVIOUS  CONFIRMED  TIMESTAMP                 
----------------------------------------------------------------------------
15.4.3    true    false    false     user       2016-02-04T03:45:13-00:00
15.4.2    false   true     true      user       2015-12-06T14:01:12-00:00
To upgrade the software to a specific version, use the following command:
Viptela# request software activate
Downgrade a Cisco vEdge Device to an Older Software Image
To downgrade a Cisco vEdge Device to a previous software image using CLI:
If necessary, remove an existing software image to provide space for loading a new software image.
vEdge# request software remove  previous-installed-build
Download the software image for the downgrade.
Install the downloaded image.
vEdge# request software install desired-build
We recommend copying the image to local storage before installing, but you can specify the image location in one of the following ways:
The image file is on the local server:
/directory-path/
You can use the CLI's autocompletion feature to complete the path and filename.
The image file is on an FTP server.
ftp://hostname/
The image file is on an HTTP server.
http://hostname/
The image file is on a TFTP server.
tftp://hostname/
Set the installed image as the default.
vEdge# request software set-default desired-build
Perform a reset. This resets the device, deleting any existing configuration. The device starts in day zero configuration.
vEdge# request software reset
Upgrade Memory and vCPU Resources on a Virtual Machine Hosting Cisco vManage
Perform the following steps to upgrade the memory and virtual central processing unit (vCPU) resources on a virtual machine (VM) hosting Cisco vManage.

Note
Only memory or vCPU increase is allowed. After the memory or vCPU is upgraded, you cannot downgrade.
Check the current configuration on Cisco vManage using the command show system status.
vManage#show system status 

Viptela (tm) vmanage Operating System Software
Copyright (c) 2013-2021 by Viptela, Inc.
Controller Compatibility: 
Version: 20.7.0-185
Build: 185


System logging to host  is disabled
System logging to disk is enabled

System state:            GREEN. All daemons up
System FIPS state:       Enabled
Testbed mode:            Enabled
Engineering Signed:      True

Last reboot:             Initiated by user. 
CPU-reported reboot:     Not Applicable
Boot loader version:     Not applicable
System uptime:           1 days 02 hrs 44 min 52 sec
Current time:            Sat Oct 23 22:12:10 UTC 2021

Load average:            1 minute: 14.58, 5 minutes: 12.31, 15 minutes: 10.73
Processes:               5775 total
CPU allocation:          32 total
CPU states:              31.58% user,   4.36% system,   64.06% idle
Memory usage:            65741448K total,    38096172K used,   490324K free
                         4606444K buffers,  22548508K cache

Disk usage:              Filesystem      Size   Used  Avail   Use %  Mounted on
                         /dev/root       15230M  3496M  10898M   24%   /
vManage storage usage:   Filesystem      Size  Used  Avail  Use%  Mounted on
                         /dev/sdb        502942M  206906M  270435M   41%   /opt/data

Personality:             vmanage
Model name:              vmanage
Services:                None
vManaged:                false
Commit pending:          false
Configuration template:  None
Chassis serial number:   None
Power the device down to upgrade the memory.
Upgrade the CPU and memory for the VM using the guidelines of the hosting platform. You can make the following upgrades:
Resources
Current
Upgrade
vCPU
16
32
Memory
32 G
64 G or 128 G
Memory
64 G
128 G
Power on the device and verify the memory and CPU.
vManage1# show system status 

Viptela (tm) vmanage Operating System Software
Copyright (c) 2013-2021 by Viptela, Inc.
Controller Compatibility: 
Version: 20.7.0-139
Build: 139


System logging to host  is disabled
System logging to disk is enabled

System state:            GREEN. All daemons up
System FIPS state:       Enabled
Testbed mode:            Enabled
Engineering Signed:      True

Last reboot:             Initiated by user - activate 20.7.0-139. 
CPU-reported reboot:     Not Applicable
Boot loader version:     Not applicable
System uptime:           16 days 17 hrs 43 min 28 sec
Current time:            Sat Oct 23 22:22:16 UTC 2021

Load average:            1 minute: 15.86, 5 minutes: 13.02, 15 minutes: 11.45
Processes:               6067 total
CPU allocation:          32 total
CPU states:              32.13% user,   4.34% system,   63.53% idle
Memory usage:            131703148K total,    88221488K used,   19285636K free
                         7022488K buffers,  17173536K cache

Disk usage:              Filesystem      Size   Used  Avail   Use %  Mounted on
                         /dev/root       15998M  10702M  4461M   71%   /
vManage storage usage:   Filesystem      Size  Used  Avail  Use%  Mounted on
                         /dev/sdb        10402115M  702212M  9175615M   6%   /opt/data

Personality:             vmanage
Model name:              vmanage
Services:                None
vManaged:                false
Commit pending:          false
Configuration template:  None
Chassis serial number:   None
Expand the Disk Size
Perform the following steps to increase the disk size on Cisco vManage.
Power the device down on all Cisco vManage instances in the cluster.
request nms all stop
Power down the Cisco vManage VM.
Using the appropriate tools for the hypervisor system hosting the Cisco vManage VM, increase the size of the secondary partition that is used as the data disk partition.
Start the Cisco vManage VM.
Power the device down.
request nms all stop
Use the following command to reconfigure vManage to use the new disk size.
request nms application-server resize-data-partition
The partition resizing will take some time to complete.
Use the following vshell command to confirm that the /opt/data disk has been resized.
vshell

df -hk | grep data
Reboot the device.
For more details about the cluster upgrade processes, see Cisco vManage Cluster Creation and Troubleshooting guide.
Use Software Maintenance Upgrade Package on Cisco IOS XE SD-WAN Devices
Table 7. Feature History
Feature Name
Release Information
Description
Support for Software Maintenance Upgrade Package
Cisco IOS XE Release 17.9.1a
Cisco vManage Release 20.9.1
This feature enables support for a Software Maintenance Upgrade (SMU) package that can be installed on Cisco IOS XE SD-WAN devices. The SMU package provides a patch fix or a security resolution to a released Cisco IOS XE image. Developers can build this package that provides a fix for a reported issue without waiting for the fix to become available in the next release.
SMU Support for Cisco ISR1100 and ISR1100X Series Routers
Cisco IOS XE Release 17.11.1a
Cisco vManage Release 20.11.1
Added support for Cisco ISR 1100 and ISR 1100X Series Integrated Services Routers.
Supported Devices for Software Maintenance Upgrade Package
Information About Software Maintenance Upgrade Package
Manage Software Maintenance Upgrade Images
Manage Software Maintenance Upgrade Images Using the CLI
Verify Status of Software Maintenance Upgrade Images
Supported Devices for Software Maintenance Upgrade Package
Release
Supported Devices
Cisco IOS XE Release 17.9.1a and later
Cisco ISR 1000 Series Integrated Services Routers
Cisco IR1101 Integrated Services Router Rugged
Cisco ISR 4000 series Integrated Services Routers
Cisco ASR 1000 Series Aggregation Services Routers
Cisco Catalyst 8500 Series Edge Platforms
Cisco Catalyst 8500L Series Edge Platforms
Cisco Catalyst 8000v Series Edge Platforms
Cisco IOS XE Release 17.11.1a and later
Cisco ISR 1100 and ISR 1100X Series Integrated Services Routers
Information About Software Maintenance Upgrade Package
A Software Maintenance Upgrade (SMU) is a point fix for a critical bug in released software that attempts to minimize disruption to the router, if possible. An SMU is not designed to replace a maintenance release. The fix is delivered as an SMU package file. A package is provided for each release and each component of Cisco SD-WAN. The package contains metadata that describes the content of the package and the fix for a reported issue that you request the SMU package for.
Each SMU image filename (SMU image) that is stored in the software repository includes the base image version and the defect ID of the fix. In the image name:
base_image_version is the Cisco IOS XE image version.
defect_id is the identifier of the defect for which the SMU package has the fix.
To install an SMU image on a Cisco IOS XE SD-WAN device, follow these steps:
Download an SMU image for your release from the Cisco site, https://software.cisco.com.
Perform one of the following actions to upload an SMU image:
Upload an SMU image by adding the image to the device software repository using Cisco vManage. For more information about adding, viewing, and activate an SMU image, see Manage Software Maintenance Upgrade Images.
Upload an SMU image by copying the image to the bootflash of your device using the CLI. For more information about installing and activating an SMU image using the CLI, see Manage Software Maintenance Upgrade Images Using the CLI.
Upgrade or install and activate an SMU image on a device.
Install: The desired SMU image is installed on the device.
Activate: The installed SMU image is activated, which results in rebooting the device.

Note
The device reboot occurs based on whether the SMU image type is hot or cold. For more information about the SMU package types, see SMU Types.
If the SMU image is compatible with the Cisco IOS XE Software image on the device, the upgrade task is successful and the SMU image is installed and activated on the device. If the upgrade task is not successful, the device automatically reverts to the state that it was in before the SMU image activation.
The following are the steps to deactivate and remove an SMU image from a Cisco IOS XE SD-WAN device:
Deactivate a currently active SMU image on a Cisco IOS XE SD-WAN device and wait for the status to change from "Active" to "Installed" in Cisco vManage.
If the SMU image deactivation on a device fails, the device automatically reverts to the state that it was in before the image deactivation.
Remove an SMU image from a device and have the base image version (Cisco IOS XE image version) on the device.
Ensure that you deactivate the SMU image before you remove it.
Cisco vManage receives several notifications during the SMU image upgrade and you receive success or failure messages, as applicable. Use the Task View window to see these messages.
SMU Types
An SMU type describes the effect of an installed SMU package on a Cisco IOS XE SD-WAN device. The following are the SMU package types:
Hot SMU (non-reload): Enables an SMU package to take effect after an SMU image activation without rebooting (reloading) the Cisco IOS XE SD-WAN device.
Cold SMU (reload): Enables an SMU package to take effect after rebooting (reloading) the Cisco IOS XE SD-WAN device.
Benefits of Using Software Maintenance Upgrade Package
Allows you to address a network issue quickly while reducing the time and scope of the testing required. The Cisco IOS XE SD-WAN device internally validates the SMU image compatibility and does not allow you to install noncompatible SMU packages.
Allows you to install or activate only one SMU package on devices at a time to simplify the initial implementation process.
Allows you to install an SMU package on multiple Cisco IOS XE SD-WAN devices at the same time when installing using Cisco vManage. To install an SMU package on multiple devices using the CLI, ensure that you repeat the install process on multiple devices.
Manage Software Maintenance Upgrade Images
Use Cisco vManage to add, upgrade and activate, or deactivate and remove an SMU image.

Note
When an SMU image is activated and deactivated, the device reboot may be triggered based on non-reload or reload SMU types. A non-reload SMU type does not trigger a device reboot, but a reload SMU type triggers a device reboot.
Add, View, and Activate an SMU Image
Add an SMU image using the Cisco vManage software repository.
See the Cisco vManage Add Software Images to Repository procedure in the Cisco SD-WAN Monitoring and Operations guide.
View SMU images using the Cisco vManage software repository.
See theCisco vManage View Software Images procedure in the Cisco SD-WAN Monitoring and Operations guide. Note the following points when viewing SMU images:
The Available SMU Versions column displays the number of SMU images available for the current base image version (Cisco IOS XE image version).
View the defects that are associated with an SMU image by clicking a desired entry in the Available SMU Versions column. In the Available SMU Versions dialog box, you can view the defect ID, the corresponding SMU version, and the SMU types, such as non-reload or reload.
In the Available SMU Versions dialog box, delete an SMU version by clicking the delete icon next to an SMU version.
Upgrade an SMU image using the Cisco vManage software upgrade window.
See the Cisco vManage Upgrade the Software Image on a Device procedure in the Cisco SD-WAN Monitoring and Operations guide. Note the following points about the SMU image that you choose to upgrade:
In the devices table, the Available SMUs column displays the number of SMU images that are available for the current base image version.
View a list of all available SMU versions and the upgrade images for a device by clicking a desired entry under the Available SMUs column. In the Available SMUs dialog box, you can view the SMU versions, SMU types, and the state of an SMU version.
The SMU version is in the format base_image_version.cdet_id.
In the Upgrade dialog box, optionally check Activate and Reboot to activate an SMU image and perform a reboot of the Cisco IOS XE SD-WAN device automatically.
After you check the Activate and Reboot check box, Cisco vManage installs and activates the SMU image on a device and triggers a reload based on the SMU type. For more Information about activating a software image, see the Cisco vManage Activate a Software Image procedure in the Cisco SD-WAN Monitoring and Operations guide.
After a successful upgrade of an SMU image, the Cisco IOS XE SD-WAN device sends a corresponding success message.
Deactivate or Remove an SMU Image
Deactivate an SMU image and remove the image from a device by using the Cisco vManage software upgrade window. See the Deactivate an SMU Image procedure in the Cisco SD-WAN Monitoring and Operations guide.
Manage Software Maintenance Upgrade Images Using the CLI
Use the following CLIs to install, upgrade and activate, or deactivate and remove an SMU image.

Note
When an SMU image is activated and deactivated, the device reboot may be triggered based on non-reload or reload SMU types. A non-reload SMU type does not trigger a device reboot, but a reload SMU type triggers a device reboot.
Install and Activate an SMU Image Using the CLI
Upload the SMU image from the file server to the bootflash of the device.
Use the copy command to upload an SMU image. For information about the copy command, see Step 2 of the Install the Cisco IOS XE Software topic.
If not already configured, configure the time limit for confirming that a SMU image activation is successful.
The time limit can be 1 through 60 minutes. We recommend that you configure the time limit to be at least 15 minutes.
Device# config-transaction 
Device(config)# system 
Device(config-system)# upgrade-confirm minutes 
Install an SMU image from the bootflash of your device and perform a compatibility check for the device and SMU package version.
Device# request platform software sdwan smu install file-path
Activate the SMU image on a Cisco IOS XE SD-WAN device.
Device# request platform software sdwan smu activate build-number.smu-defect-id
Confirm the upgrade of the SMU image within the configured confirmation time limit.
Device# request platform software sdwan smu upgrade-confirm

Note
If you don’t issue this command on the device within the time limit that is specified in the upgrade-confirm minutes command, the device automatically reverts to the state that it was in before the SMU image activation.
Deactivate and Remove an SMU Image Using the CLI
If not already configured, configure the time limit for confirming that a SMU image deactivation is successful.
The time limit can be 1 through 60 minutes. We recommend that you configure the time limit to at least 15 minutes.
Device# config-transaction 
Device(config)# system 
Device(config-system)# upgrade-confirm minutes 
Deactivate an SMU image on a Cisco IOS XE SD-WAN device.
Device# request platform software sdwan smu deactivate build-number.smu-defect-id
Confirm that the SMU image can be deactivated.
Device# request platform software sdwan smu upgrade-confirm

Note
If you do not issue this command on the device within the time limit specified in the upgrade-confirm minutes command, the image deactivation fails and the device automatically reverts to the state that it was in before the SMU image deactivation.
Remove an SMU image from a Cisco IOS XE SD-WAN device.
Device# request platform software sdwan smu remove build-number.smu-defect-id
The following examples show commands that you can use to manage the SMU image operations.
Check the upgrade and confirm the configuration:
show sdwan running system
Add and upgrade the confirm timer:
config-transaction
system
upgrade-confirm 15
commit
Execution commands:
request platform software sdwan smu install bootflash: c8000v-universalk9.2022-08-17_23.44_mcpre.24042.CSCvq24042.SSA.smu.bin
request platform software sdwan smu activate 17.09.01a.0.247.CSCvq24042
request platform software sdwan smu upgrade-confirm
request platform software sdwan smu deactivate 17.09.01a.0.247.CSCvq24042
request platform software sdwan smu upgrade-confirm
request platform software sdwan smu remove 17.09.01a.0.247.CSCvq24042
Verify Status of Software Maintenance Upgrade Images
You can monitor the status of the SMU image by using Cisco vManage or the CLI.
Monitor SMU Status Using Cisco vManage
From the Cisco vManage menu, choose Maintenance > Software Upgrade.
For the desired Cisco IOS XE SD-WAN device, click an SMU image link (hyperlink) under Available SMUs.
In the Available SMUs dialog box, you can view the state of an SMU image.
If no SMU images are available for the current base image version (Cisco IOS XE image version), the SMU image link is not available under Available SMUs and Cisco vManage displays 0.
Verify SMU Status Using the CLI
Example 1:
The following is a sample output from the show install summary command after installing, activating, and confirming the upgrade (committed) of an SMU image.
Device# show install summary[ R0 ] Installed Package(s) Information:
State (St): I - Inactive, U - Activated & Uncommitted,
            C - Activated & Committed, D - Deactivated & Uncommitted
--------------------------------------------------------------------------------
Type  St   Filename/Version
--------------------------------------------------------------------------------
IMG   C    17.09.01a.0.247
SMU   I    bootflash:c8000v-universalk9.2022-08-17_23.44_mcpre.24042.CSCvq24042.SSA.smu.bin
 
--------------------------------------------------------------------------------
Auto abort timer: inactive
--------------------------------------------------------------------------------
The output shows that an SMU image is installed and activated from the bootflash file system. You can track the time that is left for rollback of an SMU image from the Auto abort timer value. This value displays the time that is left for the Auto abort timer to expire and the device to roll back.
Example 2:
The following example shows the output after using the request platform software sdwan smu deactivate command to deactivate an SMU image.
Device# request platform software sdwan smu deactivate 17.09.01a.0.247.CSCvq24042
smu_deactivate: START Mon Mar 5 21:54:06 PST 2021
smu_deactivate: Deactivating SMU
Executing pre scripts....

Executing pre scripts done.
--- Starting SMU Deactivate operation ---
Performing SMU_DEACTIVATE on all members
  [1] SMU_DEACTIVATE package(s) on switch 1
  [1] Finished SMU_DEACTIVATE on switch 1
Checking status of SMU_DEACTIVATE on [1]
SMU_DEACTIVATE: Passed on [1]
Finished SMU Deactivate operation
SUCCESS: smu_deactivate 17.09.01a.0.247.CSCvq24042
The output shows that an SMU image is deactivated from the device.
The following is a sample output from the show install summary command after deactivating an SMU image.
Device# show install summary
[ R0 ] Installed Package(s) Information:
State (St): I - Inactive, U - Activated & Uncommitted,
            C - Activated & Committed, D - Deactivated & Uncommitted
--------------------------------------------------------------------------------
Type  St   Filename/Version
--------------------------------------------------------------------------------

IMG   C    17.09.01a.0.247
SMU   D    bootflash: c8000v-universalk9.2022-08-17_23.44_mcpre.24042.CSCvq24042.SSA.smu.bin

--------------------------------------------------------------------------------
Auto abort timer: active , time before rollback - 00:04:57
--------------------------------------------------------------------------------
The following sample output shows the output of deactivating an SMU image after confirming that the SMU image can be deactivated using the request platform software sdwan smu upgrade-confirm command .
Device# request platform software sdwan smu deactivate 17.09.01a.0.247.CSCvq24042

install_deactivate: START Thu Aug 25 17:47:10 UTC 2022
install_deactivate: Deactivating SMU
Executing pre scripts....
Executing pre sripts done.

--- Starting SMU Deactivate operation ---
Performing SMU_DEACTIVATE on Active/Standby
  [1] SMU_DEACTIVATE package(s) on R0
  [1] Finished SMU_DEACTIVATE on R0
Checking status of SMU_DEACTIVATE on [R0]
SMU_DEACTIVATE: Passed on [R0]
Finished SMU Deactivate operation

CSCvq24042:SUCCESS
SUCCESS: install_deactivate /bootflash/c8kv_hot.bin Thu Aug 25 17:47:33 UTC 2022
The following is a sample output from the show install summary command after removing an SMU image.
Device# show install summary[ R0 ] Installed Package(s) Information:
State (St): I - Inactive, U - Activated & Uncommitted,
            C - Activated & Committed, D - Deactivated & Uncommitted
--------------------------------------------------------------------------------
Type  St   Filename/Version
--------------------------------------------------------------------------------
IMG   C    17.09.01a.0.247

--------------------------------------------------------------------------------
Auto abort timer: inactive
--------------------------------------------------------------------------------
Example 3:
The following is a sample output from the show install package command to view the metadata of an SMU image such as, SMU type, SMU ID, SMU defect ID, and so on.
Device# show install package bootflash: c8000v-universalk9.2022-08-17_23.44_mcpre.24042.CSCvq24042.SSA.smu.bin

Name: c8000v-universalk9.2022-08-17_23.44_mcpre.24042.CSCvq24042.SSA.smu.bin
Version: 17.09.01a.0.247.1660805065
Platform: C8000V
Package Type: SMU
Defect ID: CSCvq24042
Package State: Inactive
Supersedes List: {}
SMU Fixes List: {}
SMU ID: 24042
SMU Type: non-reload
SMU Compatible with Version: 17.09.01a.0.247
SMUImpact: 
Was this Document Helpful?
Yes No
Feedback
Customers Also Viewed
Cisco SD-WAN Getting Started Guide --- Install and Upgrade Cisco IOS XE Release 17.2.1r and Later
Cisco SD-WAN Getting Started Guide --- Cisco SD-WAN Overlay Network Bring-Up Process
Cisco SD-WAN Getting Started Guide --- The Cisco SD-WAN Solution
+ Show 2 More
Contact Cisco
Open a Support Case
(Requires a Cisco Service Contract)