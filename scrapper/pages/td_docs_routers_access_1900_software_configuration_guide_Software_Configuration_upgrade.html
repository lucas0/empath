Configuration Guides
Cisco 3900 Series, 2900 Series, and 1900 Series Software Configuration Guide
Bias-Free Language
Book Contents
Download
Print
Updated:
March 30, 2016
Chapter: Upgrading the Cisco IOS Software
Chapter Contents
This module describes how to upgrade the Cisco Internet Operating System (IOS) software image on the following hardware:
Cisco 3900 series ISRs
Cisco 2900 series ISRs
Cisco 1900 series ISRs
Cisco 1941W Wireless Device
This module contains the following sections:
Restrictions for Upgrading the System Image
Information About Upgrading the System Image
How to Upgrade the Cisco IOS Image
How to Upgrade the IOS Image on the Access Point
Additional References
Restrictions for Upgrading the System Image
Cisco 3900 series, Cisco 2900 series, and Cisco 1900 series integrated services routers (ISRs) download images to new Advanced Capability CompactFlash (CF) memory cards. Legacy CF will not operate in Cisco 3900 series, Cisco 2900 series, and Cisco 1900 series ISRs. When legacy CF is inserted, the following error message appears:
WARNING: Unsupported compact flash detected. Use of this card during normal operation can impact and severely degrade performance of the system. Please use supported compact flash cards only.
Slot0 is the default CF slot. CF in Slot0 stores system image, configuration, and data files. CF must be present in this slot for the router to boot and perform normal file operations.
Cisco IOS images for the access point download images to the CF embedded on the access point.
Table 1 describes the slot number and name for the Advanced Capability CF slots.
  Table 1 Compact Flash Slot Numbering and Naming
Slot Number
CF Filenames
Slot01
flash0:2
Slot1
flash1:
1.Slot 0 is the default CF slot. It stores the system image, configurations, and data files. CF must be present in this slot for the router to boot and perform normal file operations.
2.flash0: is aliased to flash:.
Table 2 describes the slot number and name for the USB slots.
  Table 2 USB Slot Numbering and Naming
Slot Number
USB Filenames
Slot0
usbflash0:
Slot1
usbflash1:
Information About Upgrading the System Image
To upgrade the system image on your router review the following sections:
Why Would I Upgrade the System Image?
Which Cisco IOS Release Is Running on My Router Now?
How Do I Choose the New Cisco IOS Release and Feature Set?
Where Do I Download the System Image?
Why Would I Upgrade the System Image?
System images contain the Cisco IOS software. Your router was shipped with an image installed.
Note The Cisco 1941W access point runs a Cisco IOS image that is separate from the Cisco IOS image on the router.
At some point, you may want to load a different image onto the router or the access point. For example, you may want to upgrade your IOS software to the latest release, or you may want to use the same Cisco IOS release for all the routers in a network. Each system image contains different sets of Cisco IOS features, therefore select an appropriate system image to suit your network requirements.
Which Cisco IOS Release Is Running on My Router Now?
To determine the Cisco IOS release that is currently running on your router, and the filename of the system image, enter the show version command in user EXEC or privileged EXEC mode.
How Do I Choose the New Cisco IOS Release and Feature Set?
To determine which Cisco IOS releases and feature are supported on your platform, go to Cisco Feature Navigator at http://www.cisco.com/go/cfn. You must have an account at Cisco.com. If you do not have an account or have forgotten your username or password, click Cancel at the login dialog box and follow the instructions that appear.
Cisco 3900 series, 2900 series, and 1900 series ISRs support Cisco IOS software entitlement and enforcement. See Software Activation on Cisco Integrated Services Routers at Cisco.com for feature and package license information.
Where Do I Download the System Image?
To download a system image you must have an account at Cisco.com to gain access to the following websites. If you do not have an account or have forgotten your username or password, click Cancel at the login dialog box, and follow the instructions that appear.
If you know the Cisco IOS release and feature set you want to download, go directly to http://www.cisco.com/kobayashi/sw-center/index.shtml.
For more information before selecting the Cisco IOS release and feature set, go to the Software Download Center at:
http://www.cisco.com/public/sw-center/index.shtml.
For more information about Loading and Managing System images, go to http://www.cisco.com/en/US/docs/ios/fundamentals/configuration/guide/cf_system_images.html.
How to Upgrade the Cisco IOS Image
This section provides information about upgrading the Cisco IOS image on the router.
Saving Backup Copies of Your Old System Image and Configuration
Ensuring Adequate DRAM for the New System Image
Ensuring Adequate Flash Memory for the New System Image
Copying the System Image into Flash Memory
Loading the New System Image
Saving Backup Copies of Your New System Image and Configuration
Saving Backup Copies of Your Old System Image and Configuration
To avoid unexpected downtime in the event you encounter serious problems using a new system image or startup configuration, we recommend that you save backup copies of your current startup configuration file and Cisco IOS software system image file on a server.
For more detailed information, see the “Managing Configuration Files” chapter and the “Loading and Maintaining System Images” chapter of Cisco IOS Configuration Fundamentals Guide at: http://www.cisco.com/en/US/docs/ios/fundamentals/configuration/guide/12_4t/cf_12_4t_book.html.
To save backup copies of the startup configuration file and the system image file, complete the following steps.
SUMMARY STEPS
1. enable
2. copy nvram:startup-config { ftp: | rcp: | tftp: }
3. dir {flash0: | flash1:}
4. copy flash0: { ftp: | rcp: | tftp: }
DETAILED STEPS
  Command or Action
Purpose
Step 1
enable
  Router> enable
Enables privileged EXEC mode.
Enter your password if prompted.
Step 2
copy nvram:startup-config { ftp: | rcp: | tftp: }
  Router# copy nvram:startup-config ftp:
Copies the startup configuration file to a server.
The configuration file copy can serve as a backup copy.
Enter the destination URL when prompted.
Step 3
dir flash0:
  Router# dir flash0:
Displays the layout and contents of a flash memory file system. flash0: is aliased onto flash:.
Learn the name of the system image file.
Step 4
copy flash0: { ftp: | rcp: | tftp: }
  Router# copy flash0: ftp:
Copies a file from flash memory to a server.
Copy the system image file to a server. This file can serve as a backup copy.
Enter the flash memory partition number if prompted.
Enter the filename and destination URL when prompted.
Examples
The following examples show how to copy a startup configuration to a TFTP server and how to copy from flash memory to an FTP server.
Copying the Startup Configuration to a TFTP Server: Example
The following example shows the startup configuration being copied to a TFTP server:
Router# copy nvram:startup-config tftp:
  Remote host[]? 192.0.0.1
  Name of configuration file to write [rtr2-confg]? rtr2-config-b4upgrade
Write file rtr2-confg-b4upgrade on host 192.0.0.1?[confirm] <cr>
![OK]
Copying from Flash Memory to a TFTP Server: Example
The following example uses the dir flash0: command in privileged EXEC mode to learn the name of the system image file and the copy flash0: tftp: command in privileged EXEC mode to copy the system image to a TFTP server. The router uses the default username and password.
  Router# copy flash0: tftp:
Source filename [running-config]?
Address or name of remote host []? 192.0.0.1
Destination filename [router-confg]? running-config
983 bytes copied in 0.048 secs (20479 bytes/sec)
  Router#
Router# dir flash0:
Directory of flash0:/
  1 -rw- 48311224 Mar 2 1901 11:32:50 +00:00 c3900-universalk9-mz.SSA.XFR_20090407
2 -rw- 185667 Jan 27 2021 09:03:54 +00:00 crashinfo_20210127-090354
3 -rw- 983 Feb 14 2021 12:41:52 +00:00 running-config
  260173824 bytes total (211668992 bytes free)
Router#
Ensuring Adequate DRAM for the New System Image
This section describes how to check whether your router has enough DRAM for upgrading to the new system image.
Prerequisites
Choose the Cisco IOS release and system image to which you want to upgrade. See the “Information About Upgrading the System Image” section.
SUMMARY STEPS
1. Select the system image in the Cisco IOS Upgrade Planner at:
http://www.cisco.com/cgi-bin/Software/Iosplanner/Planner-tool/iosplanner.cgi.
2. Write down the minimum memory requirements for the image, as displayed in the File Download Information table.
3. show version
4. Add the memory sizes that are displayed in the show version command output to calculate your router’s DRAM size.
5. Compare the calculated DRAM size with the minimum memory requirements from Step 2.
a. If the DRAM is equal to or greater than the new system image’s minimum memory requirements, proceed to the “Ensuring Adequate Flash Memory for the New System Image” section.
b. If the DRAM is less than the new system image’s minimum flash requirements, you must upgrade your DRAM. See the hardware installation guide for your router.
DETAILED STEPS
Step 1 Select the system image in the Cisco IOS Upgrade Planner at:
http://www.cisco.com/cgi-bin/Software/Iosplanner/Planner-tool/iosplanner.cgi.
You must have an account at Cisco.com. If you do not have an account or have forgotten your username or password, click Cancel at the login dialog box and follow the instructions that appear.
Step 2 Write down the minimum memory requirements for the image, as displayed in the File Download Information table.
Step 3 Use the show version command to display the router processor and memory.
Step 4 Add the memory sizes to calculate the amount of DRAM in your router.
For example, if your memory sizes are 231424 KB and 30720 KB for a total of 262144 KB, it would be 256 MB of DRAM.
Tip To convert from kilobytes (KB) to megabytes (MB), divide the number of kilobytes by 1024.
Step 5 Compare the amount of DRAM in the router to the minimum memory requirements from Step 2.
a. If the DRAM is equal to or greater than the new system image’s minimum memory requirements, proceed to the “Ensuring Adequate Flash Memory for the New System Image” section.
b. If the DRAM is less than the new system image’s minimum memory requirements, you must upgrade your DRAM. See the hardware installation guide for your router.
  Ensuring Adequate Flash Memory for the New System Image
This section describes how to check whether your router has enough flash memory to upgrade to the new system image and, if necessary, how to properly delete files in flash memory to make room for the new system image.
Cisco 3900 series, Cisco 2900 series, and Cisco 1900 series ISRs have two external CF slots and two USB slots. Use the secondary CF for overflow files, if required. Table 3 lists CF slot number, name, and size.
  Table 3 Compact Flash Slot Number, Name, and Size
Slot Number
CF Filename
Size 3
Slot04
flash0:
256MB
Slot1
flash1:
0
3.The maximum storage capacity for the CF in Slot0 and Slot1 is 4GB.
4.Slot0 is the default CF slot. CF in Slot0 stores system image, configuration, and data files. CF must be present in this slot for the router to boot and perform normal file operations.
Table 4 lists the USB slot number, name, and size.
  Table 4 USB Slot Number, Name, and Size
Slot Number
USB Filename
Size 5
Slot0
usbflash0:
64MB
Slot1
usbflash1:
0
5.The maximum storage capacity for the USB in Slot0 and Slot1 is 4GB.
Prerequisites
In order to check whether your router has enough flash memory for a new system image, you need to obtain the image’s flash requirements from Cisco:
Choose the Cisco IOS release and system image to which you want to upgrade. See the “Information About Upgrading the System Image” section.
Select the system image in the Cisco IOS Upgrade Planner at:
http://www.cisco.com/cgi-bin/Software/Iosplanner/Planner-tool/iosplanner.cgi.
You must have an account at Cisco.com. If you do not have an account or have forgotten your username or password, click Cancel at the login dialog box and follow the instructions that appear.
From the File Download Information table, write down the minimum flash requirements for the image.
SUMMARY STEPS
1. enable
2. dir flash0 :
3. From the displayed output of the dir flash0 : command, compare the number of bytes available to the minimum flash requirements for the new system image.
a. If the available memory is equal to or greater than the new system image’s minimum flash requirements, proceed to the “Copying the System Image into Flash Memory” section.
b. If the available memory is less than the new system image’s minimum flash requirements, proceed to Step 4.
4. From the displayed output of the dir flash0: command, compare the number of bytes total to the size of the system image to which you want to upgrade.
a. If the total memory is less than the new system image’s minimum flash requirements, you must upgrade your compact flash memory card. See the hardware installation guide for your router.
b. If the total memory is equal to or greater than the new system image’s minimum flash requirements, proceed to Step 5.
5. dir /all flash0:
6. From the displayed output of the dir /all flash0: command, write down the names and directory locations of the files that you can delete.
7. (Optional) copy flash0: { tftp | rcp }
8. (Optional) Repeat Step 7 for each file that you identified in Step 6.
9. delete flash0: directory-path / filename
10. Repeat Step 9 for each file that you identified in Step 6.
11. dir flash0 : [ partition-number : ]
12. From the displayed output of the dir flash0: command, compare the number of bytes available to the size of the system image to which you want to upgrade.
a. If the available memory is less than the new system image’s minimum flash requirements, then you must upgrade your compact flash memory card to a size that can accommodate both the existing files and the new system image. See the hardware installation guide for your router.
b. If the available memory is equal to or greater than the new system image’s minimum flash requirements, proceed to the “Copying the System Image into Flash Memory” section.
DETAILED STEPS
Step 1 enable
Use this command to enter privileged EXEC mode. Enter your password if prompted. For example:
Router> enable
Password:
Router#
  Step 2 dir flash0 :
Use this command to display the layout and contents of flash memory:
Router# dir flash0:
  Flash CompactFlash directory:
File Length Name/status
1 6458208 c39xx.tmp [deleted]
2 6458208 c39xxmz
[12916544 bytes used, 3139776 available, 16056320 total]
15680K bytes of ATA CompactFlash (Read/Write)
  Step 3 From the displayed output of the dir flash0 : command, compare the number of bytes available to the minimum flash requirements for the new system image.
If the available memory is equal to or greater than the new system image’s minimum flash requirements, proceed to the “Copying the System Image into Flash Memory” section.
If the available memory is less than the new system image’s minimum flash requirements, proceed to Step 4.
Step 4 From the displayed output of the dir flash0: command, compare the number of bytes total to the size of the system image to which you want to upgrade.
If the total memory is less than the new system image’s minimum flash requirements, you must upgrade your compact flash memory card. See the hardware installation guide for your router.
If the total memory is equal to or greater than the new system image’s minimum flash requirements, proceed to Step 5.
Step 5 dir /all flash0:
Use this command to display a list of all files and directories in flash memory:
Router# dir /all flash0:
  Directory of flash:/
  3 -rw- 6458388 Mar 01 1993 00:00:58 c39xx.tmp
1580 -rw- 6462268 Mar 06 1993 06:14:02 c39xx-ata
  63930368 bytes total (51007488 bytes free)
  Step 6 From the displayed output of the dir /all flash0: command, write down the names and directory locations of the files that you can delete. If you cannot delete any files, you must upgrade your compact flash memory card. See the hardware installation guide for your router.
Note Do not delete the system image that the router already uses. If you are not sure which files can be safely deleted, either consult your network administrator or upgrade your compact flash memory card to a size that can accommodate both the existing files and the new system image. See the hardware installation guide for your router.
Step 7 copy flash0: { tftp | rcp }
(Optional) Copy a file to a server before deleting the file from flash memory. When prompted, enter the filename and the server’s hostname or IP address:
Router# copy flash0: tftp
  Step 8 (Optional) Repeat Step 7 for each file that you identified in Step 6.
Step 9 delete flash0: directory-path / filename
Use this command to delete a file in flash memory:
Router# delete flash0:c39xx.tmp
  Delete filename [c39xx.tmp]? <cr>
Delete flash0:c39xx.tmp? [confirm] <cr>
  Step 10 Repeat Step 9 for each file that you identified in Step 6.
Step 11 dir flash0 :
Use this command to display the layout and contents of flash memory:
Router# dir flash0:
  Flash CompactFlash directory:
File Length Name/status
1 6458208 c39xx.tmp [deleted]
2 6458208 c3xx-mz
[12916544 bytes used, 3139776 available, 16056320 total]
15680K bytes of ATA CompactFlash (Read/Write)
  Step 12 From the displayed output of the dir flash0: command, compare the number of bytes available to the size of the system image to which you want to upgrade.
If the available memory is less than the new system image’s minimum flash requirements, you must upgrade your compact flash memory card to a size that can accommodate both the existing files and the new system image. See the hardware installation guide for your router.
If the available memory is equal to or greater than the new system image’s minimum flash requirements, proceed to the “Copying the System Image into Flash Memory” section.
  What to Do Next
Proceed to the “Copying the System Image into Flash Memory” section.
Copying the System Image into Flash Memory
This section describes how to copy the system image into the compact flash memory card for your router. Choose one of the following methods:
Using TFTP or Remote Copy Protocol to Copy the System Image into Flash Memory
Using the ROM Monitor to Copy the System Image over a Network
Using a PC with a CompactFlash Card Reader to Copy the System Image into Flash Memory
Using TFTP or Remote Copy Protocol to Copy the System Image into Flash Memory
This section describes how to use TFTP or Remote Copy Protocol (RCP) to upgrade the system image. This is the recommended and most common method of upgrading the system image.
Prerequisites
The following details the logistics of upgrading the system image.
Install a TFTP server or an RCP server application on a TCP/IP-ready workstation or PC. Many third-party vendors provide free TFTP server software, which you can find by searching for “TFTP server” in a web search engine.
If you use TFTP:
– Configure the TFTP application to operate as a TFTP server, not a TFTP client.
– Specify the outbound file directory to which you will download and store the system image.
Download the new Cisco IOS software image into the workstation or PC. See the “Where Do I Download the System Image?” section.
Establish a console session to the router. We recommend that you connect your PC directly to the router console port. See the hardware installation guide for your router.
Verify that the TFTP or RCP server has IP connectivity to the router. If you cannot successfully ping between the TFTP or RCP server and the router, do one of the following:
– Configure a default gateway on the router.
– Make sure that the server and the router each have an IP address in the same network or subnet. See the Determining IP Addresses: Frequently Asked Questions tech note.
Tip For more detailed information on how to perform the prerequisites, see the Software Installation and Upgrade Procedure tech note.
SUMMARY STEPS
1. enable
2. copy tftp flash0:
or
copy rcp flash0:
3. When prompted, enter the IP address of the TFTP or RCP server.
4. When prompted, enter the filename of the Cisco IOS software image to be installed.
5. When prompted, enter the filename as you want it to appear on the router.
6. If an error message appears that says, “Not enough space on device,” do one of the following, as appropriate:
If you are certain that all the files in flash memory should be erased, enter y twice when prompted to erase flash before copying.
If you are not certain that all files in flash memory should be erased, press Ctrl-Z and follow the instructions in the “Ensuring Adequate Flash Memory for the New System Image” section.
7. If the error message does not appear, enter no when prompted to erase the flash memory before copying.
DETAILED STEPS
Step 1 enable
Use this command to enter privileged EXEC mode. Enter your password if prompted:
Router> enable
Password: <password>
Router#
  Step 2 copy tftp flash0:
or
copy rcp flash0
Use one of these commands to copy a file from a server to flash memory:
Router# copy tftp flash0:
  Step 3 When prompted, enter the IP address of the TFTP or RCP server:
Address or name of remote host []? 10.10.10.2
  Step 4 When prompted, enter the filename of the Cisco IOS software image to be installed:
Source filename []? c2900-universalk9-mz.bin
  Note The filename is case sensitive.
Step 5 When prompted, enter the filename as you want it to appear on the router. Typically, the same filename is entered as was used in Step 4:
Destination filename []? c2900-universalk9-mz.bin
  Step 6 If an error message appears that says, “Not enough space on device,” do one of the following as appropriate:
If you are certain that all the files in flash memory should be erased, enter y when prompted twice to confirm that flash memory will be erased before copying:
Accessing tftp://10.10.10.2/c2900-universalk9-mz.bin...
Erase flash0: before copying? [confirm] y
Erasing the flash filesystem will remove all files! Continue? [confirm] y
Erasing device... eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
  If you are not certain that all the files in flash memory should be erased, press Ctrl-Z and follow the instructions in the “Ensuring Adequate Flash Memory for the New System Image” section.
Step 7 If the error message does not appear, enter no when prompted to erase the flash memory before copying:
Accessing tftp://10.10.10.2/c2900-universalk9-mz.bin...
Erase flash0: before copying? [confirm] no
    Troubleshooting Tips
See the Common Problems in Installing Images Using TFTP or an RCP Server tech note.
What to Do Next
Proceed to the “Loading the New System Image” section.
Using the ROM Monitor to Copy the System Image over a Network
This section describes how to download a Cisco IOS software image from a remote TFTP server to the router flash memory by using the tftpdnld ROM monitor command.
Caution Using the tftpdnld ROM monitor command may erase the system image, configuration, and data files. System image, configuration, and data files must be present on USB CF in slot0 for the router to boot and perform normal file operations.
Before you can enter the tftpdnld ROM monitor command, you must set the ROM monitor environment variables.
Prerequisites
Connect the TFTP server to a fixed network port on your router.
Restrictions
The LAN ports on network modules or interface cards are not active in ROM monitor mode. Therefore, only a fixed port on your router can be used for TFTP download. This can be either a fixed Ethernet port on the router or one of the Gigabit Ethernet ports on routers equipped with them.
Note You can use this command only to download files to the router. You cannot use tftpdnld to get files from the router.
SUMMARY STEPS
1. Enter ROM monitor mode
2. Set the IP_ADDRESS=ip_address configuration variable.
3. Set the IP_SUBNET_MASK=ip_address configuration variable.
4. Set the DEFAULT_GATEWAY=ip_address configuration variable.
5. Set the TFTP_SERVER=ip_address configuration variable.
6. Set the TFTP_FILE=[directory-path/]filename configuration variable.
7. (Optional) Set the GE_PORT=[0 | 1| 2 | 3] port number for download.
8. (Optional) Set the TFTP_MEDIA_TYPE=[0 | 1] copper or fiber.
9. (Optional) Set the TFTP_MACADDR= mac address of unit.
10. (Optional) Set the TFTP_VERBOSE= [0 | 1| 2] print setting variable.
11. (Optional) Set the TFTP_RETRY_COUNT=retry_times configuration variable.
12. (Optional) Set the TFTP_TIMEOUT=timeout of operation in seconds.
13. (Optional) Set the TFTP_ACK_RETRY=ack retry in seconds.
14. (Optional) Set the TFTP_CHECKSUM=[0 | 1] perform checksum test on image.
15. (Optional) Set the TFTP_DESTINATION=[flash0: | flash1: | usbflash0: | usbflash1:] flash destination device for file.
16. (Optional) Set the GE_SPEED_MODE= speed configuration.
17. Use the set command to verify that you have set the variables correctly.
18. Use the tftpdnld [-r] command to download the image.
DETAILED STEPS
Step 1 Enter ROM monitor mode.
Step 2 Set the IP address of the router. For example:
rommon > IP_ADDRESS=172.16.23.32
  Step 3 Set the IP subnet mask. For example:
rommon > IP_SUBNET_MASK=255.255.255.224
  Step 4 Set the default gateway address. For example:
rommon > DEFAULT_GATEWAY=172.16.23.40
  Step 5 Set the TFTP server IP address, which is the location from which the software will be downloaded:
rommon > TFTP_SERVER=172.16.23.33
  Step 6 Set the name and directory location to which the image file will be downloaded onto the router. For example:
rommon > TFTP_FILE=archive/rel22/<image name>
  Step 7 (Optional) Set the input port to use a Gigabit Ethernet port. Usage is GE_PORT=[0 | 1 | 2]. For example:
rommon > GE_PORT=0
  Step 8 (Optional) Set the Ethernet media type. Usage is TFTP_ MEDIA_TYPE=[0 1], where Copper= 0 and Fiber=1:
rommon > TFTP_MEDIA_TYPE=1
  Step 9 (Optional) Decide whether the router will perform a checksum test on the downloaded image. Usage is TFTP_CHECKSUM=[0 | 1], where 1=checksum test is performed (default) and 0=no checksum test. For example:
rommon > TFTP_CHECKSUM=0
  Step 10 (Optional) Set the number of times that the router will attempt Address Resolution Protocol (ARP) and TFTP download. The default is 7 attempts. For example:
rommon > TFTP_RETRY_COUNT=10
  Step 11 (Optional) Set the amount of time, in seconds, before the download process times out. The default is 2400 seconds (40 minutes). The following example shows 1800 seconds (30 minutes):
TFTP_TIMEOUT=1800
  Step 12 (Optional) Configure the print variable. Usage is TFTP_VERBOSE= [0 | 1 | 2], where print:
0= is quiet.
1= in progress.
2= verbose
Step 13 Use the set command to display the ROM monitor environment variables to verify that you have configured them correctly. For example:
rommon > set
  Step 14 Download the system image, as specified by the ROM monitor environmental variables, using the tftpdnld [-r] command. Without the -r option, the command downloads the specified image and saves it in flash memory, deleting all existing data in all partitions in flash memory. Using the -r option downloads and boots the new software but does not save the software to flash memory.
rommon> tftpdnld [-r]
A prompt is displayed:
Do you wish to continue? y/n: [n]: y
  Entering y confirms that you want to continue with the TFTP download.
  What to Do Next
Proceed to the “Loading the New System Image” section.
Using a PC with a CompactFlash Card Reader to Copy the System Image into Flash Memory
Because the system image is stored on an external CompactFlash memory card, you can use a PC with a compact flash card reader to format the card and copy a new system image file onto the card. However, this upgrade method is not commonly used.
For more information about using flash memory cards, see Appendix B, “Using CompactFlash Memory Cards.”
Prerequisites
Download the new Cisco IOS Software image to the PC. See the “Where Do I Download the System Image?” section.
Locate the compact flash memory card slot on the router chassis. For help with locating the slot and instructions for removing and inserting the card, see the hardware installation guide for your router.
Caution Removing the compact flash memory card may disrupt the network because some software features use the compact flash memory card to store tables and other important data.
DETAILED STEPS
Step 1 Remove the compact flash memory card from the router.
Step 2 Insert the card into the compact flash card reader on a PC.
Step 3 Use the PC to copy the system image file to the compact flash memory card.
Step 4 Remove the card from the compact flash card reader.
Step 5 Insert the compact flash memory card into the router.
  What to Do Next
Proceed to the “Loading the New System Image” section.
Loading the New System Image
This section describes how to load the new system image that you copied into flash memory. First, determine whether you are in ROM monitor mode or in the Cisco IOS CLI, then choose one of the following methods of loading the new system image:
Loading the New System Image from the Cisco IOS Software
Loading the New System Image from ROM Monitor Mode
Loading the New System Image from the Cisco IOS Software
To load the new system image from the Cisco IOS software, follow these steps.
SUMMARY STEPS
1. dir flash0:
2. configure terminal
3. no boot system
4. (Optional) boot system flash0: system-image-filename
5. (Optional) Repeat to specify the order in which the router should attempt to load any backup system images.
6. exit
7. show version
8. If the last digit in the configuration register is 0 or 1, proceed to Step 9. However, if the last digit in the configuration register is between 2 and F, proceed to Step 12.
9. configure terminal
10. config-register 0x2102
11. exit
12. copy run start
13. reload
14. When prompted to save the system configuration, enter no.
15. When prompted to confirm the reload, enter y.
16. show version
DETAILED STEPS
Step 1 dir flash0:
Use this command to display a list of all files and directories in flash memory:
Router# dir flash0:
  Directory of flash0:/
  3 -rw- 6458388 Mar 01 1993 00:00:58 c38xx.tmp
1580 -rw- 6462268 Mar 06 1993 06:14:02 c38xx-ata
  63930368 bytes total (51007488 bytes free)
  Note Determine whether the new system image is the first file or the only file listed in the dir flash0: command output ( is not required if it is the first file or only file listed).
Step 2 configure terminal
Use this command to enter global configuration mode:
Router# configure terminal
  Router(config)#
  Step 3 no boot system
Use this command to delete all entries in the bootable image list, which specifies the order in which the router attempts to load the system images at the next system reload or power cycle:
Router(config)# no boot system
  Step 4 If the new system image is the first file or the only file displayed in the dir flash0: command output, you do not need to perform the following step.
boot system flash0: system-image-filename
Use this command to load the new system image after the next system reload or power cycle. For example:
Router(config)# boot system flash0: c2900-universalk9-mz.bin
  Step 5 (Optional) Repeat to specify the order in which the router should attempt to load any backup system images.
Step 6 exit
Use this command to exit global configuration mode:
Router(config)# exit
Router#
  Step 7 show version
Use this command to display the configuration register setting:
Router# show version
  Cisco Internetwork Operating System Software
.
.
.
Configuration register is 0x0
  Router#
  Step 8 If the last digit in the configuration register is 0 or 1, proceed to Step 9. However, if the last digit in the configuration register is between 2 and F, proceed to Step 12.
Step 9 configure terminal
Use this command to enter global configuration mode:
Router# configure terminal
  Router(config)#
  Step 10 config-register 0x2102
Use this command to set the configuration register so that, after the next system reload or power cycle, the router loads a system image from the boot system commands in the startup configuration file:
Router(config)# config-register 0x2102
  Step 11 exit
Use this command to exit global configuration mode:
Router(config)# exit
Router#
  Step 12 copy run start
Use this command to copy the running configuration to the startup configuration:
Router# copy run start
  Step 13 reload
Use this command to reload the operating system:
Router# reload
  Step 14 When prompted to save the system configuration, enter no :
System configuration has been modified. Save? [yes/no]: no
  Step 15 When prompted to confirm the reload, enter y :
Proceed with reload? [confirm] y
  Step 16 show version
Use this command to verify that the router loaded the proper system image:
Router# show version
  00:22:25: %SYS-5-CONFIG_I: Configured from console by console
Cisco Internetwork Operating System Software
.
.
.
System returned to ROM by reload
System image file is "flash0:c2900-universalk9-mz.bin"
    What to Do Next
Proceed to the “Saving Backup Copies of Your New System Image and Configuration” section.
Loading the New System Image from ROM Monitor Mode
To load the new system image from ROM monitor mode, follow these steps.
SUMMARY STEPS
1. dir flash0: [ partition-number : ]
2. confreg 0x2102
3. boot flash0: [ partition-number : ] filename
4. After the system loads the new system image, press Return a few times to display the Cisco IOS command-line interface (CLI) promp t.
5. enable
6. configure terminal
7. no boot system
8. boot system flash0: new-system-image-filename
9. (Optional) Repeat to specify the order in which the router should attempt to load any backup system images.
10. exit
11. copy run start
DETAILED STEPS
Step 1 dir flash0: [ partition-number : ]
Use this command to list files in flash memory:
rommon > dir flash0:
  program load complete, entry point: 0x4000000, size: 0x18fa0
Directory of flash0:
  2 48296872 -rw- c3900-universalk9-mz.SPA
  Note whether the new system image is the first file or the only file listed in the dir flash0: command output.
Step 2 confreg 0x2102
Use this command to set the configuration register so that, after the next system reload or power cycle, the router loads a system image from the boot system commands in the startup configuration file:
rommon > confreg 0x2102
  Step 3 boot flash0: [ partition-number : ] filename
Use this command to force the router to load the new system image:
rommon > boot flash0:c2900-universalk9-mz.binT
  Step 4 After the system loads the new system image, press Return a few times to display the Cisco IOS CLI prompt.
Step 5 enable
Use this command to enable privileged EXEC mode, and enter your password if prompted:
Router> enable
Password: <password>
Router#
  Step 6 configure terminal
Use this command to enter global configuration mode:
Router# configure terminal
Router(config)#
  Step 7 no boot system
Eliminate all entries in the bootable image list, which specifies the system image that the router loads at startup:
Router(config)# no boot system
  Step 8 If the new system image is the first file or only the file displayed in the dir flash0: command output, this step is not required.
boot system flash0: new-system-image-filename
Use this command to load the new system image after the next system reload or power cycle:
Router(config)# boot system flash0: c2900-universalk9-mz.bin
  Step 9 (Optional) Repeat to specify the order in which the router should attempt to load any backup system images.
Step 10 exit
Use this command to exit global configuration mode:
Router(config)# exit
Router#
  Step 11 copy run start
Use this command to copy the running configuration to the startup configuration:
Router# copy run start
    What to Do Next
Proceed to the “Saving Backup Copies of Your New System Image and Configuration” section.
Saving Backup Copies of Your New System Image and Configuration
To aid file recovery and to minimize downtime in the event of file corruption, we recommend that you save backup copies of the startup configuration file and the Cisco IOS software system image file on a server.
Tip Do not erase any existing backup copies of your configuration and system image that you saved before upgrading your system image. If you encounter serious problems using your new system image or startup configuration, you can quickly revert to the previous working configuration and system image.
For more detailed information, see the “Managing Configuration Files” chapter and the “Loading and Maintaining System Images” chapter of the Cisco IOS Configuration Fundamentals Configuration Guide at:
http://www.cisco.com/en/US/docs/ios/fundamentals/configuration/guide/12_4/cf_12_4_book.html.
To save backup copies of the startup configuration file and the system image file, complete the following steps.
SUMMARY STEPS
1. enable
2. copy nvram:startup-config { ftp: | rcp: | tftp: }
3. dir flash0:
4. copy flash0: { ftp: | rcp: | tftp: }
DETAILED STEPS
  Command or Action
Purpose
Step 1
enable
  Router> enable
Enables privileged EXEC mode.
Enter your password if prompted.
Step 2
copy nvram:startup-config { ftp: | rcp: | tftp: }
  Router# copy nvram:startup-config ftp:
Copies the startup configuration file to a server.
The configuration file copy serves as a backup copy.
Enter the destination URL when prompted.
Step 3
dir flash0:
  Router# dir flash0:
Displays the layout and contents of a flash memory file system.
Write down the name of the system image file.
Step 4
copy flash0: { ftp: | rcp: | tftp: }
  Router# copy flash0: ftp:
Copies a file from flash memory to a server.
Copy the system image file to a server to serve as a backup copy.
Enter the flash memory partition number if prompted.
Enter the filename and destination URL when prompted.
Examples
Copying the Startup Configuration to a TFTP Server: Example
The following example shows the startup configuration being copied to a TFTP server:
Router# copy nvram:startup-config tftp:
  Remote host[]? 172.16.101.101
  Name of configuration file to write [rtr2-confg]? <cr>
Write file rtr2-confg on host 172.16.101.101?[confirm] <cr>
![OK]
Copying from Flash Memory to a TFTP Server: Example
The following example uses the dir flash0: privileged EXEC command to obtain the name of the system image file and the copy flash0: tftp: privileged EXEC command to copy the system image to a TFTP server. The router uses the default username and password.
Router# dir flash0:
  System flash directory:
File Length Name/status
1 4137888 c2900-mz
[4137952 bytes used, 12639264 available, 16777216 total]
16384K bytes of processor board System flash (Read/Write)\
  Router# copy flash0: tftp:
IP address of remote host [255.255.255.255]? 192.0.0.1
filename to write on tftp host? c2900-universalk9-mz
writing c2900-mz !!!!...
successful ftp write.
How to Upgrade the IOS Image on the Access Point
This section describes how to upgrade the Cisco IOS image on the access point.
To upgrade the IOS image on the access point, establish connectivity between the access point and the download server by following these steps:
Define the WAN Interface on the Router
Secure an IP Address on the Access Point
Confirm Connectivity and Settings
Upgrading the IOS Image on the Access Point
Define the WAN Interface on the Router
To define a WAN interface to connect to a TFTP network for image download, follow these steps, beginning in global configuration mode.
SUMMARY STEPS
1. interface gigabitethernet slot/port
2. ip address ip-address mask
3. no shutdown
4. exit
DETAILED STEPS
  Command
Purpose
Step 1
interface gigabitethernet slot/port
  Router(config)# interface gigabitethernet 0/0
Router(config-if)#
Enters the configuration mode for a Gigabit Ethernet interface on the router.
Step 2
ip address ip-address mask
  Router(config-if)# ip address 192.168.12.2 255.255.255.0
Router(config-if)#
Sets the IP address and subnet mask for the specified Gigabit Ethernet interface.
Step 3
no shutdown
  Router(config-if)# no shutdown
Router(config-if)#
Enables the Gigabit Ethernet interface, changing its state from administratively down to administratively up.
Step 4
exit
  Router(config-if)# exit
Router(config)#
Exits configuration mode for the Gigabit Ethernet interface and returns to global configuration mode.
Secure an IP Address on the Access Point
To secure an IP address on the access point so it can communicate with an external server where a Cisco IOS image is located, use the DHCP server functionality on the router. The host router provides the access point DHCP server functionality through the DHCP pool. The access point communicates with the external server and setup option 43 for the controller IP address in the DHCP pool configuration.
Example
The following example shows a dhcp pool configuration:
  ip dhcp pool embedded-ap-pool
network 192.168.10.0 255.255.255.0
dns-server 171.70.168.183
default-router 192.168.10.1
int vlan1
ip address 192.168.10.0 255.255.255.0
Confirm Connectivity and Settings
Perform the following steps to confirm connectivity.
1. Ping the external server from the router to confirm connectivity.
2. Enter the service-module wlan-ap 0 session command to establish a session into the access point. For instructions, see “Starting a Wireless Configuration Session” section.
3. Ping the external server from the access point to confirm connectivity.
The following example shows a sample router and access point configuration:
Example
interface Wlan-GigabitEthernet0/0
!
interface GigabitEthernet0/0
ip address dhcp
duplex auto
speed auto
!
interface wlan-ap0
description Service module interface to manage the embedded AP
ip address 10.0.0.1 255.0.0.0
arp timeout 0
!
interface GigabitEthernet0/1
no ip address
shutdown
duplex auto
speed auto
!
interface Vlan1
ip address 192.168.10.1 255.255.255.0
!
ip forward-protocol nd
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0
!
no ip http server
Upgrading the IOS Image on the Access Point
Follow the image upgrade instructions at Cisco.com using the IOS CLI, http://www.cisco.com/en/US/docs/wireless/access_point/12.3_8_JA/configuration/guide/
s38mfw.html#wp1035609.
Note If the access point enters Bootloader mode, manually configure the IP address, default router, netmask, and default gateway to upgrade the IOS image.
Note The IP address must be assigned to the same subnet as the VLAN1 interface on the router. Here is an example configuration.
Example
ap: set
CONTROLLER_TYPE=0x05A4
DEFAULT_ROUTER=192.168.10.1
ENABLE_BREAK=yes
IOS_STATIC_DEFAULT_GATEWAY=192.168.10.1
IP_ADDR=192.168.10.2
MANUAL_BOOT=yes
NETMASK=255.255.255.0
PEP_PRODUCT_ID=AP801AGN-A-K9
PRODUCT_MODEL_NUM=AP801AGN-A-K9
TOP_ASSY_SERIAL_NUM=FHKTESTTEST
ap: copy tftp://223.255.254.254/saek/ap801-k9w7-tar.124-10b.JDA flash0: ap801-k9w7-tar.124-10b.JDA
Additional References
The following sections provide references related to upgrading the system image on your router.
Related Documents and Websites
Related Topic
Document Title or Website
Matching Cisco IOS releases and features to hardware
Cisco Feature Navigator
http://www.cisco.com/go/fn
Downloading system images
Displaying minimum DRAM and flash memory requirements
Cisco IOS Upgrade Planner
http://www.cisco.com/cgi-bin/Software/Iosplanner/Planner-tool/
iosplanner.cgi
Choosing and downloading system images
Software Download Center
http://www.cisco.com/kobayashi/sw-center/index.shtml
Loading and maintaining system images
http://www.cisco.com/en/US/docs/ios/fundamentals/configuration/guide/cf_system_images.html
Removing, inserting, and upgrading compact flash memory cards
Hardware installation guide for your router
Connecting your PC to the router console port
Hardware installation guide for your router
Technical Assistance
Description
Link
Technical Assistance Center (TAC) home page, containing 30,000 pages of searchable technical content, including links to products, technologies, solutions, technical tips, and tools. Registered Cisco.com users can log in from this page to access even more content.6
http://www.cisco.com/public/support/tac/home.shtml
6.You must have an account at Cisco.com. If you do not have an account or have forgotten your username or password, click Cancel at the login dialog box and follow the instructions that appear.
Was this Document Helpful?
Yes No
Feedback
Customers Also Viewed
Upgrade Access Routers Software
Cisco 3900 Series, 2900 Series, and 1900 Series Software Configuration Guide --- Using ROM Monitor
Contact Cisco
Open a Support Case
(Requires a Cisco Service Contract)