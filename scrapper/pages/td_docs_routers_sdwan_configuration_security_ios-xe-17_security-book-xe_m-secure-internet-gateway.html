End-User Guides
Cisco SD-WAN Security Configuration Guide, Cisco IOS XE Release 17.x
Bias-Free Language
Book Contents
Download
Print
Updated:
April 15, 2020
Chapter: Integrate Your Devices With Secure Internet Gateways
Chapter Contents
Table 1. Feature History
Feature
Release Information
Description
IPSEC/GRE Tunnel Routing and Load-Balancing Using ECMP
Cisco IOS XE Release 17.4.1a
Cisco vManage Release 20.4.1
This feature allows you to use the SIG template to steer application traffic to Cisco Umbrella or a Third party SIG Provider. The application traffic is steered to a SIG based on a defined data policy and other match criteria.
This feature also allows you to configure weights for multiple GRE/IPSEC tunnels for distribution of traffic among multiple tunnels. The traffic distribution enables you to balance the load among the tunnels. You can also configure the weights to achieve Equal-cost multi-path (ECMP) routing.
Support for Zscaler Automatic IPSec Tunnel Provisioning
Cisco IOS XE Release 17.5.1a
Cisco vManage Release 20.5.1
This feature automates the provisioning of tunnels from Cisco Catalyst SD-WAN routers to Zscaler. Using your Zscaler partner API credentials, you can automatically provisions tunnels to Zscaler Internet Access (ZIA) Public Service Edges. You can choose Zscaler in the Cisco Security Internet Gateway (SIG) and SIG credentials feature templates to automate tunnel provisioning.
SIG Integration Improvements
Cisco IOS XE Release 17.8.1a
Cisco vManage Release 20.8.1
Source-Only Load Sharing: When you configure two or more active tunnels to a Secure Internet Gateway (SIG), different traffic flows from the same source IP address, with different destination public IP addresses, may be mapped to use different tunnels. With this feature, you can configure all traffic flows from a particular source IP address, irrespective of the destination IP address, to be routed to the SIG through only one of the active tunnels.
IPSec Tunnel Creation Improvements in an Active-Active Setup: This feature ensures that when you provision an IPSec tunnel, the control and data traffic are sent through the same the physical interface toward the SIG endpoint. Pinning the control and data packets to the same physical interface removes a limitation that exists in previous releases.
In previous releases, in certain situations, the control and data packets may be routed to the SIG endpoint through different physical interfaces. When the packets are routed in this way, one of the following scenarios occurs:
If the source is a physical interface, tunnel creation fails because the source IP address of the negotiation packets differs from the source IP address of the keepalive control packet.
If the source is a loopback interface, the source IP address of the data packets differs from the source IP address of the IPSec SA negotiated through the control packets. This difference causes the SIG endpoint to drop the data packets.
Layer 7 Health Check for Manual Tunnels
Cisco IOS XE Release 17.8.1a
Cisco vManage Release 20.8.1
You can create and attach trackers to manually created GRE or IPSec tunnels to a SIG endpoint. Trackers help failover traffic when a SIG tunnel is down.
Automatic GRE Tunnels to Zscaler
Cisco IOS XE Release 17.9.1a
Cisco vManage Release 20.9.1
With this feature, use the Secure Internet Gateway (SIG) feature template to provision automatic GRE tunnels to Zscaler SIGs. In earlier releases, the SIG template only supported the provisioning of automatic IPSec tunnels to Zscaler SIGs.
Global SIG Credentials Template
Cisco IOS XE Release 17.9.1a
Cisco vManage Release 20.9.1
With this feature, create a single global Cisco SIG Credentials template for each SIG provider (Cisco Umbrella or Zscaler). When you attach a Cisco SIG template to a device template, Cisco vManage automatically attaches the applicable global Cisco SIG Credentials template to the device template.
Monitor Automatic SIG Tunnel Status and Events
Cisco IOS XE Release 17.9.1a
Cisco vManage Release 20.9.1
Monitor security events related to automatic SIG tunnels using the Security Events pane on the Monitor > Security page, and the Events dashboard on the Monitor > Logs page.
Monitor automatic SIG tunnel status using the SIG Tunnel Status pane on the Monitor > Security page, and the SIG Tunnels dashboard on the Monitor > Tunnels page.
Configure SIG Tunnels in a Security Feature Profile
Cisco IOS XE Release 17.10.1a
Cisco vManage Release 20.10.1
With this feature, create a Security feature profile and associate it with one or more configuration groups. In the Security feature profile, configure the Secure Internet Gateway feature to create automatic or manual SIG tunnels. After configuring the feature, deploy the configuration group on the desired WAN edge devices to create SIG tunnels from the devices to the configured SIG endpoints.
Cisco Umbrella Multi-Org Support
Cisco IOS XE Release 17.11.1a
Cisco vManage Release 20.11.1
This feature supports management of multiple organizations through a single parent organization. With this feature, Cisco SD-WAN Umbrella for SIG support security policy requirements for different regions of the SD-WAN network.
Cisco SD-WAN edge devices support SD-WAN, routing, security, and other LAN access features that can be managed centrally. On high-end devices, you can enable all these features while providing the scale and performance required by large enterprises. However, on lower-end devices, enabling all the security features simultaneously can degrade performance. To avoid the performance degradation, integrate lower-end devices with Secure Internet Gateways (SIG) that do most of the processing to secure enterprise traffic. When you integrate a Cisco SD-WAN edge device with a SIG, all client internet traffic, based on routing or policy, is forwarded to the SIG. In addition, the SIG can also protect roaming users, mobile users, and BYOD users.
Options to Integrate Your Devices with Secure Internet Gateways
Configure Tunnels
Configure SIG Tunnels in a Security Feature Profile
Monitor SIG Events
Monitor SIG Tunnels
Monitor Automatic SIG Tunnels Using CLI
Troubleshoot Integrating Your Devices With Secure Internet Gateways
Options to Integrate Your Devices with Secure Internet Gateways
To integrate Cisco SD-WAN edge devices with a SIG, you can use:
Automatic tunnels
Manual tunnels
Automatic Tunnels
Manual Tunnels
High Availability and Load Balancing
Support for Layer 7 Health Check
Global SIG Credentials Template
Automatic Tunnels
Using the Cisco Secure Internet Gateway (SIG) feature template, you can provision automatic IPSec tunnels to Cisco Umbrella SIGs, or automatic IPSec or GRE tunnels to Zscaler SIGs.
Provision an automatic tunnel as follows:
Complete any prerequisites for the SIG.
Specify Cisco Umbrella or Zscaler credentials using the Cisco SIG Credentials feature template.
Specify the details for the tunnel to the SIGs using the Cisco Security Internet Gateway (SIG) feature template.
In the template, define the parameters for the tunnels such as the interface name, the source interface, the SIG provider, and so on.
Edit the Cisco VPN feature template that provides the service route for the devices to the internet. Add a service route to the SIG in the Cisco VPN feature template.
Add feature templates to the device templates of the devices that should route traffic to the SIG.
Attach the device templates to the devices.
When you attach the device template, the device sets up tunnels to the SIGs and redirects traffic to it.
Cisco Umbrella Integration
From Cisco IOS XE Release 17.2.1r and Cisco vManage Release 20.2.1, use Cisco Umbrella as a SIG by choosing Umbrella as the SIG provider in the Cisco Security Internet Gateway (SIG) feature template, and then define IPSec tunnels, and tunnel parameters. Use the SIG credentials feature template to specify the Umbrella Organization ID, Registration Key, and Secret. For information on configuring automatic tunnelling, see Configure Automatic Tunnels Using Cisco vManage.
Cisco Umbrella Multi-Org Support
Minimum releases: Cisco IOS XE Release 17.11.1a and Cisco vManage Release 20.11.1
The Cisco SD-WAN Umbrella for SIG support security policy requirements for different sub-regions of their SD-WAN network. This feature is supported for both DNS security policy and SIG templates.
Although Cisco Umbrella's individual dashboards can only support a single domain, the multi-org feature allows you to view and manage multiple domains or logically separate network segments from a particular dashboard. The multi-org setup is suitable for organizations that are highly distributed across different locations where networks are all connected, but where different regions require different security policies. The multi-org feature is also helpful for networks with more than one Active Directory (AD) domain, whether within an AD or logically separate domains.
Zscaler Integration
You can integrate Cisco SD-WAN edge devices to Zscaler SIGs by provisioning automatic IPsec or GRE tunnels between the edge devices and the SIGs.
Automatic IPSec Tunnels: From Cisco IOS XE Release 17.5.1a and Cisco vManage Release 20.5.1, you can provision automatic IPSec tunnels to Zscaler Internet Access (ZIA) Public Service Edges using the Cisco Security Internet Gateway (SIG) feature template. ZIA Public Service Edges are secure internet gateways that can inspect and secure traffic from Cisco SD-WAN devices. The devices use Zscaler APIs to create IPSec tunnels by doing the following:
Establish an authenticated session with ZIA.
Based on the IP address of the device, obtain a list of nearby data centres.
Provision the VPN credentials and location using ZIA APIs.
Using the VPN credentials and location, create an IPSec tunnel between the ZIA Public Service Edges and the device.
Automatic GRE Tunnels: From Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1, you can provision automatic GRE tunnels to Zscaler Internet Access (ZIA) Public Service Edges using the Cisco Security Internet Gateway (SIG) feature template. The devices use Zscaler APIs to create the GRE tunnels.
For information on configuring automatic tunnelling, see Configure Automatic Tunnels Using Cisco vManage.
Manual Tunnels
You can create a GRE or IPSec tunnel to a third-party SIG or a GRE tunnel to a Zscaler SIG by defining the tunnel properties in the Cisco Secure Internet Gateway (SIG) feature template.
Provision manual tunnels as follows:
Specify the details for the tunnel to the SIG by using the Cisco Security Internet Gateway (SIG) feature template.
In the template, define the parameters for the tunnels such as the interface name, the source interface, the SIG provider, and so on.
Edit the Cisco VPN feature template that provides the service route for the devices to the internet. Add a service route to the SIG in the Cisco VPN feature template.
Add feature templates to the device templates of the devices that should route traffic to the SIG.
Attach the device templates to the devices.
When you attach the device template, the device sets up the defined IPSec or GRE tunnels to the SIG and redirects traffic to it.
High Availability and Load Balancing
When you connect a Cisco SD-WAN edge device to Cisco Umbrella, Zscaler, or a third-party SIG, you can connect the device to a primary data center and a secondary data center. Also, you can provision more than one tunnel to each data center.
Active Tunnels: You can provision up to four IPSec tunnels to the primary data center. These tunnels serve as active tunnels, and when two or more active tunnels are provisioned, the traffic toward the SIG is distributed among these tunnels, increasing the available bandwidth toward the SIG. From Cisco IOS XE Release 17.4.1 and Cisco vManage Release 20.4.1, you can distribute the traffic equally among the active tunnels to achieve an equal-cost multi-path (ECMP) distribution, or assign different weights to the active tunnels so that some tunnels carry more traffic toward the SIG than the others.
Back-up Tunnels: You can provision up to four IPSec tunnels to the secondary data center, one for each active tunnel that you have provisioned to the primary data center. These tunnels to the secondary data center serve as back-up tunnels. When an active tunnel fails, the traffic toward the SIG is sent through the corresponding back-up tunnel. When you provision two or more back-up tunnels, the traffic toward the SIG is distributed among these tunnels, increasing the available bandwidth toward the SIG. From Cisco IOS XE Release 17.4.1 and Cisco vManage Release 20.4.1, you can distribute the traffic equally among the back-up tunnels to achieve an ECMP distribution, or assign different weights to the back-up tunnels so that some tunnels carry more traffic toward the SIG than the others.
By provisioning two or more active tunnels and distributing the traffic among them, while not provisioning any back-up tunnels, you can create an active-active setup. By provisioning a back-up tunnel for each active tunnel, you can create an active-back-up setup.
Load Sharing Among Tunnels
When you connect a Cisco SD-WAN edge device to a SIG and redirect internet-bound traffic to the SIG, any traffic from the branch that is destined for a public IP address passes through the SIG. If you have provisioned more than one tunnel to carry traffic to the SIG, Cisco Express Forwarding (CEF) may map different traffic flows from the same source IP address, and with different public IP address destinations, to different SIG tunnels.
Source-Only Load Sharing: From Cisco IOS XE Release 17.8.1a and Cisco vManage Release 20.8.1, you can configure the traffic from a particular source IP address to be sent to the SIG over only one of the tunnels, irrespective of the destination public IP address. Cisco Express Forwarding (CEF) maps each source IP address to one of the tunnels, distributing traffic from different source IP addresses among the tunnels. For more information, see Configure Source-Only Load Sharing.

Note
This configuration does not create a sticky mapping between source IP addresses and tunnels to the SIG. If one or more of the tunnels are down, CEF maps source IP addresses to the remaining tunnels. During this mapping, traffic from a particular source IP address may be sent to the SIG over a tunnel that is different from the tunnel that was previously assigned.
Support for Layer 7 Health Check
You can monitor the health of tunnels towards the SIG using trackers attached to the tunnels. These trackers are used to automatically fail over to backup tunnels based on the health of the tunnel.
While creating automatic tunnels, Cisco vManage creates and attaches a default tracker with default values for failover parameters. However, you can also create customized trackers with failover parameter values that suit your SLA requirements.
In the case of manually created tunnels, create and attach the tracker.
The following table summarizes tracker support for automatic and manual tunnels:
Tunnel Type Default Tracker Customized Tracker
Automatic IPSec Tunnels Yes
Yes
Minimum releases: Cisco IOS XE Release 17.6.2 and Cisco vManage Release 20.6.2
Automatic GRE Tunnels
Yes
Yes
Minimum releases: Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1
Manual No
Yes
Minimum releases: Cisco IOS XE Release 17.8.1a and Cisco vManage Release 20.8.1
The tunnel health is monitored as follows:
Based on the configuration in the System feature template, Cisco vManage creates a tracker according to the default or customized failover parameters that you define in the SIG template. This tracker uses VPN 65530. Cisco vManage reserves VPN 65530 for tracker VPNs.
The tracker resolves the IP address of the SIG service using VPN 0.
For automatic tunnels to Cisco Umbrella or Zscaler, the tracker uses the following URLs to connect to the SIG:
Cisco Umbrella: http://service.sig.umbrella.com
Zscaler: http://gateway.zscaler-cloud-url/vpntest
The device sets up tunnels to the SIG.
For each tunnel, the device creates a named TCP socket that it uses to identify the tunnels.
The tracker monitors the health of the tunnel using HTTP probes. The tracker calculates the round-trip time (RTT) and compares it to the configured SLA parameters.
If the tunnel does not meet the SLA parameters, the tracker marks the tunnel as down.
The device updates the routes for any service VPNs that are connected to the tunnel.
Related Concepts
Create Automatic Tunnels Using a Cisco SIG Feature Template
Create Manual Tunnels Using Cisco SIG Feature Template
Global SIG Credentials Template
Minimum supported release: Cisco vManage Release 20.9.1
In Cisco vManage Release 20.8.x and earlier releases, you must create a Cisco SIG Credentials template for a SIG provider (Cisco Umbrella or Zscaler) for each Cisco IOS XE SD-WAN device model that you wish to connect to the SIG.
From Cisco vManage Release 20.9.1, create a single global Cisco SIG Credentials template for a SIG provider (Cisco Umbrella or Zscaler) and attach the template to the required Cisco IOS XE SD-WAN devices, irrespective of the device model. When you attach a Cisco SIG feature template that configures automatic SIG tunnels to a device template, Cisco vManage automatically attaches the applicable global SIG Credentials template to the device template.
The Cisco IOS XE SD-WAN devices of your organization connect to Cisco Umbrella or Zscaler using a common organization account with the SIG provider. As such, it is beneficial to configure the organization account credentials on the devices through a global template. When you modify the Cisco Umbrella or Zscaler credentials, update only one global template for the modified credentials to take effect on the attached Cisco IOS XE SD-WAN devices.

Note
After you upgrade Cisco vManage software from Cisco vManage Release 20.8.x or earlier to Cisco vManage Release 20.9.1 or later, the device-model-specific Cisco SIG Credentials templates created in Cisco vManage Release 20.8.x or earlier become read-only. The read-only status allows you to only view the configured credentials. To update the credentials configured in Cisco vManage Release 20.8.x or an earlier release, create a Cisco SIG Credentials template for the SIG provider.
If you try to create or modify a Cisco SIG feature template, Cisco vManage prompts you to create a global Cisco SIG Credentials template for the SIG provider.
Related Concepts
Create Cisco Umbrella SIG Credentials Template
Create Zscaler SIG Credentials Template
Configure Tunnels
Configure Automatic Tunnels Using Cisco vManage
Create Manual Tunnels Using Cisco SIG Feature Template
Redirect Traffic to a SIG
Create Device Template
Attach Template to Devices
Configure Source-Only Load Sharing
Configuring a GRE Tunnel or IPsec Tunnel from Cisco vManage
Configure Automatic Tunnels Using Cisco vManage
Prerequisites
To configure automatic tunneling to a SIG, complete the following requisites:
Cisco Umbrella: To configure automatic tunnels to Cisco Umbrella, you can do one of the following
For Cisco vManage to fetch the API keys, specify Smart Account credentials here: Administration > Settings > Smart Account Credentials. Your Cisco Smart Account is the account that you use to log in to the Cisco Smart Software Manager (CSSM) portal.
To manually specify the API keys, generate Umbrella Management API keys. See Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
Specify the generated keys in the Cisco SIG Credentials template.
Zscaler Internet Access (ZIA): To configure automatic tunnels to Zscaler, do the following:
Create partner API keys on the ZIA Partner Integrations page.
Add the Partner Administrator role to the partner API keys.
Create a Partner Administrator.
Activate the changes.
For more information, see Managing SD-WAN Partner Keys on the Zscaler Help Center.
Specify the generated keys in the Cisco SIG Credentials template.
Create Cisco Umbrella SIG Credentials Template
Create Zscaler SIG Credentials Template
Create Cisco SIG Credentials Template
Create Automatic Tunnels Using a Cisco SIG Feature Template
Create Cisco Umbrella SIG Credentials Template
Minimum supported release: Cisco vManage Release 20.9.1
When you Create Automatic Tunnels Using a Cisco SIG Feature Template, on selecting Umbrella as the SIG provider, Cisco vManage prompts you to create the global SIG credentials template, if you haven't yet created the template. Click Click here to create - Cisco SIG Credentials template to create the Cisco Umbrella SIG credentials template.
Template Name and Description fields are prefilled:
Table 2. Cisco SIG Credentials Template Name and Description
Field
Description
Template Name
(Read only) Umbrella Global Credentials
Description
(Read only) Global credentials for Umbrella
Configure Cisco Umbrella Credentials
In the Basic Details section, do one of the following:
Enable Cisco vManage to fetch credentials from the Cisco Umbrella portal:
Ensure that you have added your Cisco Smart Account credentials here: Administration > Settings > Smart Account Credentials.
Cisco vManage uses the Cisco Smart Account credentials to connect to the Cisco Umbrella portal.
Click Get Keys.
Enter Cisco Umbrella credentials:
Field
Description
SIG Provider
(Read only) Umbrella
Organization ID
Enter the Cisco Umbrella parent organization ID for your organization.
For more information, see Find Your Organization ID in the Cisco Umbrella SIG User Guide.
Registration Key
Enter the Umbrella Management API Key. It is part of DNS security policy under unified security policy.
For more information, see Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
Secret
Enter the Umbrella Management API Secret.
To save the template, click Save.
Create Zscaler SIG Credentials Template
Minimum release: Cisco vManage Release 20.9.1
When you Create Automatic Tunnels Using a Cisco SIG Feature Template, on selecting Zscaler as the SIG provider, Cisco vManage prompts you to create the global SIG credentials template, if you haven't yet created the template. Click Click here to create - Cisco SIG Credentials template to create the Zscaler SIG credentials template.
Template Name and Description fields are prefilled:
Table 3. Cisco SIG Credentials Template Name and Description
Field
Description
Template Name
(Read only) Zscaler-Global-Credentials
Description
(Read only) Global credentials for Zscaler
In the Basic Details section, enter the Zscaler credentials:
Table 4. Zscaler Credentials
Field
Description
SIG Provider
(Read only) Zscaler
Organization
Name of the organization in Zscaler cloud.
For more information, see ZIA Help > Getting Started > Admin Portal > About the Company Profile.
Partner base URI
This is the base URI that Cisco vManage uses in REST API calls.
To find this information on the Zscaler portal, see ZIA Help > ZIA API > API Developer & Reference Guide > Getting Started.
Username
Username of the SD-WAN partner account.
Password
Password of the SD-WAN partner account.
Partner API key
Partner API key.
To find the key in Zscaler, see ZIA Help > Partner Integrations > Managing SD-WAN Partner Keys.
To save the template, click Save.
Create Cisco SIG Credentials Template
Applicable releases: Cisco vManage Release 20.8.x and earlier releases.
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is titled Feature.
Click Add Template.
Choose the device for which you are creating the template.
Under Other Templates, click Cisco SIG Credentials.
In the Template Name field, enter a name for the feature template.
This field is mandatory and can contain only uppercase and lowercase letters, the digits 0 through 9, hyphens (-), and underscores (_). It cannot contain spaces or any other characters.
In the Description field, enter a description for the feature template.
In Basic Details section, do the following:
SIG Provider: Click Umbrella or Zscaler.
For Cisco Umbrella, enter the following registration parameters or click Get Keys to have Cisco vManage fetch these parameters from the Cisco Umbrella portal.
Organization ID
Child Org
Child Org List
Registration Key
Secret

Note
Starting from Cisco IOS XE Release 17.11.1a and Cisco vManage Release 20.11.1, you can select Child Org ID from the dropdown when a parent Org ID of a multi-org tenant is added to the SIG Credentials.
To fetch the parameters, Cisco vManage uses your Smart Account credentials to connect to the Cisco Umbrella portal. To manually enter the parameters, generate the values in your Umbrella account as described here.
For Zscaler, enter the following details:
Field Description
Organization The name of the organization in Zscaler cloud. To find this information in Zscaler, see Administration > Company Profile.
Child Org
Minimum releases: Cisco IOS XE Release 17.11.1a and Cisco vManage Release 20.11.1
Enter the child organization information in the SIG template.
Child Org List
Minimum releases: Cisco IOS XE Release 17.11.1a and Cisco vManage Release 20.11.1
Select the child org from the Child Org List drop-down list.
Partner base URI This is the Zscaler Cloud API that Cisco SD-WAN uses to connect to Zscaler. To find this information in Zscaler, see Administration > API Key Management.
Username Username of the SD-WAN partner account.
Password Password of the SD-WAN partner account.
Partner API key The partner API key. To find the key in Zscaler, see Zscaler Cloud Administration > Partner Integrations > SD-WAN.
Click Save.
Create Automatic Tunnels Using a Cisco SIG Feature Template
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is called Feature.
Click Add Template.
Choose the device for which you are creating the template.
Under VPN, click Cisco Secure Internet Gateway (SIG).
In the Template Name field, enter a name for the feature template.
This field is mandatory and can contain only uppercase and lowercase letters, the digits 0 to 9, hyphens (-), and underscores (_). It cannot contain spaces or any other characters.
In the Description field, enter a description for the feature template.
(From Cisco vManage Release 20.9.1) SIG Provider: Click Umbrella or Zscaler.
From Cisco vManage Release 20.9.1, on selecting Umbrella or Zscaler as the SIG provider, Cisco vManage prompts you to create the corresponding global SIG credentials template if you haven't yet created the template. Click Click here to create - Cisco SIG Credentials template to create the Cisco Umbrella or Zscaler SIG credentials template.

Note
Starting from Cisco IOS XE Release 17.11.1a and Cisco vManage Release 20.11.1, you can select Child Org ID from the dropdown when a parent Org ID of a multi-org tenant is added to the SIG Credentials.
To create one or more trackers to monitor tunnel health, do the following in the Tracker section:

Note
From Cisco IOS XE Release 17.6.2 and Cisco vManage Relase 20.6.2 , you can create customized trackers to monitor the health of automatic tunnels. If you do not customize the SLA parameters, Cisco vManage creates a default tracker for the tunnel.
Source IP Address: Enter a source IP address for the probe packets.
Click New Tracker.
Configure the following:
Table 5. Tracker Parameters
Field Description
Name Enter a name for the tracker. The name can be up to 128 alphanumeric characters.
Threshold
Enter the wait time for the probe to return a response before declaring that the configured endpoint is down.
Range: 100 to 1000 milliseconds
Default: 300 milliseconds.
Interval
Enter the time interval between probes to determine the status of the configured endpoint.
Range: 20 to 600 seconds
Default: 60 seconds
Multiplier
Enter the number of times the probes are resent before determining that a tunnel is down.
Note
  When tunnel status changes continuously within a short period of time, the tunnel goes to the flapping state. Starting from Cisco IOS XE Release 17.11.1a, to avoid flapping of tunnels, the tracker waits for the duration equal to the product of multiplier * interval to declare the status of the tunnel.
Range: 1 to 10
Default: 3
API url of endpoint Specify the API URL for the SIG endpoint of the tunnel.
Click Add.
To add more trackers, repeat sub-step b to sub-step d.
To create tunnels, do the following in the Configuration section:
(Cisco 20.8.x and earlier releases) SIG Provider: Click Umbrella or Zscaler.
Click Add Tunnel.
Under Basic Settings, configure the following:
Table 6. Basic Settings
Field Description
Tunnel Type
Click ipsec or gre.
Note
  Automatic GRE tunnels are supported from Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1 and only to Zscaler ZIA.
Interface Name (0..255)
Enter the interface name.
Note
  If you have attached the Cisco VPN Interface IPSec feature template to the same device, ensure that the interface number you enter is different from what you have entered in the IPSec template.
Description
Enter a description for the interface.
Tracker
By default, a tracker is attached to monitor the health of automatic tunnels to Cisco Umbrella or Zscaler.
If you configured a customized tracker in step 8, choose the tracker.
Note
  From Cisco IOS XE Release 17.6.2 and Cisco vManage Relase 20.6.2, you can create customized trackers to monitor the health of automatic tunnels.
Tunnel Source Interface Enter the name of the source interface of the tunnel. This interface should be the egress interface and is typically the internet-facing interface.
Data-Center For a primary data center, click Primary, or for a secondary data center, click Secondary. Tunnels to the primary data center serve as active tunnels, and tunnels to the secondary data center serve as back-up tunnels.
Source Public IP
Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1
Public IP address of the tunnel source interface that is required to create the GRE tunnel to Zscaler.
Default: Auto.
We recommend that you use the default configuration. With the default configuration, the Cisco IOS XE SD-WAN device finds the public IP address assigned to the tunnel source interface using a DNS query. If the DNS query fails, the device notifies Cisco vManage of the failure. Enter the public IP address only if the DNS query fails.
(Optional) Under Advanced Options, configure the following:
Table 7. General
Field Description
Shutdown
Click No to enable the interface; click Yes to disable.
Default: No.
Track this interface for SIG
Enable or disable tracker for the tunnel. By default, Cisco vManage enables a tracker for automatic tunnels.
Default: On.
IP MTU
Specify the maximum MTU size of packets on the interface.
Range: 576 to 2000 bytes
Default: 1400 bytes
TCP MSS
Specify the maximum segment size (MSS) of TPC SYN packets. By default, the MSS is dynamically adjusted based on the interface or tunnel MTU such that TCP SYN packets are never fragmented.
Range: 500 to 1460 bytes
Default: None
DPD Interval
Specify the interval for IKE to send Hello packets on the connection.
Range: 10 to 3600 seconds
Default: 10
DPD Retries
Specify the number of seconds between DPD retry messages if the DPD retry message is missed by the peer.
Once 1 DPD message is missed by the peer, the router moves to a more aggressive state and sends the DPD retry message at the faster retry interval, which is the number of seconds between DPD retries if the DPD message is missed by the peer. The default DPD retry message is sent every 2 seconds. Five aggressive DPD retry messages can be missed before the tunnel is marked as down.
Range: 2 to 60 seconds
Default: 3
Table 8. IKE
Field Name Description
IKE Rekey Interval
Specify the interval for refreshing IKE keys.
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 14400 seconds
IKE Cipher Suite
Specify the type of authentication and encryption to use during IKE key exchange.
Choose one of the following:
AES 256 CBC SHA1
AES 256 CBC SHA2
AES 128 CBC SHA1
AES 128 CBC SHA2
Default: AES 256 CBC SHA1
IKE Diffie-Hellman Group
Specify the Diffie-Hellman group to use in IKE key exchange, whether IKEv1 or IKEv2.
2 1024-bit modulus
14 2048-bit modulus
15 3072-bit modulus
16 4096-bit modulus
Default: 14 2048-bit modulus
Table 9. IPSEC
Field Description
IPsec Rekey Interval
Specify the interval for refreshing IPSec keys.
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 3600 seconds
IPsec Replay Window
Specify the replay window size for the IPsec tunnel.
Options: 64, 128, 256, 512, 1024, 2048, 4096.
Default: 512
IPsec Cipher Suite
Specify the authentication and encryption to use on the IPsec tunnel.
Options:
AES 256 CBC SHA1
AES 256 CBC SHA 384
AES 256 CBC SHA 256
AES 256 CBC SHA 512
AES 256 GCM
NULL SHA1
NULL SHA 384
NULL SHA 256
NULL SHA 512
Default: AES 256 GCM
Perfect Forward Secrecy
Specify the PFS settings to use on the IPsec tunnel.
Choose one of the following Diffie-Hellman prime modulus groups:
Group-2 1024-bit modulus
Group-14 2048-bit modulus
Group-15 3072-bit modulus
Group-16 4096-bit modulus
None: disable PFS.
Default: None
Click Add.
To create more tunnels, repeat sub-step b to sub-step e.
To designate active and back-up tunnels and distribute traffic among tunnels, configure the following in the High Availability section:
Table 10. High Availability
Field Description
Active
Choose a tunnel that connects to the primary data center.
Active Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two active tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
Backup
To designate a back-up tunnel, choose a tunnel that connects to the secondary data center.
To omit designating a back-up tunnel, choose None.
Backup Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two back-up tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
(Optional) Modify the default configuration in the Advanced Settings section:
Table 11. Umbrella
Field Description
Umbrella Primary Data-Center
Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to a specific Cisco Umbrella data center, choose the data center from the drop-down list.
Umbrella Secondary Data-Center
Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to a specific Cisco Umbrella data center, choose the data center from the drop-down list.
Table 12. Zscaler
Field Description
Primary Data-Center
Automatic IPSec tunnels: Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to a specific Zscaler data center, choose the data center from the drop-down list.
Automatic GRE tunnels (Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1): Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to specific Zscaler data center, ensure that you choose a Zscaler data center that is recommended by Zscaler based on geographical proximity to the device. Obtain the recommend list of Zscaler data centers through a GET API request for /vips/recommendedList. In the API request, specify the public IP of your device as the value of the sourceIp query parameter.

For more information on /vips/recommendedList, see ZIA API Developer & Reference Guide.

If you choose a data center that is not in the recommended list, the Cisco IOS XE SD-WAN device reverts to the automatically selected data center.
Secondary Data-Center
Automatic IPSec tunnels: Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to a specific Zscaler data center, choose the data center from the drop-down list.
Automatic GRE tunnels (Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1): Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to specific Zscaler data center, ensure that you choose a Zscaler data center that is recommended by Zscaler based on geographical proximity to the device. Obtain the recommend list of Zscaler data centers through a GET API request for /vips/recommendedList. In the API request, specify the public IP of your device as the value of the sourceIp query parameter.

For more information on /vips/recommendedList, see ZIA API Developer & Reference Guide.

If you choose a data center that is not in the recommended list, the Cisco IOS XE SD-WAN device reverts to the automatically selected data center.
Zscaler Location Name
Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage Release 20.9.1
(Optional) Enter the name of a location that is configured on the ZIA Admin Portal.
If you do not enter a location name, the Zscaler service detects the location based on the received traffic.
For more information about locations, see ZIA Help > Traffic Forwarding > Location Management > About Locations.
Authentication Required
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
XFF Forwarding
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable Firewall
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable IPS Control
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable Caution
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable Surrogate IP
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Display Time Unit
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Minute
Idle Time to Disassociation
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: 0
Enforce Surrogate IP for known browsers
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Refresh Time Unit
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Minute
Refresh Time
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: 0
Enable AUP
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
First Time AUP Block Internet Access
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Force SSL Inspection
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
AUP Frequency
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: 0
Click Save.
Create Manual Tunnels Using Cisco SIG Feature Template
From Cisco IOS XE Release 17.4.1 and Cisco vManage Release 20.4.1, all SIG related workflows for automatic and manual tunnels have been consolidated into the Cisco SIG template. If you are using Cisco IOS XE Release 17.4.1 and Cisco vManage Release 20.4.1, or later, use the Cisco SIG template to configure GRE or IPSec tunnels to a third-party SIG, or GRE tunnels to a Zscaler SIG.
For a software release earlier than Cisco IOS XE Release 17.4.1, Cisco vManage Release 20.4.1, see Configuring a GRE Tunnel or IPsec Tunnel from Cisco vManage.
Layer 7 Health Check: The option to create trackers and monitor the health of manually created tunnels is available from Cisco IOS XE Release 17.8.1a, Cisco vManage Relase 20.8.1. In earlier releases, the Layer 7 Health Check feature is only available if you use VPN Interface GRE/IPSEC templates, and not with Cisco SIG templates.
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Feature Templates is called Feature.
Click Add Template.
Choose the device for which you are creating the template.
Under VPN, click Cisco Secure Internet Gateway (SIG).
In the Template Name field, enter a name for the feature template.
This field is mandatory and can contain only uppercase and lowercase letters, the digits 0 to 9, hyphens (-), and underscores (_). It cannot contain spaces or any other characters.
In the Description field, enter a description for the feature template.
(Optional) To create one or more trackers to monitor tunnel health, do the following in the Tracker section:

Note
The option to create trackers and monitor tunnel health is available from Cisco IOS XE Release 17.8.1a, Cisco vManage Relase 20.8.1.
Source IP Address: Enter a source IP address for the probe packets.
Click New Tracker.
Configure the following:
Field Description
Name
Enter a name for the tracker. The name can be up to 128 alphanumeric characters.
Threshold
Enter the wait time for the probe to return a response before declaring that the configured endpoint is down.
Range: 100 to 1000 milliseconds
Default: 300 milliseconds
Interval
Enter the time interval between probes to determine the status of the configured endpoint.
Range: 20 to 600 seconds
Default: 60 seconds
Multiplier
Enter the number of times to resend probes before determining that a tunnel is down.
Range: 1 to 10
Default: 3
API url of endpoint
Specify the API URL for the SIG endpoint of the tunnel.
Note
  Both HTTP and HTTPS API URLs are supported.
Click Add.
To add more trackers, repeat sub-step b to sub-step d.
To create tunnels, do the following in the Configuration section:
SIG Provider: Click Generic.
Cisco vManage Release 20.4.x and earlier: Click Third Party.
Click Add Tunnel.
Under Basic Settings, configure the following:
Field Description
Tunnel Type
Based on the type of tunnel you wish to create, click ipsec or gre.
Interface Name (0..255)
Enter the interface name.
Note
  If you have attached the Cisco VPN Interface IPSec feature template or the Cisco VPN Interface GRE feature template to the same device, ensure that the interface number you enter is different from what you have entered in the IPSec or GRE templates.
Description
(Optional) Enter a description for the interface.
Source Type
Click INTERFACE.
For Cisco IOS XE SD-WAN devices, INTERFACE is the only supported Source Type.
Tracker
(Optional) Choose a tracker to monitor tunnel health.
Note
  From Cisco IOS XE Release 17.8.1a and Cisco vManage Relase 20.8.1, you can create trackers to monitor tunnel health.
Track this interface for SIG
Enable or disable tracker for the tunnel. By default, Cisco vManage enables a tracker for automatic tunnels.
Default: On.
Tunnel Source Interface
Enter the name of the source interface of the tunnel. This interface should be an egress interface and is typically the internet-facing interface.
Tunnel Destination IP Address/FQDN
Enter the IP address of the SIG provider endpoint.
Preshared Key
This field is displayed only if you choose ipsec as the Tunnel Type.
Enter the password to use with the preshared key.
(Optional) Under Advanced Options, configure the following:
Table 13. (Tunnel Type: gre) General
Field Description
Shutdown
Click No to enable the interface; click Yes to disable.
Default: No.
IP MTU
Specify the maximum MTU size of packets on the interface.
Range: 576 to 2000 bytes
Default: 1400 bytes
TCP MSS
Specify the maximum segment size (MSS) of TPC SYN packets. By default, the MSS is dynamically adjusted based on the interface or tunnel MTU such that TCP SYN packets are never fragmented.
Range: 500 to 1460 bytes
Default: None
Table 14. (Tunnel Type: ipsec) General
Field Description
Shutdown
Click No to enable the interface; click Yes to disable.
Default: No.
IP MTU
Specify the maximum MTU size of packets on the interface.
Range: 576 to 2000 bytes
Default: 1400 bytes
TCP MSS
Specify the maximum segment size (MSS) of TPC SYN packets. By default, the MSS is dynamically adjusted based on the interface or tunnel MTU such that TCP SYN packets are never fragmented.
Range: 500 to 1460 bytes
Default: None
DPD Interval
Specify the interval for IKE to send Hello packets on the connection.
Range: 0 to 65535 seconds
Default: 10
DPD Retries
Specify how many unacknowledged packets to send before declaring an IKE peer to be dead and then removing the tunnel to the peer.
Range: 0 to 255
Default:3
Table 15. (Tunnel Type: ipsec) IKE
Field Description
IKE Rekey Interval
Specify the interval for refreshing IKE keys
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 14400 seconds
IKE Cipher Suite
Specify the type of authentication and encryption to use during IKE key exchange.
Choose one of the following:
AES 256 CBC SHA1
AES 256 CBC SHA2
AES 128 CBC SHA1
AES 128 CBC SHA2
Default: AES 256 CBC SHA1
IKE Diffie-Hellman Group
Specify the Diffie-Hellman group to use in IKE key exchange, whether IKEv1 or IKEv2.
Choose one of the following:
2 1024-bit modulus
14 2048-bit modulus
15 3072-bit modulus
16 4096-bit modulus
Default: 16 4096-bit modulus
IKE ID for Local Endpoint
If the remote IKE peer requires a local end point identifier, specify the same.
Range: 1 to 64 characters
Default: Tunnel's source IP address
IKE ID for Remote Endpoint
If the remote IKE peer requires a remote end point identifier, specify the same.
Range: 1 to 64 characters
Default: Tunnel's destination IP address
Table 16. (Tunnel Type: ipsec) IPSEC
Field Description
IPsec Rekey Interval
Specify the interval for refreshing IPSec keys.
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 3600 seconds
IPsec Replay Window
Specify the replay window size for the IPsec tunnel.
Options: 64, 128, 256, 512, 1024, 2048, 4096.
Default: 512
IPsec Cipher Suite
Specify the authentication and encryption to use on the IPsec tunnel.
Choose one of the following:
AES 256 CBC SHA1
AES 256 CBC SHA 384
AES 256 CBC SHA 256
AES 256 CBC SHA 512
AES 256 GCM
NULL SHA 384
NULL SHA 256
NULL SHA 512
Default: NULL SHA 512
Perfect Forward Secrecy
Specify the PFS settings to use on the IPsec tunnel.
Choose one of the following Diffie-Hellman prime modulus groups:
Group-2 1024-bit modulus
Group-14 2048-bit modulus
Group-15 3072-bit modulus
Group-16 4096-bit modulus
None: disable PFS.
Default: Group-16 4096-bit modulus
Click Add.
To create more tunnels, repeat sub-step b to sub-step e.
To designate active and back-up tunnels and distribute traffic among tunnels, configure the following in the High Availability section:
Table 17. High Availability
Field Description
Active
Choose a tunnel that connects to the primary data center.
Active Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two active tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
Backup
To designate a back-up tunnel, choose a tunnel that connects to the secondary data center.
To omit designating a back-up tunnel, choose None.
Backup Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two back-up tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
Click Save.
Redirect Traffic to a SIG
You can redirect traffic to a SIG in two ways:
Using Data Policy. For more information, see Action Parameters in the Policies Configuration Guide.
Using the Service route to SIG. For more information, see Modify Service VPN Template
Modify Service VPN Template
Modify Service VPN Template
To ensure that the device connects to the SIG, you must modify the Cisco VPN template to include a service route to the SIG.
From the Cisco SD-WAN Manager menu, choose Configuration > Templates.
Click Feature Templates.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Feature Templates is called Feature.
For the Cisco VPN template of the device, click Edit.
Click IPv4 Route.
Click the delete icon on any existing IPv4 route to the internet.
Click Service Route.
Click New Service Route.
Enter a Prefix (for example, 10.0.0.0/8).
For the service route, ensure that SIG is chosen.
Click Add.
Click Update.
Create Device Template
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates.

Note
In Cisco vManage Release 20.7.x and earlier releases, Device Templates is called Device .
Click Create Template and click From Feature Template.
From the Device Model drop-down list, choose the device model for which you are creating the template.
Cisco vManage displays all the feature templates for that device type. The required feature templates are indicated with an asterisk (*), and the remaining templates are optional. The factory-default template for each feature is chosen by default.
From the Device Role drop-down list, choose SDWAN Edge.
In the Template Name field, enter a name for the device template.
This field is mandatory and can contain only uppercase and lowercase letters, the digits 0 through 9, hyphens (-), and underscores (_). It cannot contain spaces or any other characters.
In the Description field, enter a description for the device template.
This field is mandatory, and it can contain any characters and spaces.
Click Transport & Management VPN.
In the Transport & Management VPN section, under Additional Cisco VPN 0 Templates, click Cisco Secure Internet Gateway.
From the Cisco Secure Internet Gateway drop-down list, choose the Cisco SIG feature template that you created earlier.
Click Additional Templates.
In the Additional Templates section,
Automatic tunneling:
(Cisco vManage Release 20.8.x and earlier) From the Cisco SIG Credentials drop-down list, choose the relevant Cisco SIG Credentials feature template.
(From Cisco vManage Release 20.9.1) Cisco vManage automatically chooses the applicable global Cisco SIG Credentials feature template based on the Cisco SIG feature template configuration.

Note
If there are any changes to the SIG credentials, for these changes to take effect, you must first remove the SIG feature template from the device template and push the device template. Thereafter, re-attach the SIG feature template and then push the template to the device. For information on pushing the device template, see Attach the SIG Template to Devices.
Manual tunneling: No need to attach a Cisco SIG Credentials template.
Click Create.
The new configuration template is displayed in the Device Template table. The Feature Templates column shows the number of feature templates that are included in the device template, and the Type column shows Feature to indicate that the device template was created from a collection of feature templates.
Attach Template to Devices
To attach one or more devices to the device template:
From the Cisco SD-WAN Manager menu, choose Configuration > Templates.
Click Device Templates, and choose the template that you created.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Device Templates is called Device.
For the desired template, click ... and click Attach Devices.
The Attach Devices dialog box displays.
In the Available Devices column, choose a group and search for one or more devices, choose a device from the list, or click Select All.
Click the arrow pointing right to move the device to the Selected Devices column.
Click Attach.
If the template contains variables, enter the missing variable values for each device in one of the following ways:
Enter the values manually for each device either in the table column or by clicking ... in the row and clicking Edit Device Template. When you are using optional rows, if you do not want to include the parameter for the specific device, do not specify a value.
Click Import File to upload a CSV file that lists all the variables and defines each variable value for each device.
Click Update.
Configure Source-Only Load Sharing
Minimum supported releases: Cisco IOS XE Release 17.8.1a and Cisco vManage Release 20.8.1.
Create CLI Add-On Template
From the Cisco vManage menu, choose Configuration > Templates.
Click Feature Templates.
Click Add Template.
Under Select Devices, choose the devices for which you are creating the template.
Under Select Template, scroll down to the OTHER TEMPLATES section.
Click CLI Add-On Template.
Template Name: Enter a name for the feature template.This field is mandatory and can contain only uppercase and lowercase letters, the digits 0 through 9, hyphens (-), and underscores (_). It cannot contain spaces or any other characters.
Description: Enter a description for the device template.
This field is mandatory, and it can contain any characters and spaces.
Under CLI CONFIGURATION, enter the following command: ip cef load-sharing algorithm src-only
Click Save.
Add CLI Add-On Template to Device Template
From the Cisco vManage menu, choose Configuration > Templates.
Click Device Templates.
Find the device template to which you wish to add the CLI add-on feature template.
For the device template, click ... and click Edit.
Scroll down to Additional Templates.
From the CLI Add-On Template drop-down list, choose the CLI add-on feature template that you created earlier.
Click Update.
Configuring a GRE Tunnel or IPsec Tunnel from Cisco vManage
Table 18. Feature History
Feature Name
Release Information
Description
Manual Configuration for GRE Tunnels and IPsec Tunnels
Cisco IOS XE Release 17.2.1r
This feature lets you manually configure a GRE tunnel by using the Cisco VPN Interface GRE template or an IPSec tunnel by using the Cisco VPN Interface IPSec template. For example, use this feature to manually configure a tunnel to a SIG.

Note
From Cisco IOS XE Release 17.4.1, Cisco vManage Release 20.4.1, all SIG related workflows for Automatic and Manual Tunnels have been consolidated into the SIG template. If you are using Cisco IOS XE Release 17.4.1, Cisco vManage Release 20.4.1, or later, configure GRE or IPSec tunnels to a generic SIG, or GRE tunnels to a Zscaler SIG, using the SIG template.
Configure a GRE Tunnel from Cisco vManage
Configure an IPsec Tunnel from Cisco vManage
Configure a GRE Tunnel from Cisco vManage
This section describes how to manually create a GRE tunnel from Cisco SD-WAN Manager. This procedure lets you configure a GRE tunnel to a third-party vendor.

Note
To configure a GRE tunnel from Cisco vManage, use the SIG Feature Template. For more information, see Create Manual Tunnels Using Cisco SIG Feature Template. The Cisco VPN Interface GRE template is no longer used to configure a tunnel to a SIG.
For releases prior to Cisco vManage Release 20.8.1, use the Cisco VPN Interface GRE template.
Perform these actions to create a GRE template:
From the Cisco SD-WAN Manager menu, choose Configuration > Templates.
Click Feature Templates, and then click Add Template.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Feature Templates is called Feature.
Choose the type of device for which you are creating the template.
Choose the Cisco VPN Interface GRE template from the group of VPN templates.
In Basic Configuration, configure parameters as desired and then click Save.
Perform these actions to create a GRE route:
Click Feature Templates, and then click Add Template.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Feature Templates is called Feature.
Choose the type of device for which you are creating the template.
Choose the Cisco VPN template in the group of VPN templates.
Click GRE Route.
Click New GRE Route.
Configure parameters as desired, and then click Add.
Perform these actions to configure a device template for the GRE interface.
Click Device, and then click ...and click Edit for the device template that you want to configure.
Click Transport & Management VPN.
From the Additional Cisco VPN 0 Templates list, choose the Cisco VPN Interface GRE template.
From the Cisco VPN Interface GRE drop-down menu, click Create Template.
Configure the templates as desired, and then click Save.
Configure an IPsec Tunnel from Cisco vManage
This section describes how to manually create an IPsec tunnel from Cisco SD-WAN Manager. This procedure lets you configure an IPsec tunnel to a third-party vendor.

Note
To configure a IPSec tunnel from Cisco vManage, use the SIG Feature Template. For more information, see Create Automatic Tunnels Using Cisco SIG Feature Template. The Cisco VPN Interface IPSec template is no longer used to configure a tunnel to a SIG.
For releases prior to Cisco vManage Release 20.8.1, use the Cisco VPN Interface IPsec template.
Perform these actions to create an IPsec template:
From the Cisco SD-WAN Manager menu, choose Configuration > Templates.
Click Feature Templates, and click Add Template.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Feature Templates is called Feature.
Choose the type of device for which you are creating the template.
Choose the Cisco VPN Interface IPsec template from the group of VPN templates.
In Basic Configuration, configure parameters as desired,
In Advanced, specify a name for your Tracker.
Click Save.
Perform these actions to create an IPSec route:
Click Feature Templates, and, click Add Template.

Note
In Cisco vManage Release 20.7.1 and earlier releases, Feature Templates is called Feature.
Choose the type of device for which you are creating the template.
Choose the Cisco VPN template in the group of VPN templates.
Click IPSEC Route.
Click New IPSEC Route.
Configure parameters as desired, and then click Add.
Perform these actions to configure a device template for the IPsec interface.
Click Device, and click … and choose Edit for the device template that you want to configure.
Click Transport & Management VPN.
From the Additional Cisco VPN 0 Templates list, choose the Cisco VPN Interface IPsec template.
From the Cisco VPN Interface IPsec drop-down menu, click Create Template.
Configure the templates as desired, and then click Save.
Configure SIG Tunnels in a Security Feature Profile
From Cisco vManage Release 20.10.1 and Cisco IOS XE SD-WAN Release 17.10.1, configure SIG tunnels in a configuration group and deploy the configuration to redirect traffic to SIG endpoints.
To configure SIG tunnels and redirect traffic to SIG endpoints, do the following:
For automatic tunnels, configure SIG provider credentials.
Create a Security feature profile or choose an exiting Security feature profile and associate it with the configuration group.
In the Security feature profile, configure the Secure Internet Gateway feature to create automatic or manual SIG tunnels.
For automatic tunnels, if you've not configured the SIG provider credentials, you are prompted to do so when you configure the Secure Internet Gateway feature.
For desired service VPNs, redirect traffic to SIG using data policies or by adding service routes in the service VPN feature configuration.
Deploy the configuration group on the desired WAN edge devices to create SIG tunnels from the devices to the configured SIG endpoints and redirect traffic to the SIG.
Configure SIG Credentials
Associate Security Feature Profile with a Configuration Group
Configure Secure Internet Gateway Feature
Redirect Traffic to SIG Using Service VPN Feature
Configure SIG Credentials
Before you create automatic SIG tunnels, configure Cisco Umbrella or Zscaler credentials to enable Cisco vManage to create the tunnels to Cisco Umbrella or Zscaler endpoints. If you do not configure the SIG credentials on the Administration > Settings page before you configure the Secure Internet Gateway feature in the Security feature profile, Cisco vManage prompts you to enter the credentials when you configure the the Secure Internet Gateway feature. After you have configured the SIG credentials, you can modify the credentials on the Administration > Settings page.
From the Cisco vManage menu, choose Administration > Settings.
For the Secure Internet Gateyway (SIG) Credentials setting, click Edit.
Choose Umbrella or Zscaler.
For Umbrella, do one of the following:
Enable Cisco vManage to fetch credentials from the Cisco Umbrella portal:
Ensure that you have added your Cisco Smart Account credentials here: Administration > Settings > Smart Account Credentials.
Cisco vManage uses the Cisco Smart Account credentials to connect to the Cisco Umbrella portal.
Click Get Keys.
Cisco vManage obtains the following details:
Organization ID
Registration Key
Secret
Enter Cisco Umbrella credentials:
Table 19. Cisco Umbrella Credentials
Field
Description
Organization ID
Enter the Cisco Umbrella organization ID (Org ID) for your organization.
For more information, see Find Your Organization ID in the Cisco Umbrella SIG User Guide.
Registration Key
Enter the Umbrella Management API Key.
For more information, see Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
Secret
Enter the Umbrella Management API Secret.
For more information, see Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
For Zscaler, configure the following:
Table 20. Zscaler Credentials
Field
Description
Organization
Name of the organization in Zscaler cloud.
For more information, see ZIA Help > Getting Started > Admin Portal > About the Company Profile.
Partner base URI
This is the base URI that Cisco vManage uses in REST API calls.
To find this information on the Zscaler portal, see ZIA Help > ZIA API > API Developer & Reference Guide > Getting Started.
Username
Username of the SD-WAN partner account.
Password
Password of the SD-WAN partner account.
Partner API key
Partner API key.
To find the key in Zscaler, see ZIA Help > Partner Integrations > Managing SD-WAN Partner Keys.
Click Save.
Associate Security Feature Profile with a Configuration Group
Before you begin: Create a configuration group if you haven't already done so. For more information on creating a configuration group, see Run the Create Configuration Group Workflow.
From the Cisco vManage menu, choose Configuration > Templates > Configuration Groups.
For the desired configuration group, click … adjacent to the configuration group name and choose Edit.
In the Feature Profiles - Unconfigured area, find the Security Profile and click Start Configuration.
In the Add Profile slide-in pane, do one of the following:
Create a new Security feature profile:
Click Create new.
Enter a unique Name and an optional Description for the profile.
Click Save.
Choose an existing Security feature profile:
Click Choose existing.
Select an existing Security feature profile. Click the radio button adjacent to the profile name.
Click Save.
The Security feature profile is listed under Associated Profiles.
Configure Secure Internet Gateway Feature
Before you begin: Create or edit a configuration group and associate the Security feature profile with it.
From the Cisco vManage menu, choose Configuration > Templates > Configuration Groups.
For the desired configuration group, click … adjacent to the configuration group name and choose Edit.
Under Associated Profiles, find the Security feature profile and expand the profile.
Click Add Feature.
In the Add Feature slide-in pane, from the drop-down list, choose the Secure Internet Gateway feature.
Configure the following details:
Table 21. Name, Description, and SIG Provider
Field
Description
Feature Name
Enter a name for the feature. The name can be up to 128 characters and can contain only alphanumeric characters.
Description
(Optional) Enter a description of the feature. The description can be up to 2048 characters and can contain only alphanumeric characters.
SIG Provider
Click one of the following:
Umbrella: Configure automatic tunnel to Cisco Umbrella SIG.
If you've not configured Umbrella credentials, Cisco vManage prompts you to configure the credentials: Click here to add Umbrella credentials.
Click, and in the Add Umbrella Credentials dialog box, enter the details mentioned in Table 2 and click Add.
Zscaler: Configure automatic tunnel to Zscaler SIG.
If you've not configured Zscaler credentials, Cisco vManage prompts you to configure the credentials: Click here to add Zscaler credentials.
Click, and in the Add Zscaler Credentials dialog box, enter the details mentioned in Table 3 click Add.
Generic: Configure manual tunnel to a SIG endpoint.
Table 22. Cisco Umbrella Credentials
Field
Description
Organization ID
Enter the Cisco Umbrella organization ID (Org ID) for your organization.
For more information, see Find Your Organization ID in the Cisco Umbrella SIG User Guide.
Registration Key
Enter the Umbrella Management API Key.
For more information, see Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
Secret
Enter the Umbrella Management API Secret.
For more information, see Management and Provisioning > Getting Started > Overview in the Cloud Security API documentation on the Cisco DevNet portal.
Table 23. Zscaler Credentials
Field
Description
Organization
Name of the organization in Zscaler cloud.
For more information, see ZIA Help > Getting Started > Admin Portal > About the Company Profile.
Partner base URI
This is the base URI that Cisco vManage uses in REST API calls.
To find this information on the Zscaler portal, see ZIA Help > ZIA API > API Developer & Reference Guide > Getting Started.
Username
Username of the SD-WAN partner account.
Password
Password of the SD-WAN partner account.
Partner API key
Partner API key.
To find the key in Zscaler, see ZIA Help > Partner Integrations > Managing SD-WAN Partner Keys.
To create tunnels, click Configuration and do the following:
Parameter Scope
Scope Description
Device Specific (indicated by a host icon)
Use a device-specific value for the parameter. For device-specific parameters, you cannot enter a value in the feature template. Enter the value when you add a device to the configuration group.
To change the default key, type a new string and move the cursor out of the Enter Key box.
Global (indicated by a globe icon)
Enter a value for the parameter, and apply that value to all devices.
Click Add Tunnel.
In the Add Tunnel dialog box, under Basic Settings configure the following:
Table 24. Basic Settings
Field Description
Tunnel Type
Umbrella: (Read only) ipsec
Zscaler: Click ipsec or gre.
Generic: Click ipsec or gre.
Interface Name (1..255)
Enter the interface name.
Description
Enter a description for the interface.
Tracker
By default, a tracker is attached to monitor the health of tunnels.
Alternatively, you can create a customized tracker as described in step 7 and choose the tracker.
Tunnel Source Interface Enter the name of the source interface of the tunnel. This interface should be an egress interface and is typically the internet-facing interface.
Source Public IP
(Automatic GRE tunnels to Zscaler only)
Public IP address of the tunnel source interface that is required to create the GRE tunnel to Zscaler.
Default: Auto.
We recommend that you use the default configuration. With the default configuration, the Cisco IOS XE SD-WAN device finds the public IP address assigned to the tunnel source interface using a DNS query. If the DNS query fails, the device notifies Cisco vManage of the failure. Enter the public IP address only if the DNS query fails.
Data-Center For a primary data center, click Primary, or for a secondary data center, click Secondary. Tunnels to the primary data center serve as active tunnels, and tunnels to the secondary data center serve as back-up tunnels.
Tunnel Destination IP Address/FQDN
(Manual tunnels only)
Enter the IP address of the SIG provider endpoint.
Preshared Key
(Manual tunnels only)
This field is displayed only if you choose ipsec as the Tunnel Type.
Enter the password to use with the preshared key.
(Optional) Under Advanced Options, configure the following:
Table 25. (Tunnel Type: gre) General
Field Description
Shutdown
Click No to enable the interface; click Yes to disable.
Default: No.
IP MTU
Specify the maximum MTU size of packets on the interface.
Range: 576 to 2000 bytes
Default: 1400 bytes
TCP MSS
Specify the maximum segment size (MSS) of TPC SYN packets. By default, the MSS is dynamically adjusted based on the interface or tunnel MTU such that TCP SYN packets are never fragmented.
Range: 500 to 1460 bytes
Default: None
Table 26. (Tunnel Type: ipsec) General
Field Description
Shutdown
Click No to enable the interface; click Yes to disable.
Default: No.
Track this interface for SIG
Enable or disable tracker for the tunnel. By default, Cisco vManage enables a tracker for automatic tunnels.
Default: On.
TCP MSS
Specify the maximum segment size (MSS) of TPC SYN packets. By default, the MSS is dynamically adjusted based on the interface or tunnel MTU such that TCP SYN packets are never fragmented.
Range: 500 to 1460 bytes
Default: None
IP MTU
Specify the maximum MTU size of packets on the interface.
Range: 576 to 2000 bytes
Default: 1400 bytes
DPD Interval
Specify the interval for IKE to send Hello packets on the connection.
Range: 10 to 3600 seconds
Default: 10
DPD Retries
Specify the number of seconds between DPD retry messages if the DPD retry message is missed by the peer.
Once 1 DPD message is missed by the peer, the router moves to a more aggressive state and sends the DPD retry message at the faster retry interval, which is the number of seconds between DPD retries if the DPD message is missed by the peer. The default DPD retry message is sent every 2 seconds. Five aggressive DPD retry messages can be missed before the tunnel is marked as down.
Range: 2 to 60 seconds
Default: 3
Table 27. (Tunnel Type: ipsec) IKE
Field Name Description
IKE Rekey Interval
Specify the interval for refreshing IKE keys.
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 14400 seconds
IKE Cipher Suite
Specify the type of authentication and encryption to use during IKE key exchange.
Choose one of the following:
AES 256 CBC SHA1
AES 256 CBC SHA2
AES 128 CBC SHA1
AES 128 CBC SHA2
Default: AES 256 CBC SHA1
IKE Diffie-Hellman Group
Specify the Diffie-Hellman group to use in IKE key exchange, whether IKEv1 or IKEv2.
2 1024-bit modulus
14 2048-bit modulus
15 3072-bit modulus
16 4096-bit modulus
Default: 14 2048-bit modulus
Table 28. (Tunnel Type: ipsec) IPSEC
Field Description
IPsec Rekey Interval
Specify the interval for refreshing IPSec keys.
Range: 300 to 1209600 seconds (1 hour to 14 days)
Default: 3600 seconds
IPsec Replay Window
Specify the replay window size for the IPsec tunnel.
Options: 64, 128, 256, 512, 1024, 2048, 4096.
Default: 512
IPsec Cipher Suite
Specify the authentication and encryption to use on the IPsec tunnel.
Options:
AES 256 CBC SHA1
AES 256 CBC SHA 384
AES 256 CBC SHA 256
AES 256 CBC SHA 512
AES 256 GCM
NULL SHA1
NULL SHA 384
NULL SHA 256
NULL SHA 512
Default: AES 256 GCM
Perfect Forward Secrecy
Specify the PFS settings to use on the IPsec tunnel.
Choose one of the following Diffie-Hellman prime modulus groups:
Group-2 1024-bit modulus
Group-14 2048-bit modulus
Group-15 3072-bit modulus
Group-16 4096-bit modulus
None: disable PFS.
Default: None
Click Add.
To create one or more trackers to monitor tunnel health, click Tracker and do the following:
Source IP Address: Enter a source IP address for the probe packets.
Click Add Tracker.
In the Add Tracker dialog box, configure the following:
Table 29. Tracker Parameters
Field Description
Name Enter a name for the tracker. The name can be up to 128 alphanumeric characters.
API url of endpoint Specify the API URL for the SIG endpoint of the tunnel.
Threshold
Enter the wait time for the probe to return a response before declaring that the configured endpoint is down.
Range: 100 to 1000 milliseconds
Default: 300 milliseconds.
Probe Interval
Enter the time interval between probes to determine the status of the configured endpoint.
Range: 20 to 600 seconds
Default: 60 seconds
Multiplier
Enter the number of times to resend probes before determining that a tunnel is down.
Range: 1 to 10
Default: 3
Click Add.
To add more trackers, repeat sub-step b to sub-step d.
To designate active and back-up tunnels and distribute traffic among tunnels, click High Availability and do the following:
Click Add Interface Pair.
In the Add Interface Pair dialog box, configure the following:
Table 30. High Availability Parameters
Field Description
Active
Choose a tunnel that connects to the primary data center.
Active Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two active tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
Backup
To designate a back-up tunnel, choose a tunnel that connects to the secondary data center.
To omit designating a back-up tunnel, choose None.
Backup Weight
Enter a weight (weight range 1 to 255) for load balancing.
Load balancing helps in distributing traffic over multiple tunnels and this helps increase the network bandwidth. If you enter the same weights, you can achieve ECMP load balancing across the tunnels. However, if you enter a higher weight for a tunnel, that tunnel has higher priority for traffic flow.
For example, if you set up two back-up tunnels, where the first tunnel is configured with a weight of 10, and the second tunnel with weight configured as 20, then the traffic is load-balanced between the tunnels in a 10:20 ratio.
Click Add.
To add more active and back-up tunnel pairs, repeat sub-step a to sub-step c.
(Optional) To configure advanced settings for Cisco Umbrella or Zscaler, click Advanced Settings and configure the following:
Table 31. Umbrella
Field Description
Umbrella Primary Data-Center
Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to a specific Cisco Umbrella data center, choose the data center from the drop-down list.
Umbrella Secondary Data-Center
Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to a specific Cisco Umbrella data center, choose the data center from the drop-down list.
Table 32. Zscaler
Field Description
Primary Datacenter
Automatic IPSec tunnels: Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to a specific Zscaler data center, choose the data center from the drop-down list.
Automatic GRE tunnels: Cisco vManage automatically selects the primary data center closest to the WAN edge device. If you wish to route traffic to specific Zscaler data center, ensure that you choose a Zscaler data center that is recommended by Zscaler based on geographical proximity to the device. Obtain the recommend list of Zscaler data centers through a GET API request for /vips/recommendedList. In the API request, specify the public IP of your device as the value of the sourceIp query parameter.

For more information on /vips/recommendedList, see ZIA API Developer & Reference Guide.

If you choose a data center that is not in the recommended list, the Cisco IOS XE SD-WAN device reverts to the automatically selected data center.
Secondary Datacenter
Automatic IPSec tunnels: Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to a specific Zscaler data center, choose the data center from the drop-down list.
Automatic GRE tunnels: Cisco vManage automatically selects the secondary data center closest to the WAN edge device. If you wish to route traffic to specific Zscaler data center, ensure that you choose a Zscaler data center that is recommended by Zscaler based on geographical proximity to the device. Obtain the recommend list of Zscaler data centers through a GET API request for /vips/recommendedList. In the API request, specify the public IP of your device as the value of the sourceIp query parameter.

For more information on /vips/recommendedList, see ZIA API Developer & Reference Guide.

If you choose a data center that is not in the recommended list, the Cisco IOS XE SD-WAN device reverts to the automatically selected data center.
Zscaler Location
(Optional) Enter the name of a location that is configured on the ZIA Admin Portal.
If you do not enter a location name, the Zscaler service detects the location based on the received traffic.
For more information about locations, see ZIA Help > Traffic Forwarding > Location Management > About Locations.
Authentication Required
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
XFF Forwarding
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable Firewall
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable IPS Control
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Enable Surrogate IP
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Display Time Unit
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Minute
Idle Time to Disassociation
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: 0
Enforce Surrogate IP for known browsers
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Off
Refresh Time Unit
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: Minute
Refresh Time
See ZIA Help > Traffic Forwarding > Location Management > Configuring Locations.
Default: 0
Click Save.
Redirect Traffic to SIG Using Service VPN Feature
Configure a SIG service route for a service VPN to direct the VPN traffic to SIG.

Note
Alternatively, you can also redirect traffic to SIG using Data Policy. For more information, see Action Parameters in the Policies Configuration Guide.
From the Cisco vManage menu, choose Configuration > Templates > Configuration Groups.
For the desired configuration group, click … adjacent to the configuration group name and choose Edit.
Expand the Service Profile, and for the service VPN whose traffic you want to redirect traffic to SIG, click ... and click Edit Parcel.
Remove any existing static IPv4 routes to the internet:
Click Route.
Under IPv4 Static Route, find any routes to the internet and click the delete icon to remove it.
Add SIG service route:
Click Service Route.
Click Add Service Route.
In the Add Service Route dialog box, configure the following:
Table 33. Service Route Parameters
Field Description
Network Address Enter the public IPv4 address.
Subnet Mask Enter the subnet for the IPv4 address.
Service
Choose SIG from the drop-down list.
VPN
Enter the VPN over which to direct the traffic.
Default: VPN 0
Click Add.
Click Save.
Next steps: Add Devices to Configuration Group and Deploy Devices.
Monitor SIG Events
Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage 20.9.1
Monitor security events related automatic SIG tunnels using the following Cisco vManage GUI components:
Security Events pane on the Monitor > Security page
Events dashboard on the Monitor > Logs page
Security Events
From the Cisco vManage menu, choose Monitor > Security.
The Security Events pane shows how many critical, major, and minor security events Cisco IOS XE SD-WAN devices have reported to Cisco vManage during a specified time period. The information is displayed in a bar chart.
Cisco IOS XE SD-WAN devices notify security events to Cisco vManage using NETCONF. The security events include events related to automatic SIG tunnel creation.
(Optional) By default, the pane displays security event information for the past 24 hours. To modify the time period, hover the mouse pointer over 24 Hours and choose a desired time period from the drop-down list.
(Optional) View Details: Click View Details to display the Monitor > Logs > Events page, with information filtered for the Security component.
Events Dashboard
From the Cisco vManage menu, choose Monitor > Logs.
Click Events.
Cisco vManage displays any events that WAN edge devices and controllers have notified in the past three hours.
Click Filter and configure the following:
Field Description
Component
Choose the Security component.
Severity
Choose one or more of Critical, Major, and Minor.
If you do not select specific severities, events of all three severites are displayed.
System IP
To view events notified by specific WAN edge devices, choose the system IP of the devices.
Event name
To view information about one or more specific SIG tunnel events, choose the corresponding event names.
Tip
  To view Cisco Umbrella SIG tunnel events, search for events that have ftm-tunnel in the event name. To view Zscaler SIG tunnel events, search for events that have ftm-zia in the event name.
Click Apply.
If the target devices or controllers notified any of the chosen events, Cisco vManage displays information about the same.
(Optional) To modify the time range, click 3 hours, select a time range, and click Apply.
Cisco vManage displays event information for the modified time range.
(Optional) Click Export to download a CSV file containing the table data.
The file is downloaded to your browser's default download location.
(Optional) Click on the gear icon adjacent to Export to display the Table Settings slide-in pane. Toggle the columns that you wish to display or hide and click Apply.
Monitor SIG Tunnels
Minimum supported releases: Cisco IOS XE Release 17.9.1a and Cisco vManage 20.9.1
Monitor the status of automatic SIG tunnels using the following Cisco vManage GUI components:
SIG Tunnel Status pane on the Monitor > Security page
SIG Tunnels dashboard on the Monitor > Tunnels page
SIG Tunnel Status
From the Cisco vManage menu, choose Monitor > Security.
The SIG Tunnel Status pane shows the following information using a donut chart:
total number of SIG tunnels that are configured
the number of SIG tunnels that are up
the number of SIG tunnels that are down
the number of SIG tunnels that are in a degraded state (Degraded state indicates that the SIG tunnel is up but the Layer 7 health of the tunnel as detected by the tracker does not meet the configured SLA parameters. Therefore, the traffic is not routed through the tunnel.)
(Optional) Click a section of the donut chart to view detailed information about tunnels having a particular status.
Cisco vManage displays detailed information about the tunnels in the SIG Tunnels dashboard.
(Optional) Click All SIG Tunnels to view the SIG Tunnels dashboard.
SIG Tunnels Dashboard
From the Cisco vManage menu, choose Monitor > Tunnels.
Click SIG Tunnels.
Cisco vManage displays a table that provides the following details about each automatic tunnel created to a Cisco Umbrella or a Zscaler SIG:
Host Name: Host name of the Cisco IOS XE SD-WAN edge device.
Site ID: ID of the site where the WAN edge device is deployed
Tunnel ID: Unique ID for the tunnel defined by the SIG provider
Transport Type: IPSec or GRE
Tunnel Name: Unique name for the tunnel that can be used to identify the tunnel at both the local and remote ends. On the SIG provider portal, you can use the tunnel name to find details about a particular tunnel.
HA Pair: Active or Backup
Provider: Cisco Umbrella or Zscaler
Destination Data Center: SIG provider data center to which the tunnel is connected

Note
Supported for Cisco Umbrella SIG endpoints. Yet to be supported for Zscaler ZIA Public Service Edges.
Tunnel Status (Local): Tunnel status as perceived by the device
Tunnel Status (Remote): Tunnel status as perceived by the SIG endpoint

Note
Supported for Cisco Umbrella SIG endpoints. Yet to be supported for Zscaler ZIA Public Service Edges.
Events: Number of events related to the tunnel set up, interface state change, and tracker notifications. Click on the number to display an Events slide-in pane. The slide-in pane lists all the relevant events for the particular tunnel.

Note
If you delete an automatic SIG tunnel from a GRE or IPSec interface and later configure an automatic SIG tunnel from the same interface, the newly configured SIG tunnel has the same name as the tunnel that you deleted earlier. As a result, when you configure the new tunnel, you may see SIG-tunnel-related events that were historically reported for the tunnel that was deleted earlier, if these events are not yet purged.
Tracker: Enabled or disabled during tunnel configuration
(Optional) By default, the table displays information for the past 24 hours. To modify the time period, hover the mouse pointer over 24 Hours and choose a desired time period from the drop-down list.
(Optional) To download a CSV file containing the table data, click Export.
The file is downloaded to your browser's default download location.
(Optional) Hide or display table columns: Click on the gear icon adjacent to Export to display the Table Settings slide-in pane. Toggle the columns that you wish to display or hide and click Apply.
Monitor Automatic SIG Tunnels Using CLI
Automatic SIG Tunnels to Cisco Umbrella
Minimum supported release: Cisco IOS XE Release 17.5.1a
To view information about the automatic SIG tunnels that you have configured from a Cisco IOS XE SD-WAN device to Cisco Umbrella, use the show sdwan secure-internet-gateway umbrella tunnels command.
The following is a sample output of the show sdwan secure-internet-gateway umbrella tunnels command:
Device# show sdwan secure-internet-gateway umbrella tunnels
                                                                                     API   LAST
TUNNEL IF                                                                            HTTP  SUCCESSFUL    TUNNEL
NAME         TUNNEL ID  TUNNEL NAME                             FSM STATE            CODE  REQ           STATE
-----------------------------------------------------------------------------------------------------------------
Tunnel17447  527398582  SITE10005SYS172x16x255x88IFTunnel17447  st-tun-create-notif  200   rekey-tunnel  -
Tunnel22427  527398577  SITE10005SYS172x16x255x88IFTunnel22427  st-tun-create-notif  200   rekey-tunnel  -
Tunnel22457  527398373  SITE10005SYS172x16x255x88IFTunnel22457  st-tun-create-notif  200   rekey-tunnel  - 
Automatic SIG Tunnels to Zscaler
To view information about the automatic SIG tunnels that you have configured from a Cisco IOS XE SD-WAN device to Zscaler SIG, use the show sdwan secure-internet-gateway zscaler tunnels command.
The following is a sample output of the show sdwan secure-internet-gateway zscaler tunnels command for automatic IPSec tunnels:
Minimum supported release: Cisco IOS XE Release 17.5.1a
Device# show sdwan secure-internet-gateway zscaler tunnels
                                                                                                                                                                                                            HTTP
TUNNEL IF                                                   TUNNEL                                                                                         LOCATION                                         RESP
NAME          TUNNEL NAME                                   ID        FQDN                                                        TUNNEL FSM STATE         ID        LOCATION FSM STATE   LAST HTTP REQ     CODE
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Tunnel100001  site1820851800sys172x16x255x15ifTunnel100001  52615809  site1820851800sys172x16x255x15iftunnel100001@example.com  add-vpn-credential-info  52615819  location-init-state  get-data-centers  200
Tunnel100002  site1820851800sys172x16x255x15ifTunnel100002  52615814  site1820851800sys172x16x255x15iftunnel100002@example.com  add-vpn-credential-info  52615819  location-init-state  get-data-centers  200
The following is a sample output of the show sdwan secure-internet-gateway zscaler tunnels command for automatic GRE tunnels:
Minimum supported release: Cisco IOS XE Release 17.9.1a
Device# show sdwan secure-internet-gateway zscaler tunnels 
                                                                                                                 HTTP  
TUNNEL IF                             TUNNEL        TUNNEL FSM      LOCATION                       LAST HTTP     RESP  
NAME          TUNNEL NAME             ID      FQDN  STATE           ID        LOCATION FSM STATE   REQ           CODE  
--------------------------------------------------------------------------------------------------------------------------
Tunnel100512  192.0.2.2_Tunnel100512  102489  n/a   gre-add-tunnel  46206485  location-init-state  activate-req  200 
Tunnel100513  192.0.2.2_Tunnel100513  102489  n/a   gre-add-tunnel  46206485  location-init-state  activate-req  200 
Automatic SIG Tunnels
Minimum supported release: Cisco IOS XE Release 17.9.1a
To view information about the automatic SIG tunnels that you have configured from a Cisco IOS XE SD-WAN device, use the show sdwan secure-internet-gateway tunnels command.
The following is a sample output of the show sdwan secure-internet-gateway tunnels command:
Device# show sdwan secure-internet-gateway tunnels
TUNNEL IF     TUNNEL                                                  HA      DEVICE  SIG    TRACKER              DESTINATION            TUNNEL
NAME          ID        TUNNEL NAME                                   PAIR    STATE   STATE  STATE    SITE ID     DATA CENTER  PROVIDER  TYPE    TIMESTAMP
------------------------------------------------------------------------------------------------------------------------------------------------------------
Tunnel100001  52615809  site1820851800sys172x16x255x15ifTunnel100001  Active  Up      NA     Enabled  1820851800  NA           zScaler   IPsec   NA
Tunnel100002  52615814  site1820851800sys172x16x255x15ifTunnel100002  Backup  Up      NA     Enabled  1820851800  NA           zScaler   IPsec   NA
Troubleshoot Integrating Your Devices With Secure Internet Gateways
This section describes how to troubleshoot integrating your devices with Secure Internet Gateways.
After Upgrading Cisco vManage Tunnels Fail
GRE Tunnel Creation Fails After You Restore Device Operation
After Upgrading Cisco vManage Tunnels Fail
After upgrading from Cisco vManage Release 20.3.1 to Cisco vManage Release 20.3.2, you may see failures when connecting from your devices to SIG services or when connecting standard IPSec tunnels to cloud security services.
Affected Feature Templates
Cisco Secure Internet Gateway (SIG)
Cisco VPN Interface IPSec (WAN)
Cisco VPN Interface GRE
Description
By default, a tunnel created using the SIG template pushes the tunnel vrf multiplexing command. For VPN Interface IPSec templates, from the Application drop-down list, if you choose Secure Internet Gateway, the command is pushed. However, after you upgrade to Cisco vManage Release 20.3.2, your feature templates may remove the tunnel vrf multiplexing configuration. This causes your feature templates to fail when connecting to SIG services or other external services such as cloud security services.
Workaround
Depending on which feature template you want to update, do one of the following:
Cisco VPN Interface Feature Templates
In Cisco SD-WAN Manager, edit the template.
From the Application drop-down menu, choose Secure Internet Gateway.
Save the template.
All Affected Feature Templates
You can do one of the following:
Manually add tunnel vrf multiplexing to the tunnel configuration using a CLI add-on feature template.
In Cisco SD-WAN Manager, edit the existing template as follows:
Modify a field, such as the description, that does not affect the configuration.
Save the template.
Push the template to the device.
Verification
You can run the following command to verify that tunnel vrf multiplexing was added to your templates:
show sdwan running-config interface tunnelNumber
Example:
Device#sh sdwan running-config interface | begin Tunnel100001
interface Tunnel100001
no shutdown
ip unnumbered GigabitEthernet1
ip mtu 1400
tunnel source GigabitEthernet1
tunnel destination dynamic
tunnel mode ipsec ipv4
tunnel protection ipsec profile if-ipsec1-ipsec-profile
tunnel vrf multiplexing 
exit
GRE Tunnel Creation Fails After You Restore Device Operation
Problem
If you have created an automatic GRE tunnel to a Zscaler SIG endpoint with a source public IP address, the device becomes inoperative due to an event such as a power outage or a maintenance activity. This issue is seen in Cisco IOS XE Release 17.9.1a or Cisco IOS XE Release 17.9.2a. When you make the device operational again and attempt to create an automatic GRE tunnel to the Zscaler with the same source public IP address, the tunnel creation fails. One of the following failure notifications appears in the Events dashboard on the Monitor > Logs page in the Cisco SD-WAN Manager menu:
add-static-ip-failure
add-gre-tunnel-failure
Alternatively, you can use the show sdwan secure-internet-gateway zscaler tunnels command to view the status of the tunnel along with an error code which indicates the reason for the failure of the tunnel creation.
Possible Causes
Tunnel creation fails because the source public IP address may exist on the Zscaler portal. This event occurs because the device didn’t clear the previous tunnels after becoming operational again.
Solution
Delete the existing source public IP address on the Zscaler portal by doing the following:
Remove the SIG feature template from the device in Cisco SD-WAN Manager.
From the Zscaler portal, choose Administration > Location Management and search for the location that is associated with the tunnel in the Location tab.
Click the Edit icon and delete the entry.
From the Zscaler portal, choose Administration > Static IPs & GRE Tunnels and locate the static IP address in the Static IP tab.
Click the Edit icon and delete the entry.
Attach the SIG template that you removed in the first step, back to the device. For more information about attaching the SIG template, see the section Attach the SIG Template to Devices.
Was this Document Helpful?
Yes No
Feedback
Customers Also Viewed
Configure Umbrella SIG Tunnels for Active/Backup or Active/Active Scenarios
Cisco SD-WAN Policies Configuration Guide, Cisco IOS XE Release 17.x --- Centralized Policy
Security Configuration Guide for vEdge Routers, Cisco SD-WAN Release 20 --- Integrate Your Devices With Secure Internet Gateways
+ Show 1 More
Contact Cisco
Open a Support Case
(Requires a Cisco Service Contract)